{"ast":null,"code":"import _classCallCheck from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{NavLink}from'react-router-dom';import{connect}from'react-redux';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import NavBar from'../../components/NavBar';import Bottom from'../../components/Bottom';import BreadCrumbs from'../../components/BreadCrumbs';import AdSpace from'../../components/AdSpace';import'../../App.css';var AllMessages=/*#__PURE__*/function(_Component){_inherits(AllMessages,_Component);var _super=_createSuper(AllMessages);function AllMessages(props){var _this;_classCallCheck(this,AllMessages);_this=_super.call(this,props);_this.abortController=new AbortController();_this.msgFetch=function(){var iLId=_this.interlocutorId();_this.interlocutor(iLId);fetch('/fetchmessages',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({conversantId:iLId})}).then(function(res){return res.json();}).then(function(results){var messages=results.map(function(result){return{time:result.date_created,sender:result.sender,msg:result.msg};});_this.setState({messages:messages});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.interlocutor=function(iLId){fetch('/firstname',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({iLId:iLId})}).then(function(res){return res.json();}).then(function(res){return _this.setState({interlocutor:res[0].first_name});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.switchRender=function(){var messages=_this.state.messages;if(_this.state.userId==='0'){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"PROSIMO PRIJAVITE SE V SISTEM!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}else return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255, 255, 255, 0.8)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"p\",{style:{fontSize:'30px'}},\"ZGODOVINA POGOVOROV S/Z: \",/*#__PURE__*/React.createElement(\"b\",null,_this.state.interlocutor)),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"ul\",{style:{display:'inline-block',maxWidth:'60vw'}},messages.map(function(msg,index){return/*#__PURE__*/React.createElement(\"li\",{key:index,style:{listStyleType:'none',lineHeight:'35px'}},msg.time.substring(8,10),\"-\",msg.time.substring(6,7),\"-\",msg.time.substring(0,4),\" \",msg.time.substring(11,16),\": \",/*#__PURE__*/React.createElement(\"b\",null,msg.sender),\": \",msg.msg);})),/*#__PURE__*/React.createElement(NavLink,{exact:true,to:'/chatpage/conversation?'+_this.interlocutorId(),className:\"btn\"},\"NAZAJ\"));};_this.state={userId:'0',interlocutor:'',messages:[]};return _this;}_createClass(AllMessages,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;fetch('/sessionroutes',{signal:this.abortController.signal}).then(function(res){return res.json();}).then(function(res){return _this2.setState({userId:res.userId});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});this.msgFetch();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();}},{key:\"interlocutorId\",value:function interlocutorId(){function subStrAfterChars(str,char){return str.substring(str.indexOf(char)+1);}var interlocutorId=subStrAfterChars(window.location.href,'?');return interlocutorId;}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:'/chatpage/conversation?'+this.interlocutorId()+'/all?'+this.interlocutorId()}),this.switchRender(),/*#__PURE__*/React.createElement(AdSpace,null),/*#__PURE__*/React.createElement(Bottom,null));}}]);return AllMessages;}(Component);var mapStateToProps=function mapStateToProps(state){return{loggedInUser:state.loggedInUser,loggedInUserId:state.loggedInUserId};};export default connect(mapStateToProps)(AllMessages);","map":{"version":3,"sources":["/home/katni/APP/client/src/pages/Chat/AllMessages.jsx"],"names":["React","Component","NavLink","connect","UpperLine","Header","NavBar","Bottom","BreadCrumbs","AdSpace","AllMessages","props","abortController","AbortController","msgFetch","iLId","interlocutorId","interlocutor","fetch","signal","method","headers","body","JSON","stringify","conversantId","then","res","json","results","messages","map","result","time","date_created","sender","msg","setState","catch","e","console","error","message","first_name","switchRender","state","userId","backgroundColor","fontSize","display","maxWidth","index","listStyleType","lineHeight","substring","abort","subStrAfterChars","str","char","indexOf","window","location","href","mapStateToProps","loggedInUser","loggedInUserId"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport AdSpace from '../../components/AdSpace';\nimport '../../App.css';\n\n\nclass AllMessages extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n        this.state = {\n            userId: '0',\n            interlocutor: '',\n            messages: []\n        }\n    }\n\n    abortController = new AbortController();\n\n    componentDidMount() {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => this.setState({userId: res.userId}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n\n        this.msgFetch();\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n    }\n\n    msgFetch = () => {\n        const iLId = this.interlocutorId();\n        this.interlocutor(iLId);\n        fetch('/fetchmessages', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                conversantId: iLId\n            })\n        })\n        .then(res => res.json())\n        .then(results => {\n            const messages = results.map(result => ({time: result.date_created, sender: result.sender, msg: result.msg}));\n            this.setState({messages})\n        })\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    interlocutorId() {\n        function subStrAfterChars(str, char) {\n            return str.substring(str.indexOf(char) + 1);\n        }\n        const interlocutorId = subStrAfterChars(window.location.href, '?');\n        return interlocutorId;\n    }\n\n    interlocutor = (iLId) => {\n        fetch('/firstname', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                iLId: iLId,\n            })\n        }).then(res => res.json())\n        .then(res => this.setState({interlocutor: res[0].first_name}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    switchRender = () => {\n\n        const messages = this.state.messages;\n\n        if (this.state.userId === '0') {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                <br/><br/><br/>\n                <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                <br/><br/><br/>\n            </div>\n        }\n        else return <div style = {{backgroundColor: 'rgb(255, 255, 255, 0.8)'}}>\n            <br/>\n            <p style = {{fontSize: '30px'}}>ZGODOVINA POGOVOROV S/Z: <b>{this.state.interlocutor}</b></p>\n            <br/>\n            <ul style = {{display: 'inline-block', maxWidth: '60vw'}}>\n            {messages.map((msg, index) =>\n                <li key={index} style={{listStyleType: 'none', lineHeight: '35px'}}>\n                    {msg.time.substring(8,10)}-{msg.time.substring(6,7)}-{msg.time.substring(0,4)} {msg.time.substring(11,16)}: <b>{msg.sender}</b>: {msg.msg}</li>)}\n            </ul>\n            <NavLink exact to = {'/chatpage/conversation?' + this.interlocutorId()} className = 'btn'>NAZAJ</NavLink>\n        </div>\n\n    }\n\n    render() {\n        return (\n            <div className = 'App'>\n                <UpperLine/>\n                <Header/>\n                <NavBar/>\n                <BreadCrumbs pathname = {'/chatpage/conversation?'+ this.interlocutorId() + '/all?' + this.interlocutorId()}/>\n                {this.switchRender()}\n                <AdSpace/>\n                <Bottom/>\n            </div>\n        )\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n};\n\nexport default connect(mapStateToProps) (AllMessages)"]},"metadata":{},"sourceType":"module"}