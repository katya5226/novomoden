{"ast":null,"code":"import _classCallCheck from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{connect}from'react-redux';import{NavLink}from'react-router-dom';import Popup from'reactjs-popup';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import NavBar from'../../components/NavBar';import UserSideBar from'./UserSideBar';import Bottom from'../../components/Bottom';import BreadCrumbs from'../../components/BreadCrumbs';import AdSpace from'../../components/AdSpace';import'../../App.css';var PastOrders=/*#__PURE__*/function(_React$Component){_inherits(PastOrders,_React$Component);var _super=_createSuper(PastOrders);function PastOrders(props){var _this;_classCallCheck(this,PastOrders);_this=_super.call(this,props);_this.abortController=new AbortController();_this.confirmGoodsReceived=function(id){//const orders = this.state.orders.map((order) => {if(order.order_id === id) order.status = 2})\n_this.callBackEnd('/orderstatus',id,2);window.location.href='/user_pastorders';//let orders = this.state.orders.map(order => {if(order.order_id === id) order.status=2})\n//console.log(this.state.orders[0].order_id)\n//const orders = this.state.orders.map((order) => {if(order.order_id === id) order.status = 2})\n//this.setState(state => {const orders = state.orders.map(order => {if(order.order_id === id) order.status=2}); return({...state, orders})});\n};_this.callBackEnd=function(backendPath,id,newStatus){fetch(backendPath,{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({orderId:id,newStatus:newStatus})}).then(_this.setState({confirmReceived:0,openDispute:0},function(){_this.fetchOrders();})).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.fetchOrders=function(){fetch('/userorders',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'}}).then(function(res){return res.json();}).then(function(orders){return _this.setState({orders:orders,numPages:Math.floor(orders.length/_this.state.perPage+0.99)});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});_this.setState({confirmReceived:0,openDispute:0});};_this.openDispute=function(id){// this.callBackEnd('/orderstatus', id, 3);\n// this.callBackEnd('/userorders', 0, 0);\nwindow.location.href='/contentsupport?3';};_this.cancelConfirm=function(){_this.setState({confirmReceived:0,openDispute:0});};_this.formatDate=function(date){var d=new Date(date*1000),month=''+(d.getMonth()+1),day=''+d.getDate(),year=d.getFullYear();if(month.length<2)month='0'+month;if(day.length<2)day='0'+day;return[day,month,year].join('-');};_this.paginationButtonClick=function(e){var newpage=1;switch(e.target.id){case'first':_this.setState({page:1});break;case'previous':_this.state.page>1?newpage=_this.state.page-1:newpage=1;_this.setState({page:newpage});break;case'next':_this.state.page<_this.state.numPages?newpage=_this.state.page+1:newpage=_this.state.numPages;_this.setState({page:newpage});break;case'last':_this.setState({page:_this.state.numPages});break;default:return null;}};_this.mapOrders=function(){var numOrders=_this.state.orders.length;var n=_this.state.perPage;var p=_this.state.page-1;var till;p*n+n<numOrders?till=(p+1)*n:till=numOrders;var ordersPortion=_this.state.orders.slice(p*n,till);return/*#__PURE__*/React.createElement(\"div\",{className:\"orderListWrapper\"},ordersPortion.map(function(order){return/*#__PURE__*/React.createElement(\"li\",{key:order.order_id,style:{listStyleType:\"none\"}},\"\\u0160tevilka naro\\u010Dila: \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},\" \",order.order_id,\" \"),\"Datum naro\\u010Dila:  \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},_this.formatDate(order.date_modified),\" \"),\"Cena:  \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},order.price,\" \\u20AC \"),\"Po\\u0161tnina:  \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},order.postage,\" \\u20AC \"),\"Prodajalec: \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},order.seller,\" \"),\"Izdelki: \",order.ad_ids.split(',').map(function(id){return/*#__PURE__*/React.createElement(NavLink,{to:\"/item?\"+id,key:id,className:\"btn_nopad\"},id);}),order.status===1&&/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"b\",null,\"Naro\\u010Dilo je odposlano.\")),/*#__PURE__*/React.createElement(\"br\",null),order.status===1&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_blue'].join(\" \"),onClick:function onClick(){return _this.setState({confirmReceived:order.order_id});}},\"POTRDI PREJEM\"),(order.status===0||order.status===1)&&/*#__PURE__*/React.createElement(NavLink,{className:['btn_nopad','btn_marg','btn_lightyellow'].join(\" \"),to:'/chatpage/conversation?'+order.seller_id},\"KONTAKTIRAJ PRODAJALCA\"),(order.status===0||order.status===1)&&order.dispute===0&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_yellow'].join(\" \"),onClick:function onClick(){return _this.setState({openDispute:order.order_id});}},\"ODPRI PRITO\\u017DBO\"),order.dispute===1&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_red','btn_nocursor'].join(\" \")},\"ODPRTA PRITO\\u017DBA\"),order.status===2&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_green','btn_nocursor'].join(\" \")},\"ZAKLJU\\u010CENO\"),order.status===4&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_red','btn_nocursor'].join(\" \")},\"PREKLICANO\"));}),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{id:\"first\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"PRVA\"),/*#__PURE__*/React.createElement(\"button\",{id:\"previous\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"<<\"),/*#__PURE__*/React.createElement(\"button\",{id:\"current\",className:\"btn_nopad\"},_this.state.page,\"/\",_this.state.numPages),/*#__PURE__*/React.createElement(\"button\",{id:\"next\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\">>\"),/*#__PURE__*/React.createElement(\"button\",{id:\"last\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"ZADNJA\")));};_this.switchRender=function(){if(_this.state.userId==='0'){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"PROSIMO PRIJAVITE SE V SISTEM!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}else if(!_this.state.orders.length){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h2\",{style:{color:'white'}},\"NI\\u010CESAR \\u0160E NISTE NARO\\u010CILI.\"));}else if(_this.state.confirmReceived||_this.state.openDispute){return/*#__PURE__*/React.createElement(\"div\",{className:\"userContainer\"},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),_this.mapOrders(),/*#__PURE__*/React.createElement(Popup,{open:true,position:\"center center\",onClose:_this.closeModal},/*#__PURE__*/React.createElement(\"div\",{style:{display:'inline-flex',justifyContent:'space-around'}},_this.state.confirmReceived?/*#__PURE__*/React.createElement(\"p\",{style:{margin:'auto 10px'}},\"S potrditvijo bo naro\\u010Dilo zaklju\\u010Deno in prito\\u017Eba ne bo ve\\u010D mo\\u017Ena. Ali ste prepri\\u010Dani, da \\u017Eelite potrditi prejem izdelkov?\"):null,_this.state.confirmReceived?/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:function onClick(){return _this.confirmGoodsReceived(_this.state.confirmReceived);}},\"DA\"):null,_this.state.openDispute?/*#__PURE__*/React.createElement(\"p\",{style:{margin:'auto 10px'}},\"Prito\\u017Ebo podajte le, \\u010De ste \\u017Ee kontaktirali prodajalca in niste pri\\u0161li do sporazumne re\\u0161itve. \\u017Delite nadaljevati?\"):null,_this.state.openDispute?/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:function onClick(){return _this.openDispute(_this.state.openDispute);}},\"DA\"):null,/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:_this.cancelConfirm},\"NE\"))));}else return/*#__PURE__*/React.createElement(\"div\",{className:\"userContainer\"},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),_this.mapOrders());};_this.state={userId:'0',orders:[],confirmReceived:0,openDispute:0,perPage:10,numPages:1,page:1};return _this;}_createClass(PastOrders,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;fetch('/sessionroutes',{signal:this.abortController.signal}).then(function(res){return res.json();}).then(function(res){return _this2.setState({userId:res.userId});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});this.callBackEnd('/userorders',0,0);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:this.props.location.pathname}),/*#__PURE__*/React.createElement(UserSideBar,null),this.switchRender(),/*#__PURE__*/React.createElement(AdSpace,null),/*#__PURE__*/React.createElement(Bottom,null));}}]);return PastOrders;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{loggedInUser:state.loggedInUser,loggedInUserId:state.loggedInUserId};};export default connect(mapStateToProps)(PastOrders);","map":{"version":3,"sources":["/home/katni/APP/client/src/pages/UserPage/PastOrders.jsx"],"names":["React","connect","NavLink","Popup","UpperLine","Header","NavBar","UserSideBar","Bottom","BreadCrumbs","AdSpace","PastOrders","props","abortController","AbortController","confirmGoodsReceived","id","callBackEnd","window","location","href","backendPath","newStatus","fetch","signal","method","headers","body","JSON","stringify","orderId","then","setState","confirmReceived","openDispute","fetchOrders","catch","e","console","error","message","res","json","orders","numPages","Math","floor","length","state","perPage","cancelConfirm","formatDate","date","d","Date","month","getMonth","day","getDate","year","getFullYear","join","paginationButtonClick","newpage","target","page","mapOrders","numOrders","n","p","till","ordersPortion","slice","map","order","order_id","listStyleType","fontWeight","date_modified","price","postage","seller","ad_ids","split","status","seller_id","dispute","switchRender","userId","backgroundColor","color","closeModal","display","justifyContent","margin","abort","pathname","Component","mapStateToProps","loggedInUser","loggedInUserId"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport { NavLink } from 'react-router-dom';\nimport Popup from 'reactjs-popup';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport UserSideBar from './UserSideBar';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport AdSpace from '../../components/AdSpace';\nimport '../../App.css';\n\n\nclass PastOrders extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            userId: '0',\n            orders: [],\n            confirmReceived: 0,\n            openDispute: 0,\n            perPage: 10,\n            numPages: 1,\n            page: 1\n        };\n    }\n\n    abortController = new AbortController();\n\tcomponentDidMount() {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => this.setState({userId: res.userId}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n\n        this.callBackEnd('/userorders', 0, 0);\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n    }\n\n    confirmGoodsReceived = (id) => {\n        //const orders = this.state.orders.map((order) => {if(order.order_id === id) order.status = 2})\n        this.callBackEnd('/orderstatus', id, 2);\n        window.location.href = '/user_pastorders';\n        //let orders = this.state.orders.map(order => {if(order.order_id === id) order.status=2})\n        //console.log(this.state.orders[0].order_id)\n        //const orders = this.state.orders.map((order) => {if(order.order_id === id) order.status = 2})\n        //this.setState(state => {const orders = state.orders.map(order => {if(order.order_id === id) order.status=2}); return({...state, orders})});\n    }\n\n    callBackEnd = (backendPath, id, newStatus) => {\n        fetch(backendPath, {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                orderId: id,\n                newStatus: newStatus\n            })\n        })\n        .then(this.setState({confirmReceived: 0, openDispute: 0}, () => {this.fetchOrders();}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    fetchOrders = () => {\n        fetch('/userorders', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            }\n        })\n        .then(res => res.json())\n        .then(orders => this.setState({orders: orders, numPages: Math.floor(orders.length/this.state.perPage + 0.99)}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n        this.setState({confirmReceived: 0, openDispute: 0});\n    }\n\n    openDispute = (id) => {\n        // this.callBackEnd('/orderstatus', id, 3);\n        // this.callBackEnd('/userorders', 0, 0);\n        window.location.href = '/contentsupport?3';\n    }\n\n    cancelConfirm = () => {\n        this.setState({confirmReceived: 0, openDispute: 0});\n    }\n\n    formatDate = (date) => {\n        var d = new Date(date*1000),\n            month = '' + (d.getMonth() + 1),\n            day = '' + d.getDate(),\n            year = d.getFullYear();\n        if (month.length < 2) \n            month = '0' + month;\n        if (day.length < 2) \n            day = '0' + day;\n    \n        return [day, month, year].join('-');\n    }\n\n    paginationButtonClick = (e) => {\n        let newpage = 1;\n        switch(e.target.id) {\n            case 'first':\n                this.setState({page: 1});\n                break;\n            case 'previous':\n                this.state.page > 1 ? newpage = this.state.page-1 : newpage = 1;\n                this.setState({page: newpage});\n                break;\n            case 'next':\n                this.state.page < this.state.numPages ? newpage = this.state.page+1 : newpage = this.state.numPages;\n                this.setState({page: newpage});\n                break;\n            case 'last':\n                this.setState({page: this.state.numPages});\n                break;\n            default:\n                return null;\n        }\n    }\n\n    mapOrders = () => {\n\n        let numOrders = this.state.orders.length;\n        let n = this.state.perPage;\n        let p = this.state.page - 1;\n        let till;\n        p*n + n < numOrders ? till = (p+1)*n : till = numOrders;\n        let ordersPortion = this.state.orders.slice(p*n, till);\n\n        return (\n            <div className = 'orderListWrapper'>                    \n            {ordersPortion.map((order) =>\n                <li key={order.order_id} style={{ listStyleType: \"none\" }}>\n                    Številka naročila: <span style={{fontWeight: 'bold'}}> {order.order_id} </span>\n                    Datum naročila:  <span style={{fontWeight: 'bold'}}>{this.formatDate(order.date_modified)} </span>\n                    Cena:  <span style={{fontWeight: 'bold'}}>{order.price} € </span>\n                    Poštnina:  <span style={{fontWeight: 'bold'}}>{order.postage} € </span>\n                    Prodajalec: <span style={{fontWeight: 'bold'}}>{order.seller} </span>\n                    Izdelki: {order.ad_ids.split(',').map(id => <NavLink to={\"/item?\" + id} key = {id} className = 'btn_nopad'>{id}</NavLink>)}\n                    {order.status === 1 && <p><b>Naročilo je odposlano.</b></p>}\n                    <br/>\n                    {order.status === 1 && <button className = {['btn_nopad', 'btn_marg', 'btn_blue'].join(\" \")} onClick = {() => this.setState({confirmReceived: order.order_id})}>POTRDI PREJEM</button>}\n                    {(order.status === 0 || order.status === 1) && <NavLink className = {['btn_nopad', 'btn_marg', 'btn_lightyellow'].join(\" \")} to = {'/chatpage/conversation?' + order.seller_id}>KONTAKTIRAJ PRODAJALCA</NavLink>}\n                    {((order.status === 0 || order.status === 1) && order.dispute === 0) && <button className = {['btn_nopad', 'btn_marg', 'btn_yellow'].join(\" \")} onClick = {() => this.setState({openDispute: order.order_id})}>ODPRI PRITOŽBO</button>}\n                    {order.dispute === 1 && <button className = {['btn_nopad', 'btn_marg', 'btn_red', 'btn_nocursor'].join(\" \")}>ODPRTA PRITOŽBA</button>}\n                    {order.status === 2 && <button className = {['btn_nopad', 'btn_marg', 'btn_green', 'btn_nocursor'].join(\" \")}>ZAKLJUČENO</button>}\n                    {order.status === 4 && <button className = {['btn_nopad', 'btn_marg', 'btn_red', 'btn_nocursor'].join(\" \")}>PREKLICANO</button>}\n                </li>\n            )}\n                <div>\n                    <button id='first' className='btn_nopad' onClick={this.paginationButtonClick}>PRVA</button>\n                    <button id='previous' className='btn_nopad' onClick={this.paginationButtonClick}>&#60;&#60;</button>\n                    <button id='current' className='btn_nopad'>{this.state.page}/{this.state.numPages}</button>\n                    <button id='next' className='btn_nopad' onClick={this.paginationButtonClick}>&#62;&#62;</button>\n                    <button id='last' className='btn_nopad' onClick={this.paginationButtonClick}>ZADNJA</button>\n                </div>\n            </div>\n        )\n    }\n\n    switchRender = () => {\n        if(this.state.userId === '0') {\n            return (\n                <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                    <br/><br/><br/>\n                    <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                    <br/><br/><br/>\n                </div>\n            )\n        }\n        else if(!this.state.orders.length) {\n            return (<div><h2 style = {{color: 'white'}}>NIČESAR ŠE NISTE NAROČILI.</h2></div>)\n        } else if(this.state.confirmReceived || this.state.openDispute) {\n            return (\n                <div className = 'userContainer'>\n                    <br/>\n                    <br/>\n                    {this.mapOrders()}\n                    <Popup open = {true}\n                        position = 'center center'\n                        onClose={this.closeModal}>\n                        <div style = {{display: 'inline-flex', justifyContent: 'space-around'}}>\n                            {this.state.confirmReceived ? <p style= {{margin: 'auto 10px'}}>S potrditvijo bo naročilo zaključeno in pritožba ne bo več možna. Ali ste prepričani, da želite potrditi prejem izdelkov?</p> : null}\n                            {this.state.confirmReceived ? <button className = 'btnb' onClick ={() => this.confirmGoodsReceived(this.state.confirmReceived)}>DA</button> : null}\n                            {this.state.openDispute ? <p style= {{margin: 'auto 10px'}}>Pritožbo podajte le, če ste že kontaktirali prodajalca in niste prišli do sporazumne rešitve. Želite nadaljevati?</p> : null}\n                            {this.state.openDispute ? <button className = 'btnb' onClick ={() => this.openDispute(this.state.openDispute)}>DA</button> : null}\n                            <button className = 'btnb' onClick = {this.cancelConfirm}>NE</button>\n                        </div>\n                    </Popup>\n                </div>\n            )\n        }\n        else return(\n            <div className = 'userContainer'>\n            <br/>\n            <br/>\n            {this.mapOrders()}\n        </div>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"App\">\n            <UpperLine/>\n            <Header/>\n            <NavBar/>\n            <BreadCrumbs pathname = {this.props.location.pathname}/>\n            <UserSideBar/>\n            {this.switchRender()}\n            <AdSpace/>\n            <Bottom/>\n            </div>\n        )\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n  };\n\n\nexport default connect(mapStateToProps) (PastOrders);\n\n"]},"metadata":{},"sourceType":"module"}