{"ast":null,"code":"import _classCallCheck from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import axios from'axios';import{NavLink}from'react-router-dom';import{connect}from'react-redux';import{saveAtt}from'../../redux/actions';import{doUpload}from'../../functions/index';import queryString from'query-string';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import NavBar from'../../components/NavBar';import ImgUpload from'./ImgUpload';import SelectForms from'./SelectForms';import Bottom from'../../components/Bottom';import BreadCrumbs from'../../components/BreadCrumbs';import ClipLoader from'react-spinners/ClipLoader';import'../../App.css';var EditPage=/*#__PURE__*/function(_React$Component){_inherits(EditPage,_React$Component);var _super=_createSuper(EditPage);function EditPage(props){var _this;_classCallCheck(this,EditPage);_this=_super.call(this,props);_this.abortController=new AbortController();_this.axiosSignal=axios.CancelToken.source();_this.checkIfAll=function(){var check=true;var selection=_this.state.selection;Object.keys(selection).forEach(function(key){if(key!=='brand'&&key!=='descrtext'){if(selection[key]===0&&selection.category!==3||selection[key]===null||selection[key]===''){check=false;_this.setState({warning:'Izpolni vsa polja'});}}});if(_this.state.photos.length<3&&_this.state.photos.length!==0){check=false;_this.setState({warning:'Izberi tri fotografije'});}return check;};_this.onImageSaved=function(photo,index){if(_this.state.photos.length<=index){_this.setState(function(state){var photos=state.photos.concat(photo);return{photos:photos};});}else{_this.setState(function(state){var photos=state.photos.map(function(item,j){if(j===index){return photo;}else{return item;}});return{photos:photos};});}};_this.onSelectionSaved=function(selection){_this.setState({selection:selection});};_this.state={userId:'0',adId:'',uploadedPhotos:[],photos:[],urls:[],fileWarning:'',warning:'',srcsToPass:[],editStatus:false,selection:{category:'',subcategory:'',clothsize:'',material:'',condition:'',brand:'',descrtext:'',weight:null,price:null},loading:false};_this.handleUpload=_this.handleUpload.bind(_assertThisInitialized(_this));return _this;}_createClass(EditPage,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;fetch('/sessionroutes',{signal:this.abortController.signal}).then(function(res){return res.json();}).then(function(res){return _this2.setState({userId:res.userId});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});var adId=queryString.stringify(queryString.parse(this.props.location.search));this.setState({adId:adId});if(adId!==''||adId!==undefined){console.log(adId);fetch('/fillform',{signal:this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({adId:adId})}).then(function(res){return res.json();}).then(function(res){return _this2.setState(function(state){var arr=[res[0].photo1_url,res[0].photo2_url,res[0].photo3_url];var srcsToPass=state.srcsToPass.concat(arr);return{srcsToPass:srcsToPass};});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();this.axiosSignal.cancel('Api is being canceled');}},{key:\"handleUpload\",value:function handleUpload(){var _this3=this;this.props.saveAtt(true);if(!this.checkIfAll()){this.setState({warning:\"IZPOLNI VSA POLJA!\"});}else{this.setState({loading:true});if(this.state.photos.length===3){doUpload('edit',this.state.selection,this.props.loggedInUserId,this.props.loggedInUser,this.axiosSignal,this.state.adId,this.state.photos).then(function(){return _this3.setState({editStatus:true,loading:false});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});}else{doUpload('edit',this.state.selection,this.props.loggedInUserId,this.props.loggedInUser,this.abortController.signal,this.state.adId).then(function(){return _this3.setState({editStatus:true,loading:false});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});}}}},{key:\"render\",value:function render(){var adId=queryString.stringify(queryString.parse(this.props.location.search));if(this.state.userId==='0'){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:this.props.location.pathname}),/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"PROSIMO PRIJAVITE SE V SISTEM!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null)),/*#__PURE__*/React.createElement(Bottom,null));}else if(this.state.editStatus){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h1\",{style:{backgroundColor:'rgb(255, 255, 255, 0.5)'}},\"USPE\\u0160NO STE POPRAVILI OGLAS!\"),/*#__PURE__*/React.createElement(NavLink,{exact:true,to:\"/user_listings\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn\"},\"NAZAJ NA MOJO STRAN\")));}else if(this.srcsToPass!==0){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:this.props.location.pathname}),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",width:\"90vw\"}},/*#__PURE__*/React.createElement(\"div\",{className:\"sidenav\"}),/*#__PURE__*/React.createElement(\"div\",{style:{width:\"100%\",backgroundColor:'rgb(255, 255, 255, 0.5)'}},/*#__PURE__*/React.createElement(\"h1\",null,\"POPRAVI OGLAS\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(SelectForms,{callBackParent:this.onSelectionSaved,saveAtt:this.state.saveAttempt,adId:adId}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"p\",null,\"OBDR\\u017DI TRENUTNE FOTOGRAFIJE:\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"img\",{src:'/api'+this.state.srcsToPass[0],alt:\"image_one\",height:\"200px\",hspace:\"20\"}),/*#__PURE__*/React.createElement(\"img\",{src:'/api'+this.state.srcsToPass[1],alt:\"image_two\",height:\"200px\",hspace:\"20\"}),/*#__PURE__*/React.createElement(\"img\",{src:'/api'+this.state.srcsToPass[2],alt:\"image_three\",height:\"200px\",hspace:\"20\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"p\",null,\"ALI IZBERI NOVE FOTOGRAFIJE:\"),/*#__PURE__*/React.createElement(ImgUpload,{callBackParent:this.onImageSaved,index:\"0\"}),/*#__PURE__*/React.createElement(ImgUpload,{callBackParent:this.onImageSaved,index:\"1\"}),/*#__PURE__*/React.createElement(ImgUpload,{callBackParent:this.onImageSaved,index:\"2\"}),!this.state.loading&&/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:this.handleUpload},\"SHRANI OGLAS\"),/*#__PURE__*/React.createElement(ClipLoader,{size:50,color:\"#123abc\",loading:this.state.loading}),/*#__PURE__*/React.createElement(\"p\",{style:{color:\"red\"}},this.state.warning))),/*#__PURE__*/React.createElement(Bottom,null));}else return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(\"h1\",{style:{backgroundColor:'rgb(255, 255, 255, 0.5)'}},\"Something went wrong\"));}}]);return EditPage;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{loggedInUser:state.loggedInUser,loggedInUserId:state.loggedInUserId};};var mapDispatchToProps={saveAtt:saveAtt};export default connect(mapStateToProps,mapDispatchToProps)(EditPage);","map":{"version":3,"sources":["/home/katni/APP/client/src/pages/Publish/EditPage.jsx"],"names":["React","axios","NavLink","connect","saveAtt","doUpload","queryString","UpperLine","Header","NavBar","ImgUpload","SelectForms","Bottom","BreadCrumbs","ClipLoader","EditPage","props","abortController","AbortController","axiosSignal","CancelToken","source","checkIfAll","check","selection","state","Object","keys","forEach","key","category","setState","warning","photos","length","onImageSaved","photo","index","concat","map","item","j","onSelectionSaved","userId","adId","uploadedPhotos","urls","fileWarning","srcsToPass","editStatus","subcategory","clothsize","material","condition","brand","descrtext","weight","price","loading","handleUpload","bind","fetch","signal","then","res","json","catch","e","console","error","message","stringify","parse","location","search","undefined","log","method","headers","body","JSON","arr","photo1_url","photo2_url","photo3_url","abort","cancel","loggedInUserId","loggedInUser","pathname","backgroundColor","display","width","saveAttempt","color","Component","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport axios from 'axios';\nimport { NavLink } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { saveAtt } from '../../redux/actions';\nimport { doUpload } from '../../functions/index';\nimport queryString from 'query-string';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport ImgUpload from './ImgUpload';\nimport SelectForms from './SelectForms';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport ClipLoader from 'react-spinners/ClipLoader';\nimport '../../App.css';\n\n\nclass EditPage extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            userId: '0',\n            adId: '',\n            uploadedPhotos: [],\n            photos: [],\n            urls: [],\n            fileWarning: '',\n            warning: '',\n            srcsToPass: [],\n            editStatus: false,\n            selection: {\n                category: '',\n                subcategory: '',\n                clothsize: '',\n                material: '',\n                condition: '',\n                brand: '',\n                descrtext: '',\n                weight: null,\n                price: null\n            },\n            loading: false\n        };\n        this.handleUpload = this.handleUpload.bind(this);\n    }\n\n    abortController = new AbortController();\n    axiosSignal = axios.CancelToken.source();\n\n    componentDidMount() {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => this.setState({userId: res.userId}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n\n        const adId = queryString.stringify(queryString.parse(this.props.location.search));\n        this.setState({adId});\n        if(adId !== '' || adId !== undefined) {\n            console.log(adId)\n            fetch('/fillform', {\n                signal: this.abortController.signal,\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json'\n                },\n                body: JSON.stringify({adId: adId})\n            }).then(res => res.json())\n                .then(res => this.setState(state => {\n                    let arr = [res[0].photo1_url, res[0].photo2_url, res[0].photo3_url];\n                    let srcsToPass = state.srcsToPass.concat(arr);\n                    return {srcsToPass};\n                    }))\n\n                .catch(e => console.error(\"Critical failure: \" + e.message));           \n        }\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n        this.axiosSignal.cancel('Api is being canceled');\n    }\n\n    checkIfAll = () => {\n        let check = true;\n        const selection = this.state.selection;\n        Object.keys(selection).forEach(key => {\n            if(key !== 'brand' && key !== 'descrtext') {\n                if((selection[key] === 0 && selection.category !== 3) || selection[key] === null || selection[key] === '') {\n                    check = false;\n                    this.setState({warning: 'Izpolni vsa polja'});\n                }\n            }\n        });\n        if (this.state.photos.length < 3 && this.state.photos.length !== 0) {\n            check = false;\n            this.setState({warning: 'Izberi tri fotografije'});\n        }\n        return check;\n    }\n\n    onImageSaved = (photo, index) => {\n        if (this.state.photos.length <= index) {\n            this.setState(state => {\n                const photos = state.photos.concat(photo);\n                return {photos};\n            });\n        } else {\n            this.setState(state => {\n                const photos = state.photos.map((item, j) => {\n                    if (j === index) {\n                        return photo;\n                    } else {\n                        return item;\n                    }\n                });\n                return {photos};\n            });\n        }\n    }\n\n    onSelectionSaved = (selection) => {\n        this.setState({selection});\n    }\n\n    handleUpload() {\n        this.props.saveAtt(true);    \n        if (!this.checkIfAll()) {\n            this.setState({warning: \"IZPOLNI VSA POLJA!\"}); \n        }else {\n            this.setState({loading: true})\n            if(this.state.photos.length === 3) {\n                doUpload('edit', this.state.selection, this.props.loggedInUserId, this.props.loggedInUser, this.axiosSignal, this.state.adId, this.state.photos)\n                .then(() => this.setState({editStatus: true, loading: false}))\n                .catch(e => console.error(\"Critical failure: \" + e.message));\n            } else {\n                doUpload('edit', this.state.selection, this.props.loggedInUserId, this.props.loggedInUser, this.abortController.signal, this.state.adId)\n                .then(() => this.setState({editStatus: true, loading: false}))\n                .catch(e => console.error(\"Critical failure: \" + e.message));\n            }\n        }\n    }\n\n    render() {\n        const adId = queryString.stringify(queryString.parse(this.props.location.search));\n        if(this.state.userId === '0') {\n            return (\n                <div className = 'App'>\n                    <UpperLine/>\n                    <Header/>\n                    <NavBar/>\n                    <BreadCrumbs pathname = {this.props.location.pathname}/>\n                    <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                        <br/><br/><br/>\n                        <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                        <br/><br/><br/>\n                    </div>\n                    <Bottom/>\n                </div>\n            )\n        }\n        else if(this.state.editStatus) {\n            return <div className=\"App\">\n                     <br/><br/>\n                     <h1 style={{backgroundColor: 'rgb(255, 255, 255, 0.5)'}}>USPEŠNO STE POPRAVILI OGLAS!</h1>\n                     <NavLink exact to = '/user_listings'><button className = 'btn'>NAZAJ NA MOJO STRAN</button></NavLink>\n                 </div>\n        } else if(this.srcsToPass !== 0) {\n         return (\n         <div className=\"App\">\n             <UpperLine/>\n             <Header/>\n             <BreadCrumbs pathname = {this.props.location.pathname}/>\n             <div style={{display: \"flex\", width: \"90vw\"}}>\n                 <div className=\"sidenav\"></div>\n                 <div style={{width: \"100%\", backgroundColor: 'rgb(255, 255, 255, 0.5)'}}>\n                    <h1>POPRAVI OGLAS</h1>\n                    <br/>\n                    <SelectForms callBackParent={this.onSelectionSaved} saveAtt ={this.state.saveAttempt} adId={adId}/>\n                    <br/>\n                    <p>OBDRŽI TRENUTNE FOTOGRAFIJE:</p>\n                    <br/>\n                    <img src={'/api' + this.state.srcsToPass[0]} alt=\"image_one\" height=\"200px\" hspace=\"20\"/>\n                    <img src={'/api' + this.state.srcsToPass[1]} alt=\"image_two\" height=\"200px\" hspace=\"20\"/>\n                    <img src={'/api' + this.state.srcsToPass[2]} alt=\"image_three\" height=\"200px\" hspace=\"20\"/>\n                    <br/>\n                    <br/>\n                    <p>ALI IZBERI NOVE FOTOGRAFIJE:</p>\n                    <ImgUpload callBackParent={this.onImageSaved} index='0'/>\n                    <ImgUpload callBackParent={this.onImageSaved} index='1'/>\n                    <ImgUpload callBackParent={this.onImageSaved} index='2'/>\n                    {!this.state.loading && <button className = 'btnb' onClick={this.handleUpload}>SHRANI OGLAS</button>}\n                    <ClipLoader\n                        size={50}\n                        color={\"#123abc\"}\n                        loading={this.state.loading}\n                    />\n                    <p style={{color: \"red\"}}>{this.state.warning}</p>\n                 </div>\n             </div>\n             <Bottom/>\n         </div>\n         )}\n         else return <div className=\"App\"><h1 style={{backgroundColor: 'rgb(255, 255, 255, 0.5)'}}>Something went wrong</h1></div>}\n    }\n\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n};\n\nconst mapDispatchToProps = {\n    saveAtt: saveAtt\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (EditPage);\n"]},"metadata":{},"sourceType":"module"}