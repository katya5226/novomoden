{"ast":null,"code":"import _classCallCheck from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{connect}from'react-redux';import{NavLink}from'react-router-dom';import Popup from'reactjs-popup';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import NavBar from'../../components/NavBar';import UserSideBar from'./UserSideBar';import Bottom from'../../components/Bottom';import BreadCrumbs from'../../components/BreadCrumbs';import AdSpace from'../../components/AdSpace';import'../../App.css';var Sold=/*#__PURE__*/function(_React$Component){_inherits(Sold,_React$Component);var _super=_createSuper(Sold);function Sold(props){var _this;_classCallCheck(this,Sold);_this=_super.call(this,props);_this.abortController=new AbortController();_this.confirmGoodsSent=function(id){_this.callBackEnd('/orderstatus',id,1);_this.fetchOrders();};_this.cancelConfirm=function(){_this.setState({confirmSent:0});};_this.callBackEnd=function(backendPath,id,newStatus){fetch(backendPath,{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({orderId:id,newStatus:newStatus})}).then(_this.setState({confirmReceived:0,openDispute:0},function(){_this.fetchOrders();})).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.fetchOrders=function(){fetch('/api/usersold',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'}}).then(function(res){return res.json();}).then(function(orders){return _this.setState({orders:orders,numPages:Math.floor(orders.length/_this.state.perPage+0.99)});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});_this.setState({confirmSent:0});};_this.formatDate=function(date){var d=new Date(date*1000),month=''+(d.getMonth()+1),day=''+d.getDate(),year=d.getFullYear();if(month.length<2)month='0'+month;if(day.length<2)day='0'+day;return[day,month,year].join('-');};_this.paginationButtonClick=function(e){var newpage=1;switch(e.target.id){case'first':_this.setState({page:1});break;case'previous':_this.state.page>1?newpage=_this.state.page-1:newpage=1;_this.setState({page:newpage});break;case'next':_this.state.page<_this.state.numPages?newpage=_this.state.page+1:newpage=_this.state.numPages;_this.setState({page:newpage});break;case'last':_this.setState({page:_this.state.numPages});break;default:return null;}};_this.mapOrders=function(){var numOrders=_this.state.orders.length;var n=_this.state.perPage;var p=_this.state.page-1;var till;p*n+n<numOrders?till=(p+1)*n:till=numOrders;var ordersPortion=_this.state.orders.slice(p*n,till);return/*#__PURE__*/React.createElement(\"div\",{className:\"orderListWrapper\"},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),ordersPortion.map(function(order){return/*#__PURE__*/React.createElement(\"li\",{key:order.order_id,style:{listStyleType:\"none\"}},\"\\u0160tevilka naro\\u010Dila: \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},\" \",order.order_id,\" \"),\"Datum naro\\u010Dila:  \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},_this.formatDate(order.date_modified),\" \"),\"Cena:  \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},order.price,\" \\u20AC \"),\"Po\\u0161tnina:  \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},order.postage,\" \\u20AC \"),\"Kupec: \",/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:'bold'}},order.buyer,\" \"),\"Izdelki: \",order.ad_ids.split(',').map(function(id){return/*#__PURE__*/React.createElement(NavLink,{to:\"/item?\"+id,key:id,className:\"btn_nopad\"},id);}),/*#__PURE__*/React.createElement(\"br\",null),order.status===0&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_yellow'].join(\" \"),onClick:function onClick(){return _this.setState({confirmSent:order.order_id});}},\"POTRDI PO\\u0160ILJANJE\"),order.status===1&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_lightyellow','btn_nocursor'].join(\" \")},\"\\u010CAKA POTRDITEV KUPCA\"),order.dispute===1&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_red','btn_nocursor'].join(\" \")},\"ODPRTA PRITO\\u017DBA\"),order.status===2&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_green','btn_nocursor'].join(\" \")},\"ZAKLJU\\u010CENO\"),order.status===4&&/*#__PURE__*/React.createElement(\"button\",{className:['btn_nopad','btn_marg','btn_red','btn_nocursor'].join(\" \")},\"PREKLICANO\"));}),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{id:\"first\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"PRVA\"),/*#__PURE__*/React.createElement(\"button\",{id:\"previous\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"<<\"),/*#__PURE__*/React.createElement(\"button\",{id:\"current\",className:\"btn_nopad\"},_this.state.page,\"/\",_this.state.numPages),/*#__PURE__*/React.createElement(\"button\",{id:\"next\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\">>\"),/*#__PURE__*/React.createElement(\"button\",{id:\"last\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"ZADNJA\")));};_this.switchRender=function(){if(_this.state.userId==='0'){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"PROSIMO PRIJAVITE SE V SISTEM!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}else if(!_this.state.orders.length){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h2\",{style:{color:'white'}},\"NI PRODANIH IZDELKOV.\"));}else{if(!_this.state.confirmSent)return/*#__PURE__*/React.createElement(\"div\",{className:\"userContainer\"},_this.mapOrders());else if(_this.state.confirmSent)return/*#__PURE__*/React.createElement(\"div\",{className:\"userContainer\"},_this.mapOrders(),/*#__PURE__*/React.createElement(Popup,{open:true,position:\"center center\",onClose:_this.closeModal},/*#__PURE__*/React.createElement(\"div\",{style:{display:'inline-flex',justifyContent:'space-around'}},_this.state.confirmSent?/*#__PURE__*/React.createElement(\"p\",{style:{margin:'auto 10px'}},\"Potrjujem, da sem odposlal/a izdelke.\"):null,_this.state.confirmSent?/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:function onClick(){return _this.confirmGoodsSent(_this.state.confirmSent);}},\"DA\"):null,/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:_this.cancelConfirm},\"NE\"))));}};_this.state={userId:'0',confirmSent:0,orders:[],perPage:10,numPages:1,page:1};return _this;}_createClass(Sold,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;fetch('/api/sessionroutes',{signal:this.abortController.signal}).then(function(res){return res.json();}).then(function(res){return _this2.setState({userId:res.userId});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});fetch('/api/usersold',{signal:this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'}}).then(function(res){return res.json();}).then(function(orders){return _this2.setState({orders:orders});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:this.props.location.pathname}),/*#__PURE__*/React.createElement(UserSideBar,null),this.switchRender(),/*#__PURE__*/React.createElement(AdSpace,null),/*#__PURE__*/React.createElement(Bottom,null));}}]);return Sold;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{loggedInUser:state.loggedInUser,loggedInUserId:state.loggedInUserId};};export default connect(mapStateToProps)(Sold);","map":{"version":3,"sources":["/home/katni/APP/client/src/pages/UserPage/Sold.jsx"],"names":["React","connect","NavLink","Popup","UpperLine","Header","NavBar","UserSideBar","Bottom","BreadCrumbs","AdSpace","Sold","props","abortController","AbortController","confirmGoodsSent","id","callBackEnd","fetchOrders","cancelConfirm","setState","confirmSent","backendPath","newStatus","fetch","signal","method","headers","body","JSON","stringify","orderId","then","confirmReceived","openDispute","catch","e","console","error","message","res","json","orders","numPages","Math","floor","length","state","perPage","formatDate","date","d","Date","month","getMonth","day","getDate","year","getFullYear","join","paginationButtonClick","newpage","target","page","mapOrders","numOrders","n","p","till","ordersPortion","slice","map","order","order_id","listStyleType","fontWeight","date_modified","price","postage","buyer","ad_ids","split","status","dispute","switchRender","userId","backgroundColor","color","closeModal","display","justifyContent","margin","abort","location","pathname","Component","mapStateToProps","loggedInUser","loggedInUserId"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport { NavLink } from 'react-router-dom';\nimport Popup from 'reactjs-popup';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport UserSideBar from './UserSideBar';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport AdSpace from '../../components/AdSpace';\nimport '../../App.css';\n\n\nclass Sold extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            userId: '0',\n            confirmSent: 0,\n            orders: [],\n            perPage: 10,\n            numPages: 1,\n            page: 1\n        };\n    }\n\n    abortController = new AbortController();\n\tcomponentDidMount() {\n        fetch('/api/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => this.setState({userId: res.userId}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n\n        fetch('/api/usersold', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            }\n        })\n        .then(res => res.json())\n        .then(orders => this.setState({orders}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));   \n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n    }\n\n    confirmGoodsSent = (id) => {\n        this.callBackEnd('/orderstatus', id, 1);\n        this.fetchOrders();\n    }\n\n    cancelConfirm = () => {\n        this.setState({confirmSent: 0});\n    }\n\n    callBackEnd = (backendPath, id, newStatus) => {\n        fetch(backendPath, {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                orderId: id,\n                newStatus: newStatus\n            })\n        })\n        .then(this.setState({confirmReceived: 0, openDispute: 0}, () => {this.fetchOrders();}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    fetchOrders = () => {\n        fetch('/api/usersold', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            }\n        })\n        .then(res => res.json())\n        .then(orders => this.setState({orders: orders, numPages: Math.floor(orders.length/this.state.perPage + 0.99)}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n        this.setState({confirmSent: 0});\n    }\n\n    formatDate = (date) => {\n        var d = new Date(date*1000),\n            month = '' + (d.getMonth() + 1),\n            day = '' + d.getDate(),\n            year = d.getFullYear();\n        if (month.length < 2) \n            month = '0' + month;\n        if (day.length < 2) \n            day = '0' + day;\n    \n        return [day, month, year].join('-');\n    }\n\n    paginationButtonClick = (e) => {\n        let newpage = 1;\n        switch(e.target.id) {\n            case 'first':\n                this.setState({page: 1});\n                break;\n            case 'previous':\n                this.state.page > 1 ? newpage = this.state.page-1 : newpage = 1;\n                this.setState({page: newpage});\n                break;\n            case 'next':\n                this.state.page < this.state.numPages ? newpage = this.state.page+1 : newpage = this.state.numPages;\n                this.setState({page: newpage});\n                break;\n            case 'last':\n                this.setState({page: this.state.numPages});\n                break;\n            default:\n                return null;\n        }\n    }\n\n    mapOrders = () => {\n\n        let numOrders = this.state.orders.length;\n        let n = this.state.perPage;\n        let p = this.state.page - 1;\n        let till;\n        p*n + n < numOrders ? till = (p+1)*n : till = numOrders;\n        let ordersPortion = this.state.orders.slice(p*n, till);\n\n        return(\n            <div className = 'orderListWrapper'>\n            <br/>\n            <br/>\n            {ordersPortion.map((order) =>\n                <li key={order.order_id} style={{ listStyleType: \"none\" }}>\n                    Številka naročila: <span style={{fontWeight: 'bold'}}> {order.order_id} </span>\n                    Datum naročila:  <span style={{fontWeight: 'bold'}}>{this.formatDate(order.date_modified)} </span>\n                    Cena:  <span style={{fontWeight: 'bold'}}>{order.price} € </span>\n                    Poštnina:  <span style={{fontWeight: 'bold'}}>{order.postage} € </span>\n                    Kupec: <span style={{fontWeight: 'bold'}}>{order.buyer} </span>\n                    Izdelki: {order.ad_ids.split(',').map(id => <NavLink to={\"/item?\" + id} key = {id} className = 'btn_nopad'>{id}</NavLink>)}\n                    <br/>\n                    {order.status === 0 && <button className = {['btn_nopad', 'btn_marg', 'btn_yellow'].join(\" \")} onClick = {() => this.setState({confirmSent: order.order_id})}>POTRDI POŠILJANJE</button>}\n                    {order.status === 1 && <button className = {['btn_nopad', 'btn_marg', 'btn_lightyellow', 'btn_nocursor'].join(\" \")}>ČAKA POTRDITEV KUPCA</button>}\n                    {order.dispute === 1 && <button className = {['btn_nopad', 'btn_marg', 'btn_red', 'btn_nocursor'].join(\" \")}>ODPRTA PRITOŽBA</button>}\n                    {order.status === 2 && <button className = {['btn_nopad', 'btn_marg', 'btn_green', 'btn_nocursor'].join(\" \")}>ZAKLJUČENO</button>}\n                    {order.status === 4 && <button className = {['btn_nopad', 'btn_marg', 'btn_red', 'btn_nocursor'].join(\" \")}>PREKLICANO</button>}\n                </li>\n            )}\n            <div>\n                <button id='first' className='btn_nopad' onClick={this.paginationButtonClick}>PRVA</button>\n                <button id='previous' className='btn_nopad' onClick={this.paginationButtonClick}>&#60;&#60;</button>\n                <button id='current' className='btn_nopad'>{this.state.page}/{this.state.numPages}</button>\n                <button id='next' className='btn_nopad' onClick={this.paginationButtonClick}>&#62;&#62;</button>\n                <button id='last' className='btn_nopad' onClick={this.paginationButtonClick}>ZADNJA</button>\n            </div>\n            </div>\n        )\n    }\n    \n    switchRender = () => {\n        if(this.state.userId === '0') {\n            return (\n                <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                    <br/><br/><br/>\n                    <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                    <br/><br/><br/>\n                </div>\n            )\n        }\n        else if(!this.state.orders.length) {\n            return (<div><h2 style = {{color: 'white'}}>NI PRODANIH IZDELKOV.</h2></div>)\n        } else {\n            if(!this.state.confirmSent)\n                return (\n                    <div className = 'userContainer'>\n                        {this.mapOrders()}\n                    </div>\n                )\n            else if(this.state.confirmSent)\n                return(\n                    <div className = 'userContainer'>\n                        {this.mapOrders()}\n                        <Popup open = {true}\n                            position = 'center center'\n                            onClose={this.closeModal}>\n                            <div style = {{display: 'inline-flex', justifyContent: 'space-around'}}>\n                                {this.state.confirmSent ? <p style= {{margin: 'auto 10px'}}>Potrjujem, da sem odposlal/a izdelke.</p> : null}\n                                {this.state.confirmSent ? <button className = 'btnb' onClick ={() => this.confirmGoodsSent(this.state.confirmSent)}>DA</button> : null}\n                                <button className = 'btnb' onClick = {this.cancelConfirm}>NE</button>\n                            </div>\n                        </Popup>\n                    </div>\n                )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"App\">\n            <UpperLine/>\n            <Header/>\n            <NavBar/>\n            <BreadCrumbs pathname = {this.props.location.pathname}/>\n            <UserSideBar/>\n            {this.switchRender()}\n            <AdSpace/>\n            <Bottom/>\n            </div>\n        )\n\n\n    }\n\n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n  };\n\n\nexport default connect(mapStateToProps) (Sold);\n\n"]},"metadata":{},"sourceType":"module"}