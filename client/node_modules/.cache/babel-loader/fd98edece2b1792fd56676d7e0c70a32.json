{"ast":null,"code":"var _jsxFileName = \"/home/katja/REACT/test-app/src/pages/Publish/EditPage.jsx\";\nimport React from 'react';\nimport axios from 'axios';\nimport { NavLink } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { saveAtt } from '../../redux/actions';\nimport { doUpload } from '../../functions/index';\nimport queryString from 'query-string';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport ImgUpload from './ImgUpload';\nimport SelectForms from './SelectForms';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport ClipLoader from 'react-spinners/ClipLoader';\nimport '../../App.css';\n\nclass EditPage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.abortController = new AbortController();\n    this.axiosSignal = axios.CancelToken.source();\n\n    this.checkIfAll = () => {\n      let check = true;\n      const selection = this.state.selection;\n      Object.keys(selection).forEach(key => {\n        if (key !== 'brand' && key !== 'descrtext') {\n          if (selection[key] === 0 && selection.category !== 3 || selection[key] === null || selection[key] === '') {\n            check = false;\n            this.setState({\n              warning: 'Izpolni vsa polja'\n            });\n          }\n        }\n      });\n\n      if (this.state.photos.length < 3 && this.state.photos.length !== 0) {\n        check = false;\n        this.setState({\n          warning: 'Izberi tri fotografije'\n        });\n      }\n\n      return check;\n    };\n\n    this.onImageSaved = (photo, index) => {\n      if (this.state.photos.length <= index) {\n        this.setState(state => {\n          const photos = state.photos.concat(photo);\n          return {\n            photos\n          };\n        });\n      } else {\n        this.setState(state => {\n          const photos = state.photos.map((item, j) => {\n            if (j === index) {\n              return photo;\n            } else {\n              return item;\n            }\n          });\n          return {\n            photos\n          };\n        });\n      }\n    };\n\n    this.onSelectionSaved = selection => {\n      this.setState({\n        selection\n      });\n    };\n\n    this.state = {\n      userId: '0',\n      adId: '',\n      uploadedPhotos: [],\n      photos: [],\n      urls: [],\n      fileWarning: '',\n      warning: '',\n      srcsToPass: [],\n      editStatus: false,\n      selection: {\n        category: '',\n        subcategory: '',\n        clothsize: '',\n        material: '',\n        condition: '',\n        brand: '',\n        descrtext: '',\n        weight: null,\n        price: null\n      },\n      loading: false\n    };\n    this.handleUpload = this.handleUpload.bind(this);\n  }\n\n  componentDidMount() {\n    fetch('/sessionroutes', {\n      signal: this.abortController.signal\n    }).then(res => res.json()).then(res => this.setState({\n      userId: res.userId\n    })).catch(e => console.error(\"Critical failure: \" + e.message));\n    const adId = this.props.adId;\n\n    if (adId !== '') {\n      fetch('/fillform', {\n        signal: this.abortController.signal,\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify({\n          adId: adId\n        })\n      }).then(res => res.json()).then(res => this.setState(state => {\n        let arr = [res[0].photo1_url, res[0].photo2_url, res[0].photo3_url];\n        let srcsToPass = state.srcsToPass.concat(arr);\n        return {\n          srcsToPass\n        };\n      })).catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n  }\n\n  componentWillUnmount() {\n    this.abortController.abort();\n    this.axiosSignal.cancel('Api is being canceled');\n  }\n\n  handleUpload() {\n    this.props.saveAtt(true);\n\n    if (!this.checkIfAll()) {\n      this.setState({\n        warning: \"IZPOLNI VSA POLJA!\"\n      });\n    } else {\n      this.setState({\n        loading: true\n      });\n\n      if (this.state.photos.length === 3) {\n        doUpload('edit', this.state.selection, this.props.loggedInUserId, this.props.loggedInUser, this.axiosSignal, this.props.adId, this.state.photos).then(() => this.setState({\n          editStatus: true,\n          loading: false\n        })).catch(e => console.error(\"Critical failure: \" + e.message));\n      } else {\n        doUpload('edit', this.state.selection, this.props.loggedInUserId, this.props.loggedInUser, this.abortController.signal, this.props.adId).then(() => this.setState({\n          editStatus: true,\n          loading: false\n        })).catch(e => console.error(\"Critical failure: \" + e.message));\n      }\n    }\n  }\n\n  render() {\n    const adId = queryString.stringify(queryString.parse(this.props.location.search));\n\n    if (this.state.userId === '0') {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"App\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(UpperLine, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(Header, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(NavBar, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(BreadCrumbs, {\n        pathname: this.props.location.pathname,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          backgroundColor: 'rgb(255,255,255,0.5)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 30\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 35\n        }\n      }), /*#__PURE__*/React.createElement(\"h2\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 25\n        }\n      }, \"PROSIMO PRIJAVITE SE V SISTEM!\"), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 30\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 35\n        }\n      })), /*#__PURE__*/React.createElement(Bottom, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 21\n        }\n      }));\n    } else if (this.state.editStatus) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"App\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 20\n        }\n      }, /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 27\n        }\n      }), /*#__PURE__*/React.createElement(\"h1\", {\n        style: {\n          backgroundColor: 'rgb(255, 255, 255, 0.5)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 22\n        }\n      }, \"USPE\\u0160NO STE POPRAVILI OGLAS!\"), /*#__PURE__*/React.createElement(NavLink, {\n        exact: true,\n        to: \"/user_listings\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 22\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 59\n        }\n      }, \"NAZAJ NA MOJO STRAN\")));\n    } else if (srcsToPass !== 0) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"App\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 10\n        }\n      }, /*#__PURE__*/React.createElement(UpperLine, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 14\n        }\n      }), /*#__PURE__*/React.createElement(Header, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 14\n        }\n      }), /*#__PURE__*/React.createElement(BreadCrumbs, {\n        pathname: this.props.location.pathname,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 14\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          display: \"flex\",\n          width: \"90vw\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 14\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"sidenav\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 18\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          width: \"100%\",\n          backgroundColor: 'rgb(255, 255, 255, 0.5)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 18\n        }\n      }, /*#__PURE__*/React.createElement(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 22\n        }\n      }, \"POPRAVI OGLAS\"), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(SelectForms, {\n        callBackParent: onSelectionSaved,\n        saveAtt: state.saveAttempt,\n        adId: adId,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 22\n        }\n      }, \"OBDR\\u017DI TRENUTNE FOTOGRAFIJE:\"), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"img\", {\n        src: srcsToPass[0],\n        alt: \"image_one\",\n        height: \"200px\",\n        hspace: \"20\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"img\", {\n        src: srcsToPass[1],\n        alt: \"image_two\",\n        height: \"200px\",\n        hspace: \"20\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"img\", {\n        src: srcsToPass[2],\n        alt: \"image_three\",\n        height: \"200px\",\n        hspace: \"20\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 22\n        }\n      }, \"ALI IZBERI NOVE FOTOGRAFIJE:\"), /*#__PURE__*/React.createElement(ImgUpload, {\n        callBackParent: onImageSaved,\n        index: \"0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(ImgUpload, {\n        callBackParent: onImageSaved,\n        index: \"1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(ImgUpload, {\n        callBackParent: onImageSaved,\n        index: \"2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 22\n        }\n      }), !state.loading && /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btnb\",\n        onClick: handleUpload,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 41\n        }\n      }, \"SHRANI OGLAS\"), /*#__PURE__*/React.createElement(ClipLoader, {\n        size: 50,\n        color: \"#123abc\",\n        loading: state.loading,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"p\", {\n        style: {\n          color: \"red\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 22\n        }\n      }, state.warning))), /*#__PURE__*/React.createElement(Bottom, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 14\n        }\n      }));\n    } else return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 22\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      style: {\n        backgroundColor: 'rgb(255, 255, 255, 0.5)'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 43\n      }\n    }, \"Something went wrong\"));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    loggedInUser: state.loggedInUser,\n    loggedInUserId: state.loggedInUserId\n  };\n};\n\nconst mapDispatchToProps = {\n  saveAtt: saveAtt\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(EditPage);","map":{"version":3,"sources":["/home/katja/REACT/test-app/src/pages/Publish/EditPage.jsx"],"names":["React","axios","NavLink","connect","saveAtt","doUpload","queryString","UpperLine","Header","NavBar","ImgUpload","SelectForms","Bottom","BreadCrumbs","ClipLoader","EditPage","Component","constructor","props","abortController","AbortController","axiosSignal","CancelToken","source","checkIfAll","check","selection","state","Object","keys","forEach","key","category","setState","warning","photos","length","onImageSaved","photo","index","concat","map","item","j","onSelectionSaved","userId","adId","uploadedPhotos","urls","fileWarning","srcsToPass","editStatus","subcategory","clothsize","material","condition","brand","descrtext","weight","price","loading","handleUpload","bind","componentDidMount","fetch","signal","then","res","json","catch","e","console","error","message","method","headers","body","JSON","stringify","arr","photo1_url","photo2_url","photo3_url","componentWillUnmount","abort","cancel","loggedInUserId","loggedInUser","render","parse","location","search","pathname","backgroundColor","display","width","saveAttempt","color","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport axios from 'axios';\nimport { NavLink } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { saveAtt } from '../../redux/actions';\nimport {doUpload} from '../../functions/index';\nimport queryString from 'query-string';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport ImgUpload from './ImgUpload';\nimport SelectForms from './SelectForms';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport ClipLoader from 'react-spinners/ClipLoader';\nimport '../../App.css';\n\n\nclass EditPage extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            userId: '0',\n            adId: '',\n            uploadedPhotos: [],\n            photos: [],\n            urls: [],\n            fileWarning: '',\n            warning: '',\n            srcsToPass: [],\n            editStatus: false,\n            selection: {\n                category: '',\n                subcategory: '',\n                clothsize: '',\n                material: '',\n                condition: '',\n                brand: '',\n                descrtext: '',\n                weight: null,\n                price: null\n            },\n            loading: false\n        };\n        this.handleUpload = this.handleUpload.bind(this);\n    }\n\n    abortController = new AbortController();\n    axiosSignal = axios.CancelToken.source();\n\n    componentDidMount() {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => this.setState({userId: res.userId}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n\n        const adId = this.props.adId;\n        if(adId !== '') {\n            fetch('/fillform', {\n                signal: this.abortController.signal,\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json'\n                },\n                body: JSON.stringify({adId: adId})\n            }).then(res => res.json())\n                .then(res => this.setState(state => {\n                    let arr = [res[0].photo1_url, res[0].photo2_url, res[0].photo3_url];\n                    let srcsToPass = state.srcsToPass.concat(arr);\n                    return {srcsToPass};\n                    }))\n\n                .catch(e => console.error(\"Critical failure: \" + e.message));           \n        }\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n        this.axiosSignal.cancel('Api is being canceled');\n    }\n\n    checkIfAll = () => {\n        let check = true;\n        const selection = this.state.selection;\n        Object.keys(selection).forEach(key => {\n            if(key !== 'brand' && key !== 'descrtext') {\n                if((selection[key] === 0 && selection.category !== 3) || selection[key] === null || selection[key] === '') {\n                    check = false;\n                    this.setState({warning: 'Izpolni vsa polja'});\n                }\n            }\n        });\n        if (this.state.photos.length < 3 && this.state.photos.length !== 0) {\n            check = false;\n            this.setState({warning: 'Izberi tri fotografije'});\n        }\n        return check;\n    }\n\n    onImageSaved = (photo, index) => {\n        if (this.state.photos.length <= index) {\n            this.setState(state => {\n                const photos = state.photos.concat(photo);\n                return {photos};\n            });\n        } else {\n            this.setState(state => {\n                const photos = state.photos.map((item, j) => {\n                    if (j === index) {\n                        return photo;\n                    } else {\n                        return item;\n                    }\n                });\n                return {photos};\n            });\n        }\n    }\n\n    onSelectionSaved = (selection) => {\n        this.setState({selection});\n    }\n\n    handleUpload() {\n        this.props.saveAtt(true);    \n        if (!this.checkIfAll()) {\n            this.setState({warning: \"IZPOLNI VSA POLJA!\"}); \n        }else {\n            this.setState({loading: true})\n            if(this.state.photos.length === 3) {\n                doUpload('edit', this.state.selection, this.props.loggedInUserId, this.props.loggedInUser, this.axiosSignal, this.props.adId, this.state.photos)\n                .then(() => this.setState({editStatus: true, loading: false}))\n                .catch(e => console.error(\"Critical failure: \" + e.message));\n            } else {\n                doUpload('edit', this.state.selection, this.props.loggedInUserId, this.props.loggedInUser, this.abortController.signal, this.props.adId)\n                .then(() => this.setState({editStatus: true, loading: false}))\n                .catch(e => console.error(\"Critical failure: \" + e.message));\n            }\n        }\n    }\n\n    render() {\n        const adId = queryString.stringify(queryString.parse(this.props.location.search));\n        if(this.state.userId === '0') {\n            return (\n                <div className = 'App'>\n                    <UpperLine/>\n                    <Header/>\n                    <NavBar/>\n                    <BreadCrumbs pathname = {this.props.location.pathname}/>\n                    <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                        <br/><br/><br/>\n                        <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                        <br/><br/><br/>\n                    </div>\n                    <Bottom/>\n                </div>\n            )\n        }\n        else if(this.state.editStatus) {\n            return <div className=\"App\">\n                     <br/><br/>\n                     <h1 style={{backgroundColor: 'rgb(255, 255, 255, 0.5)'}}>USPEŠNO STE POPRAVILI OGLAS!</h1>\n                     <NavLink exact to = '/user_listings'><button className = 'btn'>NAZAJ NA MOJO STRAN</button></NavLink>\n                 </div>\n        } else if(srcsToPass !== 0) {\n         return (\n         <div className=\"App\">\n             <UpperLine/>\n             <Header/>\n             <BreadCrumbs pathname = {this.props.location.pathname}/>\n             <div style={{display: \"flex\", width: \"90vw\"}}>\n                 <div className=\"sidenav\"></div>\n                 <div style={{width: \"100%\", backgroundColor: 'rgb(255, 255, 255, 0.5)'}}>\n                     <h1>POPRAVI OGLAS</h1>\n                     <br/>\n                     <SelectForms callBackParent={onSelectionSaved} saveAtt ={state.saveAttempt} adId={adId}/>\n                     <br/>\n                     <p>OBDRŽI TRENUTNE FOTOGRAFIJE:</p>\n                     <br/>\n                     <img src={srcsToPass[0]} alt=\"image_one\" height=\"200px\" hspace=\"20\"/>\n                     <img src={srcsToPass[1]} alt=\"image_two\" height=\"200px\" hspace=\"20\"/>\n                     <img src={srcsToPass[2]} alt=\"image_three\" height=\"200px\" hspace=\"20\"/>\n                     <br/>\n                     <br/>\n                     <p>ALI IZBERI NOVE FOTOGRAFIJE:</p>\n                     <ImgUpload callBackParent={onImageSaved} index='0'/>\n                     <ImgUpload callBackParent={onImageSaved} index='1'/>\n                     <ImgUpload callBackParent={onImageSaved} index='2'/>\n                     {!state.loading && <button className = 'btnb' onClick={handleUpload}>SHRANI OGLAS</button>}\n                     <ClipLoader\n                         size={50}\n                         color={\"#123abc\"}\n                         loading={state.loading}\n                     />\n                     <p style={{color: \"red\"}}>{state.warning}</p>\n                 </div>\n             </div>\n             <Bottom/>\n         </div>\n         )}\n         else return <div className=\"App\"><h1 style={{backgroundColor: 'rgb(255, 255, 255, 0.5)'}}>Something went wrong</h1></div>}\n    }\n\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n};\n\nconst mapDispatchToProps = {\n    saveAtt: saveAtt\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (EditPage);\n"]},"metadata":{},"sourceType":"module"}