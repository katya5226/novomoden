{"ast":null,"code":"var _jsxFileName = \"/home/katja/REACT/test-app/src/pages/ShoppingCart/OrderPage.jsx\";\nimport React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { logIn, logOut } from '../../redux/actions';\nimport OrderListing from './OrderListing';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport NavBar from '../../components/NavBar';\nimport ClipLoader from 'react-spinners/ClipLoader';\n\nclass OrderPage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.abortController = new AbortController();\n\n    this.cancelOrder = () => {\n      fetch('/orderroutes', {\n        signal: this.abortController.signal,\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify({\n          type: 1,\n          ids: []\n        })\n      }).then(() => this.setState({\n        canceled: true\n      })).catch(e => console.error(\"Critical failure: \" + e.message));\n    };\n\n    this.removeFromCart = () => {\n      let cart = JSON.parse(window.localStorage.getItem(this.props.loggedInUserId));\n      const adIds = this.state.adIds;\n      adIds.forEach(adId => {\n        cart.splice(cart.indexOf(adId.toString()), 1);\n      });\n      window.localStorage.setItem(this.props.loggedInUserId, JSON.stringify(cart));\n    };\n\n    this.finishOrder = () => {\n      this.setState({\n        loading: true\n      });\n      const price = this.priceSum(this.state.order, this.state.order.length);\n      const postage = this.postageSum(this.state.order, this.state.order.length);\n      fetch('/orderroutes', {\n        signal: this.abortController.signal,\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify({\n          type: 3,\n          order: {\n            ids: this.state.adIds,\n            price: price,\n            postage: postage,\n            seller_id: this.state.order[0].user_id,\n            seller: this.state.order[0].username,\n            status: 1\n          }\n        })\n      }).then(res => res.json()).then(res => {\n        console.log(res.success);\n\n        if (res.success) {\n          this.setState({\n            finished: true,\n            loading: false\n          }, () => console.log(this.state));\n        } else {\n          this.setState({\n            finished: true,\n            error: true\n          }, () => console.log(this.state));\n        }\n\n        this.removeFromCart();\n      }).catch(e => console.error(\"Critical failure: \" + e.message));\n    };\n\n    this.handleOrder = () => {\n      this.setState({\n        orderStatus: 'ORDERED!'\n      });\n    };\n\n    this.priceSum = (order, n) => {\n      let price = 0;\n\n      for (let i = 0; i < n; i++) {\n        price += order[i].price;\n      }\n\n      return price;\n    };\n\n    this.postageSum = (order, n) => {\n      let weight = 0;\n      let postage = 0;\n\n      for (let i = 0; i < n; i++) {\n        weight += order[i].weight;\n      }\n\n      postage = weight / 100 + 1;\n      return postage;\n    };\n\n    this.switchRender = () => {\n      const order = this.state.order;\n      const n = order.length;\n      const price = this.priceSum(order, n);\n      const postage = this.postageSum(order, n);\n\n      if (!n) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          style: {\n            backgroundColor: 'rgb(255,255,255,0.7)',\n            margin: '0 auto'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 20\n          }\n        }, /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 148,\n            columnNumber: 25\n          }\n        }), /*#__PURE__*/React.createElement(\"h1\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 25\n          }\n        }, \"O NE! NEKAJ JE \\u0160LO NAROBE. IZDELKI NISO VE\\u010C NA VOLJO.\"), /*#__PURE__*/React.createElement(\"button\", {\n          className: \"btnb\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 25\n          }\n        }, /*#__PURE__*/React.createElement(NavLink, {\n          exact: true,\n          to: \"/shoppingcart\",\n          style: {\n            color: 'black',\n            textDecoration: 'none'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 52\n          }\n        }, \"NAZAJ NA KO\\u0160ARICO\")), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151,\n            columnNumber: 25\n          }\n        }));\n      } else if (n && !this.state.canceled && !this.state.finished) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          style: {\n            padding: '30px',\n            margin: '0 auto'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 20\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          style: {\n            backgroundColor: 'rgb(255,255,255,0.7)',\n            margin: '0 auto'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 21\n          }\n        }, /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 25\n          }\n        }), this.state.order.map(item => /*#__PURE__*/React.createElement(OrderListing, {\n          key: item.ad_id,\n          description: item,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 55\n          }\n        })), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 25\n          }\n        }), /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 25\n          }\n        }, /*#__PURE__*/React.createElement(\"p\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 29\n          }\n        }, \"Cena: \", price, \" \\u20AC\"), /*#__PURE__*/React.createElement(\"p\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 29\n          }\n        }, \"Cena po\\u0161tnine: \", postage, \" \\u20AC\"), /*#__PURE__*/React.createElement(\"p\", {\n          style: {\n            fontWeight: 'bold'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 29\n          }\n        }, \"Skupaj: \", price + postage, \" \\u20AC\"), /*#__PURE__*/React.createElement(\"button\", {\n          className: \"btnb\",\n          onClick: this.finishOrder,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 29\n          }\n        }, \"ZAKLJU\\u010CI NARO\\u010CILO\"), /*#__PURE__*/React.createElement(\"button\", {\n          className: \"btnb\",\n          onClick: this.cancelOrder,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 29\n          }\n        }, \"PREKLI\\u010CI NARO\\u010CILO\"), /*#__PURE__*/React.createElement(ClipLoader, {\n          size: 50,\n          color: \"#123abc\",\n          loading: this.state.loading,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 29\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 29\n          }\n        }), /*#__PURE__*/React.createElement(\"p\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 29\n          }\n        }, this.state.orderStatus)), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 25\n          }\n        })));\n      } else if (this.state.canceled && !this.state.finished) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          style: {\n            backgroundColor: 'rgb(255,255,255,0.7)',\n            margin: '0 auto'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 20\n          }\n        }, /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 25\n          }\n        }), /*#__PURE__*/React.createElement(\"h1\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 25\n          }\n        }, \"NARO\\u010CILO PREKLICANO!\"), /*#__PURE__*/React.createElement(\"button\", {\n          className: \"btnb\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 25\n          }\n        }, /*#__PURE__*/React.createElement(NavLink, {\n          exact: true,\n          to: \"/shoppingcart\",\n          style: {\n            color: 'black',\n            textDecoration: 'none'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 52\n          }\n        }, \"NAZAJ NA KO\\u0160ARICO\")), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 25\n          }\n        }));\n      } else if (this.state.finished && !this.state.canceled) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          style: {\n            backgroundColor: 'rgb(255,255,255,0.7)',\n            margin: '0 auto'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 20\n          }\n        }, /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 25\n          }\n        }), !this.state.error && /*#__PURE__*/React.createElement(\"h1\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 47\n          }\n        }, \"NARO\\u010CILO ZAKLJU\\u010CENO!\"), this.state.error && /*#__PURE__*/React.createElement(\"h1\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 46\n          }\n        }, \"NAPAKA! EDEN ALI VE\\u010C IZDELKOV \\u017DAL NI VE\\u010C NA VOLJO!\"), /*#__PURE__*/React.createElement(\"button\", {\n          className: \"btnb\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 25\n          }\n        }, /*#__PURE__*/React.createElement(NavLink, {\n          exact: true,\n          to: \"/\",\n          style: {\n            color: 'black',\n            textDecoration: 'none'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 52\n          }\n        }, \"DOMOV\")), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 25\n          }\n        }));\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 20\n          }\n        }, /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 25\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 30\n          }\n        }));\n      }\n    };\n\n    this.state = {\n      orderStatus: '',\n      adIds: [],\n      order: [],\n      fetching: true,\n      canceled: false,\n      finished: false,\n      error: false,\n      loading: false\n    };\n  }\n\n  componentDidMount() {\n    fetch('/orderroutes', {\n      signal: this.abortController.signal,\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      body: JSON.stringify({\n        type: 2\n      })\n    }).then(res => res.json()).then(res => {\n      const adIds = JSON.parse(res);\n      this.setState({\n        adIds\n      });\n      adIds.length && fetch('/cartListings', {\n        signal: this.abortController.signal,\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify(adIds)\n      }).then(res => res.json()).then(res => {\n        this.setState({\n          order: res\n        });\n      }) //.then(res => console.log(res))\n      .catch(e => console.error(\"Critical failure: \" + e.message));\n    }).catch(e => console.error(\"Critical failure: \" + e.message));\n  }\n\n  componentWillUnmount() {\n    this.abortController.abort();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 16\n      }\n    }, /*#__PURE__*/React.createElement(UpperLine, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(Header, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(NavBar, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(BreadCrumbs, {\n      pathname: this.props.location.pathname,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 21\n      }\n    }), this.switchRender(), /*#__PURE__*/React.createElement(Bottom, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 21\n      }\n    }));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    loggedInUser: state.loggedInUser,\n    loggedInUserId: state.loggedInUserId\n  };\n};\n\nconst mapDispatchToProps = {\n  logIn: logIn,\n  logOut: logOut\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(OrderPage);","map":{"version":3,"sources":["/home/katja/REACT/test-app/src/pages/ShoppingCart/OrderPage.jsx"],"names":["React","NavLink","connect","logIn","logOut","OrderListing","UpperLine","Header","Bottom","BreadCrumbs","NavBar","ClipLoader","OrderPage","Component","constructor","props","abortController","AbortController","cancelOrder","fetch","signal","method","headers","body","JSON","stringify","type","ids","then","setState","canceled","catch","e","console","error","message","removeFromCart","cart","parse","window","localStorage","getItem","loggedInUserId","adIds","state","forEach","adId","splice","indexOf","toString","setItem","finishOrder","loading","price","priceSum","order","length","postage","postageSum","seller_id","user_id","seller","username","status","res","json","log","success","finished","handleOrder","orderStatus","n","i","weight","switchRender","backgroundColor","margin","color","textDecoration","padding","map","item","ad_id","fontWeight","fetching","componentDidMount","componentWillUnmount","abort","render","location","pathname","mapStateToProps","loggedInUser","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { logIn, logOut } from '../../redux/actions';\nimport OrderListing from './OrderListing';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport NavBar from '../../components/NavBar';\nimport ClipLoader from 'react-spinners/ClipLoader';\n\n\nclass OrderPage extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            orderStatus: '',\n            adIds: [],\n            order: [],\n            fetching: true,\n            canceled: false,\n            finished: false,\n            error: false,\n            loading: false\n        };\n    }\n\n    abortController = new AbortController();\n\n    componentDidMount() {\n        fetch('/orderroutes', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                type: 2,\n            })\n        }).then(res => res.json())\n            .then(res => { const adIds = JSON.parse(res); this.setState({adIds});\n                (adIds.length) && fetch('/cartListings', {\n                                    signal: this.abortController.signal,\n                                    method: 'POST',\n                                    headers: {\n                                        'Content-Type': 'application/json',\n                                        'Accept': 'application/json'\n                                    },\n                                    body: JSON.stringify(adIds)\n                                }).then(res => res.json())\n                                    .then(res => {this.setState({order: res})})\n                                    //.then(res => console.log(res))\n                                    .catch(e => console.error(\"Critical failure: \" + e.message));})\n            .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    cancelOrder = () => {\n        fetch('/orderroutes', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                type: 1,\n                ids: []\n            })\n        }).then(() => this.setState({canceled: true}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    removeFromCart = () => {\n        let cart = JSON.parse(window.localStorage.getItem(this.props.loggedInUserId));\n        const adIds = this.state.adIds;\n        adIds.forEach(adId => {\n            cart.splice(cart.indexOf(adId.toString()), 1);\n        })\n        window.localStorage.setItem(this.props.loggedInUserId, JSON.stringify(cart));\n    }\n\n    finishOrder = () => {\n        this.setState({loading: true});\n        const price = this.priceSum(this.state.order, this.state.order.length);\n        const postage = this.postageSum(this.state.order, this.state.order.length);\n        fetch('/orderroutes', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                type: 3,\n                order: {\n                    ids: this.state.adIds,\n                    price: price,\n                    postage: postage,\n                    seller_id: this.state.order[0].user_id,\n                    seller: this.state.order[0].username,\n                    status: 1\n                }\n\n            })\n        }).then(res => res.json())\n        .then(res => {console.log(res.success); if (res.success) {this.setState({finished: true, loading: false}, () => console.log(this.state));} else {this.setState({finished: true, error: true}, () => console.log(this.state));}\n                        this.removeFromCart();})\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n    }\n\n    handleOrder = () => {\n        this.setState({orderStatus: 'ORDERED!'});\n    }\n\n    priceSum = (order, n) => {\n        let price = 0;\n        for (let i = 0; i < n; i++) {\n            price += order[i].price;\n        }\n        return price;\n    }\n    postageSum = (order, n) => {\n        let weight = 0;\n        let postage = 0;\n        for (let i = 0; i < n; i++) {\n            weight += order[i].weight;\n        }\n        postage = weight/100 +1;\n        return postage;\n    }\n\n    switchRender = () => {\n\n        const order = this.state.order;\n        const n = order.length;\n        const price = this.priceSum(order, n);\n        const postage = this.postageSum(order, n);\n\n        if (!n) {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.7)', margin:'0 auto'}}>\n                        <br/>\n                        <h1>O NE! NEKAJ JE ŠLO NAROBE. IZDELKI NISO VEČ NA VOLJO.</h1>\n                        <button className = 'btnb'><NavLink exact to = '/shoppingcart' style={{color:'black', textDecoration:'none'}}>NAZAJ NA KOŠARICO</NavLink></button>\n                        <br/>\n                    </div>\n        }\n        else if (n && !this.state.canceled && !this.state.finished) {\n            return <div style = {{padding: '30px', margin: '0 auto'}}>\n                    <div style = {{backgroundColor: 'rgb(255,255,255,0.7)', margin:'0 auto'}}>\n                        <br/>\n                        {this.state.order.map(item => <OrderListing key ={item.ad_id} description = {item}/>)}\n                        <br/>\n                        <div>\n                            <p>Cena: {price} €</p>\n                            <p>Cena poštnine: {postage} €</p>\n                            <p style = {{fontWeight: 'bold'}}>Skupaj: {price + postage} €</p>\n                            <button className = 'btnb' onClick = {this.finishOrder}>ZAKLJUČI NAROČILO</button>\n                            <button className = 'btnb' onClick = {this.cancelOrder}>PREKLIČI NAROČILO</button>\n                            <ClipLoader\n                                size={50}\n                                color={\"#123abc\"}\n                                loading={this.state.loading}\n                            />\n                            <br/>\n                            <p>{this.state.orderStatus}</p>\n                        </div>\n                        <br/>\n                    </div>\n                </div>\n        } else if (this.state.canceled && !this.state.finished) {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.7)', margin:'0 auto'}}>\n                        <br/>\n                        <h1>NAROČILO PREKLICANO!</h1>\n                        <button className = 'btnb'><NavLink exact to = '/shoppingcart' style={{color:'black', textDecoration:'none'}}>NAZAJ NA KOŠARICO</NavLink></button>\n                        <br/>\n                    </div>\n        } else if (this.state.finished && !this.state.canceled) {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.7)', margin:'0 auto'}}>\n                        <br/>\n                        {!this.state.error && <h1>NAROČILO ZAKLJUČENO!</h1>}\n                        {this.state.error && <h1>NAPAKA! EDEN ALI VEČ IZDELKOV ŽAL NI VEČ NA VOLJO!</h1>}\n                        <button className = 'btnb'><NavLink exact to = '/' style={{color:'black', textDecoration:'none'}}>DOMOV</NavLink></button>\n                        <br/>\n                    </div>\n        } else {\n            return <div><br/><br/></div>\n        }\n\n    }\n\n    render() {\n        return <div className=\"App\">\n                    <UpperLine/>\n                    <Header/>\n                    <NavBar/>\n                    <BreadCrumbs pathname = {this.props.location.pathname}/>\n                    {this.switchRender()}\n                    <Bottom/>\n                </div>\n  \n    }\n    \n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n  };\n  \n  const mapDispatchToProps = {\n    logIn: logIn,\n    logOut: logOut\n  };\n\nexport default connect(mapStateToProps, mapDispatchToProps) (OrderPage);\n"]},"metadata":{},"sourceType":"module"}