{"ast":null,"code":"import _objectSpread from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{connect}from'react-redux';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import{NavLink}from'react-router-dom';import BreadCrumbs from'../../components/BreadCrumbs';import NavBar from'../../components/NavBar';import Bottom from'../../components/Bottom';import AdSpace from'../../components/AdSpace';import'../../App.css';var ChatPage=/*#__PURE__*/function(_Component){_inherits(ChatPage,_Component);var _super=_createSuper(ChatPage);function ChatPage(props){var _this;_classCallCheck(this,ChatPage);_this=_super.call(this,props);_this.abortController=new AbortController();_this.conversationsFetch=function(){fetch('/fetchconversations',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'}}).then(function(res){return res.json();}).then(function(res){var conversations=res;var unread=[];for(var i=0;i<res.length;i++){unread.push(0);}var numPages=Math.floor(res.length/_this.state.perPage+0.99);_this.setState(function(state){return _objectSpread({},state,{conversations:conversations,unread:unread,numPages:numPages});},function(){for(var _i=0;_i<res.length;_i++){var iLId=0;res[_i].id1.toString()===_this.props.loggedInUserId?iLId=res[_i].id2:iLId=res[_i].id1;_this.fetchNumberOfUnread(_i,iLId);}});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.fetchNumberOfUnread=function(i,iLId){fetch('/fetchunread',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({iLId:iLId})}).then(function(res){return res.json();}).then(function(res){_this.setState(function(state){var unread=state.unread.map(function(num,j){if(j===i){return res;}else return num;});return _objectSpread({},state,{unread:unread});});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.paginationButtonClick=function(e){var newpage=1;switch(e.target.id){case'first':_this.setState({page:1});break;case'previous':_this.state.page>1?newpage=_this.state.page-1:newpage=1;_this.setState({page:newpage});break;case'next':_this.state.page<_this.state.numPages?newpage=_this.state.page+1:newpage=_this.state.numPages;_this.setState({page:newpage});break;case'last':_this.setState({page:_this.state.numPages});break;default:return null;}};_this.switchRender=function(){var numConvers=_this.state.conversations.length;var n=_this.state.perPage;var p=_this.state.page-1;var till;p*n+n<numConvers?till=(p+1)*n:till=numConvers;var conversPortion=_this.state.conversations.slice(p*n,till);if(_this.state.userId==='0'){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"PROSIMO PRIJAVITE SE V SISTEM!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}else return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255, 255, 255, 0.7)',textAlign:'left',paddingLeft:'100px',paddingBottom:'50px'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"POGOVORI:\"),conversPortion.map(function(conv,index){var iLId=0;var conversant='';conv.id1===parseInt(_this.props.loggedInUserId)?iLId=conv.id2:iLId=conv.id1;conv.conversant1===_this.props.loggedInUser?conversant=conv.conversant2:conversant=conv.conversant1;var numunread='';if(_this.state.unread[index])numunread='('+_this.state.unread[index]+')';return/*#__PURE__*/React.createElement(\"li\",{key:index,style:{listStyleType:'none',paddingLeft:'200px',paddingTop:'10px'}},/*#__PURE__*/React.createElement(NavLink,{style:{color:'black',textTransform:'uppercase',fontWeight:'bold'},exact:true,to:'/chatpage/conversation?'+iLId},conversant+numunread));})),/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'left',paddingLeft:'12px'}},/*#__PURE__*/React.createElement(\"button\",{id:\"first\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"PRVA\"),/*#__PURE__*/React.createElement(\"button\",{id:\"previous\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"<<\"),/*#__PURE__*/React.createElement(\"button\",{id:\"current\",className:\"btn_nopad\"},_this.state.page,\"/\",_this.state.numPages),/*#__PURE__*/React.createElement(\"button\",{id:\"next\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\">>\"),/*#__PURE__*/React.createElement(\"button\",{id:\"last\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"ZADNJA\")));};_this.state={userId:'0',conversations:[],unread:[],perPage:10,numPages:1,page:1};return _this;}_createClass(ChatPage,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;fetch('/sessionroutes',{signal:this.abortController.signal}).then(function(res){return res.json();}).then(function(res){return _this2.setState({userId:res.userId});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});this.conversationsFetch();this.interval=setInterval(function(){_this2.conversationsFetch();},30000);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();clearInterval(this.interval);}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:this.props.location.pathname}),this.switchRender(),/*#__PURE__*/React.createElement(AdSpace,null),/*#__PURE__*/React.createElement(Bottom,null));}}]);return ChatPage;}(Component);var mapStateToProps=function mapStateToProps(state){return{loggedInUser:state.loggedInUser,loggedInUserId:state.loggedInUserId};};export default connect(mapStateToProps)(ChatPage);","map":{"version":3,"sources":["/home/katni/APP/client/src/pages/Chat/ChatPage.jsx"],"names":["React","Component","connect","UpperLine","Header","NavLink","BreadCrumbs","NavBar","Bottom","AdSpace","ChatPage","props","abortController","AbortController","conversationsFetch","fetch","signal","method","headers","then","res","json","conversations","unread","i","length","push","numPages","Math","floor","state","perPage","setState","iLId","id1","toString","loggedInUserId","id2","fetchNumberOfUnread","catch","e","console","error","message","body","JSON","stringify","map","num","j","paginationButtonClick","newpage","target","id","page","switchRender","numConvers","n","p","till","conversPortion","slice","userId","backgroundColor","textAlign","paddingLeft","paddingBottom","conv","index","conversant","parseInt","conversant1","loggedInUser","conversant2","numunread","listStyleType","paddingTop","color","textTransform","fontWeight","interval","setInterval","abort","clearInterval","location","pathname","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport { NavLink } from 'react-router-dom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport NavBar from '../../components/NavBar';\nimport Bottom from '../../components/Bottom';\nimport AdSpace from '../../components/AdSpace';\nimport '../../App.css';\n\n\nclass ChatPage extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n        this.state = {\n            userId: '0',\n            conversations: [],\n            unread: [],\n            perPage: 10,\n            numPages: 1,\n            page: 1\n        }\n    }\n\n    abortController = new AbortController();\n    componentDidMount() {\n\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => this.setState({userId: res.userId}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n\n        this.conversationsFetch();\n        this.interval = setInterval(() => {this.conversationsFetch();}, 30000);\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n        clearInterval(this.interval);\n    }\n\n    conversationsFetch = () => {\n        fetch('/fetchconversations', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            }\n        })\n        .then(res => res.json())\n        .then(res => {const conversations = res; let unread = []; for(let i = 0; i < res.length; i++) unread.push(0); const numPages = Math.floor(res.length/this.state.perPage + 0.99);\n            this.setState(state => {return {...state, conversations, unread, numPages}}, () => {for(let i = 0; i < res.length; i++) {\n                let iLId = 0;\n                res[i].id1.toString() === this.props.loggedInUserId ? iLId = res[i].id2 : iLId = res[i].id1;\n                this.fetchNumberOfUnread(i, iLId);\n            }})\n        })\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    fetchNumberOfUnread = (i, iLId) => {\n        fetch('/fetchunread', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                iLId: iLId\n            })\n        })\n        .then(res => res.json())\n        .then(res => {this.setState(state => {\n                            const unread = state.unread.map((num, j) => {if (j === i) {return res;} else return num;});\n                            return ({...state, unread});\n                        });                    \n        })\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    paginationButtonClick = (e) => {\n        let newpage = 1;\n        switch(e.target.id) {\n            case 'first':\n                this.setState({page: 1});\n                break;\n            case 'previous':\n                this.state.page > 1 ? newpage = this.state.page-1 : newpage = 1;\n                this.setState({page: newpage});\n                break;\n            case 'next':\n                this.state.page < this.state.numPages ? newpage = this.state.page+1 : newpage = this.state.numPages;\n                this.setState({page: newpage});\n                break;\n            case 'last':\n                this.setState({page: this.state.numPages});\n                break;\n            default:\n                return null;\n        }\n    }\n\n    switchRender = () => {\n\n        let numConvers = this.state.conversations.length;\n        let n = this.state.perPage;\n        let p = this.state.page - 1;\n        let till;\n        p*n + n < numConvers ? till = (p+1)*n : till = numConvers;\n        let conversPortion = this.state.conversations.slice(p*n, till);\n\n        if (this.state.userId === '0') {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                <br/><br/><br/>\n                <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                <br/><br/><br/>\n            </div>\n        }\n        else return (\n        <>\n            <div style = {{backgroundColor: 'rgb(255, 255, 255, 0.7)', textAlign: 'left', paddingLeft: '100px', paddingBottom: '50px'}}>\n                <br/>\n                <h2>POGOVORI:</h2>\n                {conversPortion.map((conv, index) => {\n                    let iLId = 0;\n                    let conversant = '';\n                    conv.id1 === parseInt(this.props.loggedInUserId) ? iLId = conv.id2 : iLId = conv.id1;\n                    conv.conversant1 === this.props.loggedInUser ? conversant = conv.conversant2 : conversant = conv.conversant1;\n                    let numunread = '';\n                    if(this.state.unread[index]) numunread = '(' + this.state.unread[index] + ')';\n                    return <li key = {index} style = {{listStyleType: 'none', paddingLeft: '200px', paddingTop: '10px'}}>\n                                <NavLink\n                                    style = {{color: 'black', textTransform: 'uppercase', fontWeight: 'bold'}}\n                                    exact to = {'/chatpage/conversation?' + iLId}>{conversant + numunread}\n                                </NavLink>\n                            </li>\n                })}\n            </div>\n            <div style = {{textAlign: 'left', paddingLeft: '12px'}}>\n                <button id='first' className='btn_nopad' onClick={this.paginationButtonClick}>PRVA</button>\n                <button id='previous' className='btn_nopad' onClick={this.paginationButtonClick}>&#60;&#60;</button>\n                <button id='current' className='btn_nopad'>{this.state.page}/{this.state.numPages}</button>\n                <button id='next' className='btn_nopad' onClick={this.paginationButtonClick}>&#62;&#62;</button>\n                <button id='last' className='btn_nopad' onClick={this.paginationButtonClick}>ZADNJA</button>\n            </div>\n        </>)\n    }\n\n    render() {\n        return (\n            <div className=\"App\">\n            <UpperLine/>\n            <Header/>\n            <NavBar/>\n            <BreadCrumbs pathname = {this.props.location.pathname}/>\n            {this.switchRender()}\n            <AdSpace/>\n            <Bottom/>\n            </div>\n        )\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n};\n\nexport default connect(mapStateToProps) (ChatPage)"]},"metadata":{},"sourceType":"module"}