{"ast":null,"code":"import _classCallCheck from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{NavLink}from'react-router-dom';import{connect}from'react-redux';import{logIn,logOut}from'../../redux/actions';import OrderListing from'./OrderListing';import FinishOrderData from'./FinishOrderData';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import Bottom from'../../components/Bottom';import BreadCrumbs from'../../components/BreadCrumbs';import NavBar from'../../components/NavBar';import AdSpace from'../../components/AdSpace';import ClipLoader from'react-spinners/ClipLoader';var OrderPage=/*#__PURE__*/function(_React$Component){_inherits(OrderPage,_React$Component);var _super=_createSuper(OrderPage);function OrderPage(props){var _this;_classCallCheck(this,OrderPage);_this=_super.call(this,props);_this.abortController=new AbortController();_this.cancelOrder=function(){fetch('/sessionorder',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({type:1,ids:[]})}).then(function(){return _this.setState({canceled:true});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.removeFromCart=function(){var cart=JSON.parse(window.localStorage.getItem(_this.props.loggedInUserId));var adIds=_this.state.adIds;adIds.forEach(function(adId){cart.splice(cart.indexOf(adId.toString()),1);});window.localStorage.setItem(_this.props.loggedInUserId,JSON.stringify(cart));};_this.finishOrder=function(){_this.setState({loading:true});var price=_this.priceSum(_this.state.order,_this.state.order.length);var postage=_this.postageSum(_this.state.order,_this.state.order.length);fetch('/placeorder',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({order:{ids:_this.state.adIds,price:price,postage:postage,seller_id:_this.state.order[0].user_id,seller:_this.state.order[0].username,status:-1}})}).then(function(res){return res.json();}).then(function(res){return _this.setState({redirectUrl:res.redirectUrl});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.handleOrder=function(){_this.setState({orderStatus:'ORDERED!'});};_this.priceSum=function(order,n){var price=0;for(var i=0;i<n;i++){price+=order[i].price;}return price;};_this.postageSum=function(order,n){var weight=0;var postage=0;for(var i=0;i<n;i++){weight+=order[i].weight;}postage=weight<100?2:3;return postage;};_this.goToPage=function(redUrl){window.location.href=redUrl;};_this.switchRender=function(){var order=_this.state.order;var n=order.length;var price=_this.priceSum(order,n);var postage=_this.postageSum(order,n);if(_this.state.redirectUrl!==''){_this.goToPage(_this.state.redirectUrl);}else if(_this.state.userId==='0'){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"PROSIMO PRIJAVITE SE V SISTEM!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}else if(!n){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.7)',margin:'0 auto'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h1\",null,\"O NE! NEKAJ JE \\u0160LO NAROBE.\"),/*#__PURE__*/React.createElement(NavLink,{exact:true,to:\"/shoppingcart\",className:\"btnb\"},\"NAZAJ NA KO\\u0160ARICO\"),/*#__PURE__*/React.createElement(\"br\",null));}else if(n&&!_this.state.canceled&&!_this.state.finished){return/*#__PURE__*/React.createElement(\"div\",{style:{padding:'30px',margin:'0 auto'}},/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.7)',margin:'0 auto'}},/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'left',paddingLeft:'50px',fontSize:'Large'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"b\",null,\"ODDAJ NARO\\u010CILO\"))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{style:{float:'left',paddingRight:'100px',minHeight:'70vh'}},_this.state.order.map(function(item){return/*#__PURE__*/React.createElement(OrderListing,{key:item.ad_id,description:item});})),/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'left'}},/*#__PURE__*/React.createElement(FinishOrderData,null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"p\",null,\"Cena: \",price,\" \\u20AC\"),/*#__PURE__*/React.createElement(\"p\",null,\"Cena po\\u0161tnine: \",postage,\" \\u20AC\"),/*#__PURE__*/React.createElement(\"p\",{style:{fontWeight:'bold'}},\"Skupaj: \",price+postage,\" \\u20AC\"),/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:_this.finishOrder},\"ZAKLJU\\u010CI NARO\\u010CILO\"),/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:_this.cancelOrder},\"PREKLI\\u010CI NARO\\u010CILO\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(ClipLoader,{size:50,color:\"#123abc\",loading:_this.state.loading}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"p\",null,_this.state.orderStatus)),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{style:{clear:'both'}}),/*#__PURE__*/React.createElement(\"br\",null)));}else if(_this.state.canceled&&!_this.state.finished){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.7)',margin:'0 auto'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h1\",null,\"NARO\\u010CILO PREKLICANO!\"),/*#__PURE__*/React.createElement(NavLink,{exact:true,to:\"/shoppingcart\",className:\"btnb\"},\"NAZAJ NA KO\\u0160ARICO\"),/*#__PURE__*/React.createElement(\"br\",null));}else if(_this.state.finished&&!_this.state.canceled){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.7)',margin:'0 auto'}},/*#__PURE__*/React.createElement(\"br\",null),!_this.state.error&&/*#__PURE__*/React.createElement(\"h1\",null,\"NARO\\u010CILO ZAKLJU\\u010CENO!\"),_this.state.error&&/*#__PURE__*/React.createElement(\"h1\",null,\"NAPAKA! EDEN ALI VE\\u010C IZDELKOV \\u017DAL NI VE\\u010C NA VOLJO!\"),/*#__PURE__*/React.createElement(NavLink,{exact:true,to:\"/\",className:\"btnb\"},\"DOMOV\"),/*#__PURE__*/React.createElement(\"br\",null));}else{return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}};_this.state={orderStatus:'',adIds:[],order:[],fetching:true,canceled:false,finished:false,error:false,loading:false,userId:'0',redirectUrl:''};return _this;}_createClass(OrderPage,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;fetch('/sessionorder',{signal:this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({type:2})}).then(function(res){return res.json();}).then(function(res){var adIds=JSON.parse(res);_this2.setState({adIds:adIds});adIds.length&&fetch('/cartListings',{signal:_this2.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify(adIds)}).then(function(res){return res.json();}).then(function(res){_this2.setState({order:res});})//.then(res => console.log(res))\n.catch(function(e){return console.error(\"Critical failure: \"+e.message);});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});fetch('/sessionroutes',{signal:this.abortController.signal}).then(function(res){return res.json();}).then(function(res){return _this2.setState({userId:res.userId});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:this.props.location.pathname}),this.switchRender(),/*#__PURE__*/React.createElement(AdSpace,null),/*#__PURE__*/React.createElement(Bottom,null));}}]);return OrderPage;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{loggedInUser:state.loggedInUser,loggedInUserId:state.loggedInUserId};};var mapDispatchToProps={logIn:logIn,logOut:logOut};export default connect(mapStateToProps,mapDispatchToProps)(OrderPage);","map":{"version":3,"sources":["/home/katni/REACT/test-app/src/pages/ShoppingCart/OrderPage.jsx"],"names":["React","NavLink","connect","logIn","logOut","OrderListing","FinishOrderData","UpperLine","Header","Bottom","BreadCrumbs","NavBar","AdSpace","ClipLoader","OrderPage","props","abortController","AbortController","cancelOrder","fetch","signal","method","headers","body","JSON","stringify","type","ids","then","setState","canceled","catch","e","console","error","message","removeFromCart","cart","parse","window","localStorage","getItem","loggedInUserId","adIds","state","forEach","adId","splice","indexOf","toString","setItem","finishOrder","loading","price","priceSum","order","length","postage","postageSum","seller_id","user_id","seller","username","status","res","json","redirectUrl","handleOrder","orderStatus","n","i","weight","goToPage","redUrl","location","href","switchRender","userId","backgroundColor","margin","finished","padding","textAlign","paddingLeft","fontSize","float","paddingRight","minHeight","map","item","ad_id","fontWeight","clear","fetching","abort","pathname","Component","mapStateToProps","loggedInUser","mapDispatchToProps"],"mappings":"ojBAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,OAAT,KAAwB,kBAAxB,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,KAAT,CAAgBC,MAAhB,KAA8B,qBAA9B,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,SAAP,KAAsB,4BAAtB,CACA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,WAAP,KAAwB,8BAAxB,CACA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,OAAP,KAAoB,0BAApB,CACA,MAAOC,CAAAA,UAAP,KAAuB,2BAAvB,C,GAGMC,CAAAA,S,kHAEL,mBAAYC,KAAZ,CAAmB,2CAClB,uBAAMA,KAAN,EADkB,MAgBhBC,eAhBgB,CAgBE,GAAIC,CAAAA,eAAJ,EAhBF,OAmDhBC,WAnDgB,CAmDF,UAAM,CAChBC,KAAK,CAAC,eAAD,CAAkB,CACnBC,MAAM,CAAE,MAAKJ,eAAL,CAAqBI,MADV,CAEnBC,MAAM,CAAE,MAFW,CAGnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,SAAU,kBAFL,CAHU,CAOnBC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CACjBC,IAAI,CAAE,CADW,CAEjBC,GAAG,CAAE,EAFY,CAAf,CAPa,CAAlB,CAAL,CAWGC,IAXH,CAWQ,iBAAM,OAAKC,QAAL,CAAc,CAACC,QAAQ,CAAE,IAAX,CAAd,CAAN,EAXR,EAYCC,KAZD,CAYO,SAAAC,CAAC,QAAIC,CAAAA,OAAO,CAACC,KAAR,CAAc,qBAAuBF,CAAC,CAACG,OAAvC,CAAJ,EAZR,EAaH,CAjEe,OAmEhBC,cAnEgB,CAmEC,UAAM,CACnB,GAAIC,CAAAA,IAAI,CAAGb,IAAI,CAACc,KAAL,CAAWC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,MAAK1B,KAAL,CAAW2B,cAAvC,CAAX,CAAX,CACA,GAAMC,CAAAA,KAAK,CAAG,MAAKC,KAAL,CAAWD,KAAzB,CACAA,KAAK,CAACE,OAAN,CAAc,SAAAC,IAAI,CAAI,CAClBT,IAAI,CAACU,MAAL,CAAYV,IAAI,CAACW,OAAL,CAAaF,IAAI,CAACG,QAAL,EAAb,CAAZ,CAA2C,CAA3C,EACH,CAFD,EAGAV,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,MAAKnC,KAAL,CAAW2B,cAAvC,CAAuDlB,IAAI,CAACC,SAAL,CAAeY,IAAf,CAAvD,EACH,CA1Ee,OA4EhBc,WA5EgB,CA4EF,UAAM,CAChB,MAAKtB,QAAL,CAAc,CAACuB,OAAO,CAAE,IAAV,CAAd,EACA,GAAMC,CAAAA,KAAK,CAAG,MAAKC,QAAL,CAAc,MAAKV,KAAL,CAAWW,KAAzB,CAAgC,MAAKX,KAAL,CAAWW,KAAX,CAAiBC,MAAjD,CAAd,CACA,GAAMC,CAAAA,OAAO,CAAG,MAAKC,UAAL,CAAgB,MAAKd,KAAL,CAAWW,KAA3B,CAAkC,MAAKX,KAAL,CAAWW,KAAX,CAAiBC,MAAnD,CAAhB,CACArC,KAAK,CAAC,aAAD,CAAgB,CACjBC,MAAM,CAAE,MAAKJ,eAAL,CAAqBI,MADZ,CAEjBC,MAAM,CAAE,MAFS,CAGjBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,SAAU,kBAFL,CAHQ,CAOjBC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CACjB8B,KAAK,CAAE,CACH5B,GAAG,CAAE,MAAKiB,KAAL,CAAWD,KADb,CAEHU,KAAK,CAAEA,KAFJ,CAGHI,OAAO,CAAEA,OAHN,CAIHE,SAAS,CAAE,MAAKf,KAAL,CAAWW,KAAX,CAAiB,CAAjB,EAAoBK,OAJ5B,CAKHC,MAAM,CAAE,MAAKjB,KAAL,CAAWW,KAAX,CAAiB,CAAjB,EAAoBO,QALzB,CAMHC,MAAM,CAAE,CAAC,CANN,CADU,CAAf,CAPW,CAAhB,CAAL,CAkBGnC,IAlBH,CAkBQ,SAAAoC,GAAG,QAAIA,CAAAA,GAAG,CAACC,IAAJ,EAAJ,EAlBX,EAmBCrC,IAnBD,CAmBM,SAAAoC,GAAG,QAAI,OAAKnC,QAAL,CAAc,CAACqC,WAAW,CAAEF,GAAG,CAACE,WAAlB,CAAd,CAAJ,EAnBT,EAoBCnC,KApBD,CAoBO,SAAAC,CAAC,QAAIC,CAAAA,OAAO,CAACC,KAAR,CAAc,qBAAuBF,CAAC,CAACG,OAAvC,CAAJ,EApBR,EAqBH,CArGe,OA2GhBgC,WA3GgB,CA2GF,UAAM,CAChB,MAAKtC,QAAL,CAAc,CAACuC,WAAW,CAAE,UAAd,CAAd,EACH,CA7Ge,OA+GhBd,QA/GgB,CA+GL,SAACC,KAAD,CAAQc,CAAR,CAAc,CACrB,GAAIhB,CAAAA,KAAK,CAAG,CAAZ,CACA,IAAK,GAAIiB,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGD,CAApB,CAAuBC,CAAC,EAAxB,CAA4B,CACxBjB,KAAK,EAAIE,KAAK,CAACe,CAAD,CAAL,CAASjB,KAAlB,CACH,CACD,MAAOA,CAAAA,KAAP,CACH,CArHe,OAsHhBK,UAtHgB,CAsHH,SAACH,KAAD,CAAQc,CAAR,CAAc,CACvB,GAAIE,CAAAA,MAAM,CAAG,CAAb,CACA,GAAId,CAAAA,OAAO,CAAG,CAAd,CACA,IAAK,GAAIa,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGD,CAApB,CAAuBC,CAAC,EAAxB,CAA4B,CACxBC,MAAM,EAAIhB,KAAK,CAACe,CAAD,CAAL,CAASC,MAAnB,CACH,CACDd,OAAO,CAAGc,MAAM,CAAG,GAAT,CAAe,CAAf,CAAmB,CAA7B,CACA,MAAOd,CAAAA,OAAP,CACH,CA9He,OAgIhBe,QAhIgB,CAgIL,SAACC,MAAD,CAAY,CACnBlC,MAAM,CAACmC,QAAP,CAAgBC,IAAhB,CAAuBF,MAAvB,CACH,CAlIe,OAoIhBG,YApIgB,CAoID,UAAM,CAEjB,GAAMrB,CAAAA,KAAK,CAAG,MAAKX,KAAL,CAAWW,KAAzB,CACA,GAAMc,CAAAA,CAAC,CAAGd,KAAK,CAACC,MAAhB,CACA,GAAMH,CAAAA,KAAK,CAAG,MAAKC,QAAL,CAAcC,KAAd,CAAqBc,CAArB,CAAd,CACA,GAAMZ,CAAAA,OAAO,CAAG,MAAKC,UAAL,CAAgBH,KAAhB,CAAuBc,CAAvB,CAAhB,CAEA,GAAG,MAAKzB,KAAL,CAAWsB,WAAX,GAA2B,EAA9B,CAAkC,CAC9B,MAAKM,QAAL,CAAc,MAAK5B,KAAL,CAAWsB,WAAzB,EACH,CAFD,IAGK,IAAI,MAAKtB,KAAL,CAAWiC,MAAX,GAAsB,GAA1B,CAA+B,CAChC,mBAAO,2BAAK,KAAK,CAAI,CAACC,eAAe,CAAE,sBAAlB,CAAd,eACH,8BADG,cACE,8BADF,cACO,8BADP,cAEH,+DAFG,cAGH,8BAHG,cAGE,8BAHF,cAGO,8BAHP,CAAP,CAKH,CANI,IAOA,IAAI,CAACT,CAAL,CAAQ,CACT,mBAAO,2BAAK,KAAK,CAAI,CAACS,eAAe,CAAE,sBAAlB,CAA0CC,MAAM,CAAC,QAAjD,CAAd,eACK,8BADL,cAEK,gEAFL,cAGK,oBAAC,OAAD,EAAS,KAAK,KAAd,CAAe,EAAE,CAAG,eAApB,CAAoC,SAAS,CAAG,MAAhD,2BAHL,cAIK,8BAJL,CAAP,CAMH,CAPI,IAQA,IAAIV,CAAC,EAAI,CAAC,MAAKzB,KAAL,CAAWd,QAAjB,EAA6B,CAAC,MAAKc,KAAL,CAAWoC,QAA7C,CAAuD,CACxD,mBAAO,2BAAK,KAAK,CAAI,CAACC,OAAO,CAAE,MAAV,CAAkBF,MAAM,CAAE,QAA1B,CAAd,eACC,2BAAK,KAAK,CAAI,CAACD,eAAe,CAAE,sBAAlB,CAA0CC,MAAM,CAAC,QAAjD,CAAd,eACI,2BAAK,KAAK,CAAE,CAACG,SAAS,CAAE,MAAZ,CAAoBC,WAAW,CAAE,MAAjC,CAAyCC,QAAQ,CAAE,OAAnD,CAAZ,eACI,8BADJ,cAEI,0CAAG,mDAAH,CAFJ,CADJ,cAKI,8BALJ,cAMI,2BAAK,KAAK,CAAI,CAACC,KAAK,CAAE,MAAR,CAAgBC,YAAY,CAAE,OAA9B,CAAuCC,SAAS,CAAE,MAAlD,CAAd,EACK,MAAK3C,KAAL,CAAWW,KAAX,CAAiBiC,GAAjB,CAAqB,SAAAC,IAAI,qBAAI,oBAAC,YAAD,EAAc,GAAG,CAAGA,IAAI,CAACC,KAAzB,CAAgC,WAAW,CAAID,IAA/C,EAAJ,EAAzB,CADL,CANJ,cASI,2BAAK,KAAK,CAAI,CAACP,SAAS,CAAE,MAAZ,CAAd,eACI,oBAAC,eAAD,MADJ,cAEI,8BAFJ,cAGI,sCAAU7B,KAAV,WAHJ,cAII,oDAAmBI,OAAnB,WAJJ,cAKI,yBAAG,KAAK,CAAI,CAACkC,UAAU,CAAE,MAAb,CAAZ,aAA2CtC,KAAK,CAAGI,OAAnD,WALJ,cAMI,8BAAQ,SAAS,CAAG,MAApB,CAA2B,OAAO,CAAI,MAAKN,WAA3C,gCANJ,cAOI,8BAAQ,SAAS,CAAG,MAApB,CAA2B,OAAO,CAAI,MAAKjC,WAA3C,gCAPJ,cAQI,8BARJ,cASI,oBAAC,UAAD,EACI,IAAI,CAAE,EADV,CAEI,KAAK,CAAE,SAFX,CAGI,OAAO,CAAE,MAAK0B,KAAL,CAAWQ,OAHxB,EATJ,cAcI,8BAdJ,cAeI,6BAAI,MAAKR,KAAL,CAAWwB,WAAf,CAfJ,CATJ,cA0BI,8BA1BJ,cA2BI,2BAAK,KAAK,CAAI,CAACwB,KAAK,CAAE,MAAR,CAAd,EA3BJ,cA8BI,8BA9BJ,CADD,CAAP,CAkCH,CAnCI,IAmCE,IAAI,MAAKhD,KAAL,CAAWd,QAAX,EAAuB,CAAC,MAAKc,KAAL,CAAWoC,QAAvC,CAAiD,CACpD,mBAAO,2BAAK,KAAK,CAAI,CAACF,eAAe,CAAE,sBAAlB,CAA0CC,MAAM,CAAC,QAAjD,CAAd,eACK,8BADL,cAEK,0DAFL,cAGK,oBAAC,OAAD,EAAS,KAAK,KAAd,CAAe,EAAE,CAAG,eAApB,CAAoC,SAAS,CAAG,MAAhD,2BAHL,cAIK,8BAJL,CAAP,CAMH,CAPM,IAOA,IAAI,MAAKnC,KAAL,CAAWoC,QAAX,EAAuB,CAAC,MAAKpC,KAAL,CAAWd,QAAvC,CAAiD,CACpD,mBAAO,2BAAK,KAAK,CAAI,CAACgD,eAAe,CAAE,sBAAlB,CAA0CC,MAAM,CAAC,QAAjD,CAAd,eACK,8BADL,CAEM,CAAC,MAAKnC,KAAL,CAAWV,KAAZ,eAAqB,+DAF3B,CAGM,MAAKU,KAAL,CAAWV,KAAX,eAAoB,kGAH1B,cAIK,oBAAC,OAAD,EAAS,KAAK,KAAd,CAAe,EAAE,CAAG,GAApB,CAAwB,SAAS,CAAG,MAApC,UAJL,cAKK,8BALL,CAAP,CAOH,CARM,IAQA,CACH,mBAAO,4CAAK,8BAAL,cAAU,8BAAV,CAAP,CACH,CAEJ,CAnNe,CAElB,MAAKU,KAAL,CAAa,CACHwB,WAAW,CAAE,EADV,CAEHzB,KAAK,CAAE,EAFJ,CAGHY,KAAK,CAAE,EAHJ,CAIHsC,QAAQ,CAAE,IAJP,CAKH/D,QAAQ,CAAE,KALP,CAMHkD,QAAQ,CAAE,KANP,CAOH9C,KAAK,CAAE,KAPJ,CAQHkB,OAAO,CAAE,KARN,CASHyB,MAAM,CAAE,GATL,CAUHX,WAAW,CAAE,EAVV,CAAb,CAFkB,aAcf,C,mFAImB,iBAChB/C,KAAK,CAAC,eAAD,CAAkB,CACnBC,MAAM,CAAE,KAAKJ,eAAL,CAAqBI,MADV,CAEnBC,MAAM,CAAE,MAFW,CAGnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,SAAU,kBAFL,CAHU,CAOnBC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CACjBC,IAAI,CAAE,CADW,CAAf,CAPa,CAAlB,CAAL,CAUGE,IAVH,CAUQ,SAAAoC,GAAG,QAAIA,CAAAA,GAAG,CAACC,IAAJ,EAAJ,EAVX,EAWKrC,IAXL,CAWU,SAAAoC,GAAG,CAAI,CAAE,GAAMrB,CAAAA,KAAK,CAAGnB,IAAI,CAACc,KAAL,CAAW0B,GAAX,CAAd,CAA+B,MAAI,CAACnC,QAAL,CAAc,CAACc,KAAK,CAALA,KAAD,CAAd,EACzCA,KAAK,CAACa,MAAP,EAAkBrC,KAAK,CAAC,eAAD,CAAkB,CACrBC,MAAM,CAAE,MAAI,CAACJ,eAAL,CAAqBI,MADR,CAErBC,MAAM,CAAE,MAFa,CAGrBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,SAAU,kBAFL,CAHY,CAOrBC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAekB,KAAf,CAPe,CAAlB,CAAL,CAQCf,IARD,CAQM,SAAAoC,GAAG,QAAIA,CAAAA,GAAG,CAACC,IAAJ,EAAJ,EART,EASGrC,IATH,CASQ,SAAAoC,GAAG,CAAI,CAAC,MAAI,CAACnC,QAAL,CAAc,CAAC0B,KAAK,CAAES,GAAR,CAAd,EAA4B,CAT5C,CAUE;AAVF,CAWGjC,KAXH,CAWS,SAAAC,CAAC,QAAIC,CAAAA,OAAO,CAACC,KAAR,CAAc,qBAAuBF,CAAC,CAACG,OAAvC,CAAJ,EAXV,CAAlB,CAWkF,CAvB1F,EAwBKJ,KAxBL,CAwBW,SAAAC,CAAC,QAAIC,CAAAA,OAAO,CAACC,KAAR,CAAc,qBAAuBF,CAAC,CAACG,OAAvC,CAAJ,EAxBZ,EA0BAhB,KAAK,CAAC,gBAAD,CAAmB,CAACC,MAAM,CAAE,KAAKJ,eAAL,CAAqBI,MAA9B,CAAnB,CAAL,CACCQ,IADD,CACM,SAAAoC,GAAG,QAAIA,CAAAA,GAAG,CAACC,IAAJ,EAAJ,EADT,EAECrC,IAFD,CAEM,SAAAoC,GAAG,QAAI,CAAA,MAAI,CAACnC,QAAL,CAAc,CAACgD,MAAM,CAAEb,GAAG,CAACa,MAAb,CAAd,CAAJ,EAFT,EAGC9C,KAHD,CAGO,SAAAC,CAAC,QAAIC,CAAAA,OAAO,CAACC,KAAR,CAAc,qBAAuBF,CAAC,CAACG,OAAvC,CAAJ,EAHR,EAIH,C,mEAsDsB,CACnB,KAAKnB,eAAL,CAAqB8E,KAArB,GACH,C,uCA4GQ,CACL,mBAAO,2BAAK,SAAS,CAAC,KAAf,eACK,oBAAC,SAAD,MADL,cAEK,oBAAC,MAAD,MAFL,cAGK,oBAAC,MAAD,MAHL,cAIK,oBAAC,WAAD,EAAa,QAAQ,CAAI,KAAK/E,KAAL,CAAW2D,QAAX,CAAoBqB,QAA7C,EAJL,CAKM,KAAKnB,YAAL,EALN,cAMK,oBAAC,OAAD,MANL,cAOK,oBAAC,MAAD,MAPL,CAAP,CAUH,C,uBAlOmB5E,KAAK,CAACgG,S,EAsO9B,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAArD,KAAK,CAAI,CAC7B,MAAO,CACLsD,YAAY,CAAEtD,KAAK,CAACsD,YADf,CAELxD,cAAc,CAAEE,KAAK,CAACF,cAFjB,CAAP,CAID,CALH,CAOE,GAAMyD,CAAAA,kBAAkB,CAAG,CACzBhG,KAAK,CAAEA,KADkB,CAEzBC,MAAM,CAAEA,MAFiB,CAA3B,CAKF,cAAeF,CAAAA,OAAO,CAAC+F,eAAD,CAAkBE,kBAAlB,CAAP,CAA8CrF,SAA9C,CAAf","sourcesContent":["import React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { logIn, logOut } from '../../redux/actions';\nimport OrderListing from './OrderListing';\nimport FinishOrderData from './FinishOrderData';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport NavBar from '../../components/NavBar';\nimport AdSpace from '../../components/AdSpace';\nimport ClipLoader from 'react-spinners/ClipLoader';\n\n\nclass OrderPage extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            orderStatus: '',\n            adIds: [],\n            order: [],\n            fetching: true,\n            canceled: false,\n            finished: false,\n            error: false,\n            loading: false,\n            userId: '0',\n            redirectUrl: ''\n        };\n    }\n\n    abortController = new AbortController();\n\n    componentDidMount() {\n        fetch('/sessionorder', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                type: 2,\n            })\n        }).then(res => res.json())\n            .then(res => { const adIds = JSON.parse(res); this.setState({adIds});\n                (adIds.length) && fetch('/cartListings', {\n                                    signal: this.abortController.signal,\n                                    method: 'POST',\n                                    headers: {\n                                        'Content-Type': 'application/json',\n                                        'Accept': 'application/json'\n                                    },\n                                    body: JSON.stringify(adIds)\n                                }).then(res => res.json())\n                                    .then(res => {this.setState({order: res})})\n                                    //.then(res => console.log(res))\n                                    .catch(e => console.error(\"Critical failure: \" + e.message));})\n            .catch(e => console.error(\"Critical failure: \" + e.message));\n\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => this.setState({userId: res.userId}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    cancelOrder = () => {\n        fetch('/sessionorder', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                type: 1,\n                ids: []\n            })\n        }).then(() => this.setState({canceled: true}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    removeFromCart = () => {\n        let cart = JSON.parse(window.localStorage.getItem(this.props.loggedInUserId));\n        const adIds = this.state.adIds;\n        adIds.forEach(adId => {\n            cart.splice(cart.indexOf(adId.toString()), 1);\n        })\n        window.localStorage.setItem(this.props.loggedInUserId, JSON.stringify(cart));\n    }\n\n    finishOrder = () => {\n        this.setState({loading: true});\n        const price = this.priceSum(this.state.order, this.state.order.length);\n        const postage = this.postageSum(this.state.order, this.state.order.length);\n        fetch('/placeorder', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                order: {\n                    ids: this.state.adIds,\n                    price: price,\n                    postage: postage,\n                    seller_id: this.state.order[0].user_id,\n                    seller: this.state.order[0].username,\n                    status: -1\n                }\n\n            })\n        }).then(res => res.json())\n        .then(res => this.setState({redirectUrl: res.redirectUrl}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n    }\n\n    handleOrder = () => {\n        this.setState({orderStatus: 'ORDERED!'});\n    }\n\n    priceSum = (order, n) => {\n        let price = 0;\n        for (let i = 0; i < n; i++) {\n            price += order[i].price;\n        }\n        return price;\n    }\n    postageSum = (order, n) => {\n        let weight = 0;\n        let postage = 0;\n        for (let i = 0; i < n; i++) {\n            weight += order[i].weight;\n        }\n        postage = weight < 100 ? 2 : 3;\n        return postage;\n    }\n\n    goToPage = (redUrl) => {\n        window.location.href = redUrl;\n    }\n\n    switchRender = () => {\n\n        const order = this.state.order;\n        const n = order.length;\n        const price = this.priceSum(order, n);\n        const postage = this.postageSum(order, n);\n\n        if(this.state.redirectUrl !== '') {\n            this.goToPage(this.state.redirectUrl);\n        }\n        else if (this.state.userId === '0') {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                <br/><br/><br/>\n                <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                <br/><br/><br/>\n            </div>\n        }\n        else if (!n) {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.7)', margin:'0 auto'}}>\n                        <br/>\n                        <h1>O NE! NEKAJ JE ŠLO NAROBE.</h1>\n                        <NavLink exact to = '/shoppingcart' className = 'btnb'>NAZAJ NA KOŠARICO</NavLink>\n                        <br/>\n                    </div>\n        }\n        else if (n && !this.state.canceled && !this.state.finished) {\n            return <div style = {{padding: '30px', margin: '0 auto'}}>\n                    <div style = {{backgroundColor: 'rgb(255,255,255,0.7)', margin:'0 auto'}}>\n                        <div style={{textAlign: 'left', paddingLeft: '50px', fontSize: 'Large'}}>\n                            <br/>\n                            <p><b>ODDAJ NAROČILO</b></p>\n                        </div>\n                        <br/>\n                        <div style = {{float: 'left', paddingRight: '100px', minHeight: '70vh'}}>\n                            {this.state.order.map(item => <OrderListing key ={item.ad_id} description = {item}/>)}\n                        </div>\n                        <div style = {{textAlign: 'left'}}>\n                            <FinishOrderData/>\n                            <br/>\n                            <p>Cena: {price} €</p>\n                            <p>Cena poštnine: {postage} €</p>\n                            <p style = {{fontWeight: 'bold'}}>Skupaj: {price + postage} €</p>\n                            <button className = 'btnb' onClick = {this.finishOrder}>ZAKLJUČI NAROČILO</button>\n                            <button className = 'btnb' onClick = {this.cancelOrder}>PREKLIČI NAROČILO</button>\n                            <br/>\n                            <ClipLoader\n                                size={50}\n                                color={\"#123abc\"}\n                                loading={this.state.loading}\n                            />\n                            <br/>\n                            <p>{this.state.orderStatus}</p>\n                        </div>\n                        <br/>\n                        <div style = {{clear: 'both'}}>\n\n                        </div>\n                        <br/>\n                    </div>\n                </div>\n        } else if (this.state.canceled && !this.state.finished) {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.7)', margin:'0 auto'}}>\n                        <br/>\n                        <h1>NAROČILO PREKLICANO!</h1>\n                        <NavLink exact to = '/shoppingcart' className = 'btnb'>NAZAJ NA KOŠARICO</NavLink>\n                        <br/>\n                    </div>\n        } else if (this.state.finished && !this.state.canceled) {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.7)', margin:'0 auto'}}>\n                        <br/>\n                        {!this.state.error && <h1>NAROČILO ZAKLJUČENO!</h1>}\n                        {this.state.error && <h1>NAPAKA! EDEN ALI VEČ IZDELKOV ŽAL NI VEČ NA VOLJO!</h1>}\n                        <NavLink exact to = '/' className = 'btnb'>DOMOV</NavLink>\n                        <br/>\n                    </div>\n        } else {\n            return <div><br/><br/></div>\n        }\n\n    }\n\n    render() {\n        return <div className=\"App\">\n                    <UpperLine/>\n                    <Header/>\n                    <NavBar/>\n                    <BreadCrumbs pathname = {this.props.location.pathname}/>\n                    {this.switchRender()}\n                    <AdSpace/>\n                    <Bottom/>\n                </div>\n  \n    }\n    \n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n  };\n  \n  const mapDispatchToProps = {\n    logIn: logIn,\n    logOut: logOut\n  };\n\nexport default connect(mapStateToProps, mapDispatchToProps) (OrderPage);\n"]},"metadata":{},"sourceType":"module"}