{"ast":null,"code":"import _objectSpread from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{connect}from'react-redux';import{NavLink}from'react-router-dom';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import NewMsg from'./NewMsg';import NavBar from'../../components/NavBar';import AdSpace from'../../components/AdSpace';import Bottom from'../../components/Bottom';import BreadCrumbs from'../../components/BreadCrumbs';import'../../App.css';var Conversation=/*#__PURE__*/function(_Component){_inherits(Conversation,_Component);var _super=_createSuper(Conversation);function Conversation(props){var _this;_classCallCheck(this,Conversation);_this=_super.call(this,props);_this.abortController=new AbortController();_this.msgFetch=function(){var iLId=_this.interlocutorId();_this.interlocutor(iLId);fetch('/api/fetchmessages',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({conversantId:iLId})}).then(function(res){return res.json();}).then(function(results){var messages=results.map(function(result){return{time:result.date_created,sender:result.sender,msg:result.msg};});_this.setState({messages:messages});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.sendMsg=function(newMsg){_this.setState({newMsg:newMsg});var receiverId=_this.interlocutorId();fetch('/api/newmessage',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({receiverId:receiverId,msg:newMsg})}).then(function(res){return res.json();}).then(function(res){return res.success&&_this.setState(function(state){var messages=[].concat(_toConsumableArray(state.messages),[{time:'now',sender:_this.props.loggedInUser,msg:state.newMsg}]);return _objectSpread({},state,{messages:messages,newMsg:''});});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.interlocutor=function(iLId){fetch('/api/firstname',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({iLId:iLId})}).then(function(res){return res.json();}).then(function(res){return _this.setState({interlocutor:res[0].first_name});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.switchRender=function(){var messages=_this.state.messages;var N=_this.state.messages.length;var n=5;if(_this.state.userId==='0'){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"PROSIMO PRIJAVITE SE V SISTEM!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}else return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255, 255, 255, 0.8)'}},/*#__PURE__*/React.createElement(\"p\",null,_this.state.time),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"p\",{style:{fontSize:'30px'}},\"POGOVOR S/Z: \",/*#__PURE__*/React.createElement(\"b\",null,_this.state.interlocutor)),N>n&&/*#__PURE__*/React.createElement(NavLink,{exact:true,to:_this.props.location.pathname+'/all?'+_this.interlocutorId(),className:\"btn\"},\"POKA\\u017DI STAREJ\\u0160A SPORO\\u010CILA\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"ul\",{style:{display:'inline-block',maxWidth:'60vw',paddingLeft:'0px'}},N>n&&messages.slice(N-n,N).map(function(msg,index){return/*#__PURE__*/React.createElement(\"li\",{key:index,style:{listStyleType:'none',lineHeight:'35px'}},msg.time.substring(8,10),\"-\",msg.time.substring(5,7),\"-\",msg.time.substring(0,4),\" \",msg.time.substring(11,16),\": \",/*#__PURE__*/React.createElement(\"b\",null,msg.sender),\": \",msg.msg);}),N<=n&&_this.state.messages.map(function(msg,index){return/*#__PURE__*/React.createElement(\"li\",{key:index,style:{listStyleType:'none',lineHeight:'35px'}},msg.time.substring(8,10),\"-\",msg.time.substring(6,7),\"-\",msg.time.substring(0,4),\" \",msg.time.substring(11,16),\": \",/*#__PURE__*/React.createElement(\"b\",null,msg.sender),\": \",msg.msg);})),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(NewMsg,{callBackParent:_this.sendMsg})));};_this.state={userId:'0',time:null,interlocutor:'',messages:[],newMsg:''};return _this;}_createClass(Conversation,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;fetch('/api/sessionroutes',{signal:this.abortController.signal}).then(function(res){return res.json();}).then(function(res){return _this2.setState({userId:res.userId});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});this.msgFetch();this.interval=setInterval(function(){_this2.msgFetch();},30000);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();clearInterval(this.interval);}},{key:\"interlocutorId\",value:function interlocutorId(){function subStrAfterChars(str,char){return str.substring(str.indexOf(char)+1);}var interlocutorId=subStrAfterChars(window.location.href,'?');return interlocutorId;}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:this.props.location.pathname}),this.switchRender(),/*#__PURE__*/React.createElement(AdSpace,null),/*#__PURE__*/React.createElement(Bottom,null));}}]);return Conversation;}(Component);var mapStateToProps=function mapStateToProps(state){return{loggedInUser:state.loggedInUser,loggedInUserId:state.loggedInUserId};};export default connect(mapStateToProps)(Conversation);","map":{"version":3,"sources":["/home/katni/APP/client/src/pages/Chat/Conversation.jsx"],"names":["React","Component","connect","NavLink","UpperLine","Header","NewMsg","NavBar","AdSpace","Bottom","BreadCrumbs","Conversation","props","abortController","AbortController","msgFetch","iLId","interlocutorId","interlocutor","fetch","signal","method","headers","body","JSON","stringify","conversantId","then","res","json","results","messages","map","result","time","date_created","sender","msg","setState","catch","e","console","error","message","sendMsg","newMsg","receiverId","success","state","loggedInUser","first_name","switchRender","N","length","n","userId","backgroundColor","fontSize","location","pathname","display","maxWidth","paddingLeft","slice","index","listStyleType","lineHeight","substring","interval","setInterval","abort","clearInterval","subStrAfterChars","str","char","indexOf","window","href","mapStateToProps","loggedInUserId"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { NavLink } from 'react-router-dom';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NewMsg from './NewMsg';\nimport NavBar from '../../components/NavBar';\nimport AdSpace from '../../components/AdSpace';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport '../../App.css';\n\n\nclass Conversation extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n        this.state = {\n            userId: '0',\n            time: null,\n            interlocutor: '',\n            messages: [],\n            newMsg: ''\n        }\n    }\n\n    abortController = new AbortController();\n\n    componentDidMount() {\n        fetch('/api/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => this.setState({userId: res.userId}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n\n        this.msgFetch();\n        this.interval = setInterval(() => {this.msgFetch();}, 30000);\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n        clearInterval(this.interval);\n    }\n\n    msgFetch = () => {\n        const iLId = this.interlocutorId();\n        this.interlocutor(iLId);\n        fetch('/api/fetchmessages', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                conversantId: iLId\n            })\n        })\n        .then(res => res.json())\n        .then(results => {\n            const messages = results.map(result => ({time: result.date_created, sender: result.sender, msg: result.msg}));\n            this.setState({messages})\n        })\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    sendMsg = (newMsg) => {\n        this.setState({newMsg})\n        const receiverId = this.interlocutorId();\n        fetch('/api/newmessage', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                receiverId: receiverId,\n                msg: newMsg\n            })\n        }).then(res => res.json())\n        .then(res => res.success && this.setState(state => {const messages = [...state.messages, ({time: 'now', sender: this.props.loggedInUser, msg: state.newMsg})];\n                                        return {...state, messages, newMsg: ''}}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    interlocutorId() {\n        function subStrAfterChars(str, char) {\n            return str.substring(str.indexOf(char) + 1);\n        }\n        const interlocutorId = subStrAfterChars(window.location.href, '?');\n        return interlocutorId;\n    }\n\n    interlocutor = (iLId) => {\n        fetch('/api/firstname', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                iLId: iLId,\n            })\n        }).then(res => res.json())\n        .then(res => this.setState({interlocutor: res[0].first_name}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    switchRender = () => {\n        const messages = this.state.messages;\n        const N = this.state.messages.length;\n        const n = 5;\n\n        if (this.state.userId === '0') {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                <br/><br/><br/>\n                <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                <br/><br/><br/>\n            </div>\n        }\n        else return <div style = {{backgroundColor: 'rgb(255, 255, 255, 0.8)'}}>\n            <p>{this.state.time}</p>\n            <br/>\n            <p style = {{fontSize: '30px'}}>POGOVOR S/Z: <b>{this.state.interlocutor}</b></p>\n            {N > n && <NavLink exact to = {this.props.location.pathname + '/all?' + this.interlocutorId()} className = 'btn'>POKAŽI STAREJŠA SPOROČILA</NavLink>}\n            <br/>\n            <ul style = {{display: 'inline-block', maxWidth: '60vw', paddingLeft: '0px'}}>\n            {N > n && (\n            messages.slice(N-n, N)\n            .map((msg, index) =>\n                <li key={index} style={{listStyleType: 'none', lineHeight: '35px'}}>\n                    {msg.time.substring(8,10)}-{msg.time.substring(5,7)}-{msg.time.substring(0,4)} {msg.time.substring(11,16)}: <b>{msg.sender}</b>: {msg.msg}</li>))}\n            {N <= n && this.state.messages.map((msg, index) =>\n                <li key={index} style={{listStyleType: 'none', lineHeight: '35px'}}>\n                    {msg.time.substring(8,10)}-{msg.time.substring(6,7)}-{msg.time.substring(0,4)} {msg.time.substring(11,16)}: <b>{msg.sender}</b>: {msg.msg}</li>)}\n            </ul>\n            <br/>\n            <br/>\n            <div>\n                <NewMsg callBackParent = {this.sendMsg}/>\n            </div>\n        </div>\n    }\n\n    render() {\n        return (\n            <div className = 'App'>\n                <UpperLine/>\n                <Header/>\n                <NavBar/>\n                <BreadCrumbs pathname = {this.props.location.pathname}/>\n                {this.switchRender()}\n                <AdSpace/>\n                <Bottom/>\n            </div>\n        )\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n};\n\nexport default connect(mapStateToProps) (Conversation)"]},"metadata":{},"sourceType":"module"}