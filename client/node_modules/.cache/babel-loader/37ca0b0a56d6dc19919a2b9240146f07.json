{"ast":null,"code":"var _jsxFileName = \"/home/katja/REACT/test-app/src/pages/Publish/UploadPageNew.jsx\";\nimport React from 'react';\nimport '../../App.css';\nimport { connect } from 'react-redux';\nimport { saveAtt } from '../../redux/actions';\nimport { doUpload } from '../../functions/index';\nimport queryString from 'query-string';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport ImgUpload from './ImgUpload';\nimport SelectForms from './SelectForms';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\n\nclass UploadPage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.abortController = new AbortController();\n    this.axiosSignal = axios.CancelToken.source();\n\n    this.checkIfAll = () => {\n      let check = true;\n      const selection = this.state.selection;\n      Object.keys(selection).forEach(key => {\n        if (key !== 'brand' && key !== 'descrtext') {\n          if (selection[key] === 0 && selection.category !== 3 || selection[key] === null || selection[key] === '') {\n            check = false;\n            this.setState({\n              warning: 'Izpolni vsa polja'\n            });\n          }\n        }\n      });\n\n      if (this.state.photos.length < 3) {\n        check = false;\n        this.setState({\n          warning: 'Izberi tri fotografije'\n        });\n      }\n\n      return check;\n    };\n\n    this.onImageSaved = (photo, index) => {\n      if (this.state.photos.length <= index) {\n        this.setState(state => {\n          const photos = state.photos.concat(photo);\n          return {\n            photos\n          };\n        });\n      } else {\n        this.setState(state => {\n          const photos = state.photos.map((item, j) => {\n            if (j === index) {\n              return photo;\n            } else {\n              return item;\n            }\n          });\n          return {\n            photos\n          };\n        });\n      }\n    };\n\n    this.onSelectionSaved = selection => {\n      this.setState({\n        selection\n      });\n    };\n\n    this.state = {\n      userId: '0',\n      adId: '',\n      photos: [],\n      warning: '',\n      uploadStatus: false,\n      selection: {\n        category: '',\n        subcategory: '',\n        clothsize: '',\n        material: '',\n        condition: '',\n        brand: '',\n        descrtext: '',\n        weight: null,\n        price: null\n      },\n      loading: false\n    };\n    this.handleUpload = this.handleUpload.bind(this);\n  }\n\n  componentDidMount() {\n    fetch('/sessionroutes', {\n      signal: this.abortController.signal\n    }).then(res => res.json()).then(res => this.setState({\n      userId: res.userId\n    })).catch(e => console.error(\"Critical failure: \" + e.message));\n  }\n\n  componentWillUnmount() {\n    this.abortController.abort();\n    this.axiosSignal.cancel('Api is being canceled');\n  }\n\n  handleUpload() {\n    this.props.saveAtt(true);\n\n    if (!this.checkIfAll()) {\n      this.setState({\n        warning: \"IZPOLNI VSA POLJA!\"\n      });\n    } else {\n      this.setState({\n        loading: true\n      });\n      doUpload('first', this.state.selection, this.props.loggedInUserId, this.props.loggedInUser, this.axiosSignal, 0, this.state.photos).then(res => this.setState({\n        uploadStatus: true,\n        loading: false\n      })).catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n  }\n\n  render() {\n    if (this.state.userId === '0') {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"App\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(UpperLine, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(Header, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(NavBar, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(BreadCrumbs, {\n        pathname: this.props.location.pathname,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          backgroundColor: 'rgb(255,255,255,0.5)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 30\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 35\n        }\n      }), /*#__PURE__*/React.createElement(\"h2\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 25\n        }\n      }, \"PROSIMO PRIJAVITE SE V SISTEM!\"), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 30\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 35\n        }\n      })), /*#__PURE__*/React.createElement(Bottom, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 21\n        }\n      }));\n    } else if (state.uploadStatus) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"App\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 20\n        }\n      }, /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 30\n        }\n      }), /*#__PURE__*/React.createElement(\"h1\", {\n        style: {\n          backgroundColor: 'rgb(255, 255, 255, 0.5)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 25\n        }\n      }, \"HVALA ZA ODDANI OGLAS!\"), /*#__PURE__*/React.createElement(NavLink, {\n        exact: true,\n        to: \"/user_listings\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 62\n        }\n      }, \"NAZAJ NA MOJO STRAN\")));\n    } else {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"App\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(UpperLine, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(Header, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(BreadCrumbs, {\n        pathname: this.props.location.pathname,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          display: \"flex\",\n          width: \"90vw\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"sidenav\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          width: \"100%\",\n          backgroundColor: 'rgb(255, 255, 255, 0.5)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 25\n        }\n      }, \"OBJAVI OGLAS\"), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(SelectForms, {\n        callBackParent: onSelectionSaved,\n        saveAtt: state.saveAttempt,\n        adId: adId,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"p\", {\n        style: {\n          fontWeight: 'bold'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 25\n        }\n      }, \"Nalo\\u017Ei tri fotografije (prva fotografija je naslovna)\"), /*#__PURE__*/React.createElement(ImgUpload, {\n        callBackParent: onImageSaved,\n        index: \"0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(ImgUpload, {\n        callBackParent: onImageSaved,\n        index: \"1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(ImgUpload, {\n        callBackParent: onImageSaved,\n        index: \"2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 25\n        }\n      }), !state.loading && /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btnb\",\n        onClick: handleUpload,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 44\n        }\n      }, \"SHRANI OGLAS\"), /*#__PURE__*/React.createElement(ClipLoader, {\n        size: 50,\n        color: \"#123abc\",\n        loading: state.loading,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"p\", {\n        style: {\n          color: \"red\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 25\n        }\n      }, state.warning))), /*#__PURE__*/React.createElement(Bottom, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 17\n        }\n      }));\n    }\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    loggedInUser: state.loggedInUser,\n    loggedInUserId: state.loggedInUserId,\n    saveAttempt: state.saveAttempt\n  };\n};\n\nconst mapDispatchToProps = {\n  saveAtt: saveAtt\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(UploadPage);","map":{"version":3,"sources":["/home/katja/REACT/test-app/src/pages/Publish/UploadPageNew.jsx"],"names":["React","connect","saveAtt","doUpload","queryString","UpperLine","Header","NavBar","ImgUpload","SelectForms","Bottom","BreadCrumbs","UploadPage","Component","constructor","props","abortController","AbortController","axiosSignal","axios","CancelToken","source","checkIfAll","check","selection","state","Object","keys","forEach","key","category","setState","warning","photos","length","onImageSaved","photo","index","concat","map","item","j","onSelectionSaved","userId","adId","uploadStatus","subcategory","clothsize","material","condition","brand","descrtext","weight","price","loading","handleUpload","bind","componentDidMount","fetch","signal","then","res","json","catch","e","console","error","message","componentWillUnmount","abort","cancel","loggedInUserId","loggedInUser","render","location","pathname","backgroundColor","display","width","saveAttempt","fontWeight","color","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport '../../App.css';\nimport { connect } from 'react-redux';\nimport { saveAtt } from '../../redux/actions';\nimport {doUpload} from '../../functions/index';\nimport queryString from 'query-string';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport ImgUpload from './ImgUpload';\nimport SelectForms from './SelectForms';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\n\n\nclass UploadPage extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            userId: '0',\n            adId: '',\n            photos: [],\n            warning: '',\n            uploadStatus: false,\n            selection: {\n                category: '',\n                subcategory: '',\n                clothsize: '',\n                material: '',\n                condition: '',\n                brand: '',\n                descrtext: '',\n                weight: null,\n                price: null\n            },\n            loading: false\n        };\n        this.handleUpload = this.handleUpload.bind(this);\n    }\n\n    abortController = new AbortController();\n    axiosSignal = axios.CancelToken.source();\n\n    componentDidMount() {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => this.setState({userId: res.userId}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n        this.axiosSignal.cancel('Api is being canceled');\n    }\n\n    checkIfAll = () => {\n        let check = true;\n        const selection = this.state.selection;\n        Object.keys(selection).forEach(key => {\n            if(key !== 'brand' && key !== 'descrtext') {\n                if((selection[key] === 0 && selection.category !== 3)|| selection[key] === null || selection[key] === '') {\n                    check = false;\n                    this.setState({warning: 'Izpolni vsa polja'});\n                }\n            }\n        });\n        if (this.state.photos.length < 3) {\n            check = false;\n            this.setState({warning: 'Izberi tri fotografije'});\n        }\n        return check;\n    }\n\n    onImageSaved = (photo, index) => {\n        if (this.state.photos.length <= index) {\n            this.setState(state => {\n                const photos = state.photos.concat(photo);\n                return {photos};\n            });\n        } else {\n            this.setState(state => {\n                const photos = state.photos.map((item, j) => {\n                    if (j === index) {\n                        return photo;\n                    } else {\n                        return item;\n                    }\n                });\n                return {photos};\n            });\n        }\n    }\n\n    onSelectionSaved = (selection) => {\n        this.setState({selection});\n    }\n\n    handleUpload() {\n        this.props.saveAtt(true);    \n        if (!this.checkIfAll()) {\n            this.setState({warning: \"IZPOLNI VSA POLJA!\"});\n        }else {\n            this.setState({loading: true});\n            doUpload('first', this.state.selection, this.props.loggedInUserId, this.props.loggedInUser, this.axiosSignal, 0, this.state.photos)\n            .then(res => this.setState({uploadStatus: true, loading: false}))\n            .catch(e => console.error(\"Critical failure: \" + e.message));\n        }\n    }\n\n    render() {\n        if(this.state.userId === '0') {\n            return (\n                <div className = 'App'>\n                    <UpperLine/>\n                    <Header/>\n                    <NavBar/>\n                    <BreadCrumbs pathname = {this.props.location.pathname}/>\n                    <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                        <br/><br/><br/>\n                        <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                        <br/><br/><br/>\n                    </div>\n                    <Bottom/>\n                </div>\n            )\n        }\n        else if(state.uploadStatus) {\n            return <div className=\"App\">\n                        <br/><br/>\n                        <h1 style={{backgroundColor: 'rgb(255, 255, 255, 0.5)'}}>HVALA ZA ODDANI OGLAS!</h1>\n                        <NavLink exact to = '/user_listings'><button className = 'btn'>NAZAJ NA MOJO STRAN</button></NavLink>\n                    </div>\n        } else {\n            return (\n            <div className=\"App\">\n                <UpperLine/>\n                <Header/>\n                <BreadCrumbs pathname = {this.props.location.pathname}/>\n                <div style={{display: \"flex\", width: \"90vw\"}}>\n                    <div className=\"sidenav\"></div>\n                    <div style={{width: \"100%\", backgroundColor: 'rgb(255, 255, 255, 0.5)'}}>\n                        <h1>OBJAVI OGLAS</h1>\n                        <br/>\n                        <SelectForms callBackParent={onSelectionSaved} saveAtt ={state.saveAttempt} adId={adId}/>\n                        <br/>\n                        <p style = {{fontWeight: 'bold'}}>Nalo≈æi tri fotografije (prva fotografija je naslovna)</p>\n                        <ImgUpload callBackParent={onImageSaved} index='0'/>\n                        <ImgUpload callBackParent={onImageSaved} index='1'/>\n                        <ImgUpload callBackParent={onImageSaved} index='2'/>\n                        {!state.loading && <button className = 'btnb' onClick={handleUpload}>SHRANI OGLAS</button>}\n                        <ClipLoader\n                            size={50}\n                            color={\"#123abc\"}\n                            loading={state.loading}\n                        />\n                        <p style={{color: \"red\"}}>{state.warning}</p>\n                    </div>\n                </div>\n                <Bottom/>\n            </div>\n            )}\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId,\n      saveAttempt: state.saveAttempt\n    };\n};\n\nconst mapDispatchToProps = {\n    saveAtt: saveAtt\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (UploadPage);\n"]},"metadata":{},"sourceType":"module"}