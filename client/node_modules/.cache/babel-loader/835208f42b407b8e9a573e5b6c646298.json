{"ast":null,"code":"import _classCallCheck from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{NavLink}from'react-router-dom';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import Bottom from'../../components/Bottom';import BreadCrumbs from'../../components/BreadCrumbs';import NavBar from'../../components/NavBar';import AdSpace from'../../components/AdSpace';import*as Constants from'../../constants';var SearchResults=/*#__PURE__*/function(_React$Component){_inherits(SearchResults,_React$Component);var _super=_createSuper(SearchResults);function SearchResults(props){var _this;_classCallCheck(this,SearchResults);_this=_super.call(this,props);_this.abortController=new AbortController();_this.search=function(){var searchFor=_this.state.searchFor;if(searchFor==='')searchFor='nothingtosearchfor';fetch('/search',{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({signal:_this.abortController.signal,searchFor:searchFor})}).then(function(res){return res.json();}).then(function(ads){return _this.setState({ads:ads,numPages:Math.floor(ads.length/_this.state.adsPerPage+0.99)});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.onSearchChange=function(searchFor){_this.setState({searchFor:searchFor},function(){return _this.search();});};_this.paginationButtonClick=function(e){function subStrBeforeChars(str,char){return str.substring(0,str.indexOf(char));}var location;if(window.location.href.includes('=')){location=subStrBeforeChars(window.location.href,'=');}else{location=window.location.href;}var newpage=1;switch(e.target.id){case'first':_this.setState({page:1});//window.history.replaceState(null, \"\", location + '?1');\nwindow.history.replaceState(null,\"\",location+'=1');break;case'previous':_this.state.page>1?newpage=_this.state.page-1:newpage=1;_this.setState({page:newpage});//window.history.replaceState(null, \"\", location + '?' + newpage);\nwindow.history.replaceState(null,\"\",location+'='+newpage);break;case'next':_this.state.page<_this.state.numPages?newpage=_this.state.page+1:newpage=_this.state.numPages;_this.setState({page:newpage});//window.history.replaceState(null, \"\", location + '?' + newpage);\nwindow.history.replaceState(null,\"\",location+'='+newpage);break;case'last':_this.setState({page:_this.state.numPages});//window.history.replaceState(null, \"\", location + '?' + this.state.numPages);\nwindow.history.replaceState(null,\"\",location+'='+_this.state.numPages);break;default:return null;}};_this.toRender=function(ads){var imgStyle={width:\"100%\",border:'2px solid white'};var wrapper={display:\"grid\",gridTemplateColumns:\"repeat(4, 1fr)\",gridGap:\"100px 100px\",maxWidth:\"100%\",margin:\"50px 50px\"};var searchFor=_this.state.searchFor;if(ads.length===0){return/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",maxWidth:\"90vw\",minHeight:'30vh',justifyContent:'center'}},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h2\",{style:{color:'white'}},\"OPROSTITE, NI\\u010CESAR NISMO NA\\u0160LI!\")));}else{return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",{className:\"white-back\"},\"Rezultati iskanja za: \",/*#__PURE__*/React.createElement(\"b\",null,searchFor)),/*#__PURE__*/React.createElement(\"div\",{style:{maxWidth:'100%',justifyContent:'center',minHeight:'80vh'}},/*#__PURE__*/React.createElement(\"div\",{style:wrapper},ads.map(function(ad){var category=Constants.categoryNames[ad.category];var subcategory;switch(category){case'women':subcategory=Constants.women[ad.subcategory].value;break;case'men':subcategory=Constants.men[ad.subcategory].value;break;case'kids':subcategory=Constants.kids[ad.subcategory].value;break;default:subcategory=0;}return/*#__PURE__*/React.createElement(\"li\",{key:ad.ad_id,style:{listStyleType:\"none\"}},/*#__PURE__*/React.createElement(NavLink,{exact:true,to:'/listings/'+category+'/'+subcategory+'/item?'+ad.ad_id},/*#__PURE__*/React.createElement(\"img\",{src:'/'+ad.photo1_url,alt:ad.ad_id+'somephoto',style:imgStyle})));}))));}};_this.state={searchFor:'',ads:[],adsPerPage:5,numPages:1,page:1};return _this;}_createClass(SearchResults,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;function subStrAfterChars(str,char){return str.substring(str.indexOf(char)+1);}function subStrBetweenChars(str,char1,char2){return str.substring(str.indexOf(char1)+1,str.indexOf(char2));}var searchFor='';console.log(searchFor);if(window.location.href.includes('=')){searchFor=subStrBetweenChars(window.location.href,'?','=');var page=parseInt(subStrAfterChars(window.location.href,'='));this.setState({page:page});}else{searchFor=subStrAfterChars(window.location.href,'?');}this.setState({searchFor:searchFor},function(){return _this2.search();});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();}},{key:\"render\",value:function render(){var path='/searchresults';var numAds=this.state.ads.length;var n=this.state.adsPerPage;var p=this.state.page-1;var till;p*n+n<numAds?till=(p+1)*n:till=numAds;var adsPortion=this.state.ads.slice(p*n,till);return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,{callBackParent:this.onSearchChange}),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:path}),this.toRender(adsPortion),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{id:\"first\",className:\"btn_nopad\",onClick:this.paginationButtonClick},\"PRVA\"),/*#__PURE__*/React.createElement(\"button\",{id:\"previous\",className:\"btn_nopad\",onClick:this.paginationButtonClick},\"<<\"),/*#__PURE__*/React.createElement(\"button\",{id:\"current\",className:\"btn_nopad\"},this.state.page,\"/\",this.state.numPages),/*#__PURE__*/React.createElement(\"button\",{id:\"next\",className:\"btn_nopad\",onClick:this.paginationButtonClick},\">>\"),/*#__PURE__*/React.createElement(\"button\",{id:\"last\",className:\"btn_nopad\",onClick:this.paginationButtonClick},\"ZADNJA\")),/*#__PURE__*/React.createElement(AdSpace,null),/*#__PURE__*/React.createElement(Bottom,null));}}]);return SearchResults;}(React.Component);export default SearchResults;","map":{"version":3,"sources":["/home/katni/REACT/test-app/src/pages/Listings/SearchResults.jsx"],"names":["React","NavLink","UpperLine","Header","Bottom","BreadCrumbs","NavBar","AdSpace","Constants","SearchResults","props","abortController","AbortController","search","searchFor","state","fetch","method","headers","body","JSON","stringify","signal","then","res","json","ads","setState","numPages","Math","floor","length","adsPerPage","catch","e","console","error","message","onSearchChange","paginationButtonClick","subStrBeforeChars","str","char","substring","indexOf","location","window","href","includes","newpage","target","id","page","history","replaceState","toRender","imgStyle","width","border","wrapper","display","gridTemplateColumns","gridGap","maxWidth","margin","minHeight","justifyContent","color","map","ad","category","categoryNames","subcategory","women","value","men","kids","ad_id","listStyleType","photo1_url","subStrAfterChars","subStrBetweenChars","char1","char2","log","parseInt","abort","path","numAds","n","p","till","adsPortion","slice","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport NavBar from '../../components/NavBar';\nimport AdSpace from '../../components/AdSpace';\nimport * as Constants from '../../constants';\n\n\nclass SearchResults extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            searchFor: '',\n            ads: [],\n            adsPerPage: 5,\n            numPages: 1,\n            page: 1 \n        };\n    }\n    \n    abortController = new AbortController();\n\tcomponentDidMount() {\n        function subStrAfterChars(str, char) {\n            return str.substring(str.indexOf(char) + 1);\n        }\n        function subStrBetweenChars(str, char1, char2) {\n            return str.substring(str.indexOf(char1) + 1, str.indexOf(char2));\n        }\n        let searchFor = '';\n        console.log(searchFor);\n        if(window.location.href.includes('=')) {\n            searchFor = subStrBetweenChars(window.location.href, '?', '=');\n            let page = parseInt(subStrAfterChars(window.location.href, '='));\n            this.setState({page});\n        }\n        else {\n            searchFor = subStrAfterChars(window.location.href, '?');\n        }\n        this.setState({searchFor}, () => this.search());\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n    }\n\n    search = () => {\n        let searchFor = this.state.searchFor;\n        if (searchFor === '') searchFor = 'nothingtosearchfor';\n        fetch('/search', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n                signal: this.abortController.signal,\n                searchFor: searchFor\n            })\n        }).then(res => res.json())\n        .then(ads => this.setState({ads: ads, numPages: Math.floor(ads.length/this.state.adsPerPage + 0.99)}))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    onSearchChange = (searchFor) => {\n        this.setState({searchFor}, () => this.search());\n    }\n\n    paginationButtonClick = (e) => {\n        function subStrBeforeChars(str, char) {\n            return str.substring(0, str.indexOf(char));\n        }\n        let location;\n        if(window.location.href.includes('=')) {location = subStrBeforeChars(window.location.href, '=');}\n        else{location = window.location.href;}\n        let newpage = 1;\n        switch(e.target.id) {\n            case 'first':\n                this.setState({page: 1});\n                //window.history.replaceState(null, \"\", location + '?1');\n                window.history.replaceState(null, \"\", location + '=1');\n                break;\n            case 'previous':\n                this.state.page > 1 ? newpage = this.state.page-1 : newpage = 1;\n                this.setState({page: newpage});\n                //window.history.replaceState(null, \"\", location + '?' + newpage);\n                window.history.replaceState(null, \"\", location + '=' + newpage);\n                break;\n            case 'next':\n                this.state.page < this.state.numPages ? newpage = this.state.page+1 : newpage = this.state.numPages;\n                this.setState({page: newpage});\n                //window.history.replaceState(null, \"\", location + '?' + newpage);\n                window.history.replaceState(null, \"\", location + '=' + newpage);\n                break;\n            case 'last':\n                this.setState({page: this.state.numPages});\n                //window.history.replaceState(null, \"\", location + '?' + this.state.numPages);\n                window.history.replaceState(null, \"\", location + '=' + this.state.numPages);\n                break;\n            default:\n                return null;\n        }\n    }\n\n    toRender = (ads) => {\n\n        const imgStyle = {\n            width: \"100%\",\n            border: '2px solid white'\n        }\n    \n        const wrapper = {\n            display: \"grid\",\n            gridTemplateColumns: \"repeat(4, 1fr)\",\n            gridGap: \"100px 100px\",\n            maxWidth: \"100%\",\n            margin: \"50px 50px\"\n        }\n\n        let searchFor = this.state.searchFor;\n        if (ads.length === 0) {\n            return <div style={{display: \"flex\", maxWidth: \"90vw\", minHeight: '30vh', justifyContent: 'center'}}>\n                        <div><h2 style = {{color: 'white'}}>OPROSTITE, NIČESAR NISMO NAŠLI!</h2></div>\n                    </div>\n        }\n        else {\n            return <div>\n                        <p className = 'white-back'>Rezultati iskanja za: <b>{searchFor}</b></p>\n                        <div style={{maxWidth: '100%', justifyContent: 'center', minHeight:'80vh'}}>\n                            <div style={wrapper}>\n                                {ads.map((ad) => {\n                                    let category = Constants.categoryNames[ad.category]\n                                    let subcategory;\n                                    switch(category) {\n                                        case 'women':\n                                            subcategory = Constants.women[ad.subcategory].value;\n                                            break;\n                                        case 'men':\n                                            subcategory = Constants.men[ad.subcategory].value;\n                                            break;\n                                        case 'kids':\n                                            subcategory = Constants.kids[ad.subcategory].value;\n                                            break;\n                                        default:\n                                            subcategory = 0;\n                                    }\n                                    return (\n                                        <li key={ad.ad_id} style={{ listStyleType: \"none\" }}><NavLink exact to =\n                                        {'/listings/' + category + '/' + subcategory + '/item?' + ad.ad_id}>\n                                            <img src={'/' + ad.photo1_url} alt = {ad.ad_id + 'somephoto'} style={imgStyle}/>\n                                        </NavLink></li>)\n                \n                                    }\n                                )}\n                            </div>\n                        </div>\n                    </div>\n        }\n\n    }\n\n    render() {\n        const path = '/searchresults';\n\n        let numAds = this.state.ads.length;\n        let n = this.state.adsPerPage;\n        let p = this.state.page - 1;\n        let till;\n        p*n + n < numAds ? till = (p+1)*n : till = numAds;\n        let adsPortion = this.state.ads.slice(p*n, till);\n\n        return (\n                    <div className=\"App\">\n                        <UpperLine/>\n                         <Header/>\n                         <NavBar callBackParent = {this.onSearchChange}/>\n                         <BreadCrumbs pathname = {path}/>\n                            {this.toRender(adsPortion)}\n                        <div>\n                            <button id='first' className='btn_nopad' onClick={this.paginationButtonClick}>PRVA</button>\n                            <button id='previous' className='btn_nopad' onClick={this.paginationButtonClick}>&#60;&#60;</button>\n                            <button id='current' className='btn_nopad'>{this.state.page}/{this.state.numPages}</button>\n                            <button id='next' className='btn_nopad' onClick={this.paginationButtonClick}>&#62;&#62;</button>\n                            <button id='last' className='btn_nopad' onClick={this.paginationButtonClick}>ZADNJA</button>\n                        </div>\n                        <AdSpace/>\n                         <Bottom/>\n                     </div>\n        )\n    }\n\n}\n  \nexport default SearchResults;"]},"metadata":{},"sourceType":"module"}