{"ast":null,"code":"import _classCallCheck from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/APP/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'../../App.css';import{connect}from'react-redux';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import NavBar from'../../components/NavBar';import Bottom from'../../components/Bottom';import AdSpace from'../../components/AdSpace';import CartGroup from'./CartGroup';import BreadCrumbs from'../../components/BreadCrumbs';var ShoppingCartPage=/*#__PURE__*/function(_React$Component){_inherits(ShoppingCartPage,_React$Component);var _super=_createSuper(ShoppingCartPage);function ShoppingCartPage(props){var _this;_classCallCheck(this,ShoppingCartPage);_this=_super.call(this,props);_this.abortController=new AbortController();_this.getCart=function(){fetch('/sessionroutes',{signal:_this.abortController.signal}).then(function(res){return res.json();}).then(function(res){_this.setState({userId:res.userId});var cart=JSON.parse(window.localStorage.getItem(res.userId));if(cart){cart.length&&fetch('/cartListings',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify(cart)}).then(function(res){return res.json();}).then(function(res){_this.setState({sortedCart:res},function(){res.length!==cart.length&&_this.deleteFromStorage(res);});}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});!cart.length&&_this.setState({sortedCart:[]});}}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.reMount=function(){_this.getCart();};_this.deleteFromStorage=function(items){fetch('/sessionroutes',{signal:_this.abortController.signal}).then(function(res){return res.json();}).then(function(res){_this.removeFromCart(res,items);}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.removeFromCart=function(res,items){var cart=JSON.parse(window.localStorage.getItem(res.userId));for(var i=0;i<cart.length;i++){var d=0;for(var j=0;j<items.length;j++){if(cart[i]===items[j].ad_id.toString())d=1;}if(d===0){cart.splice(cart.indexOf(cart[i]),1);window.localStorage.setItem(res.userId,JSON.stringify(cart));}}};_this.listCart=function(){var sCart=_this.state.sortedCart;var componentArray=[];var sellerArray=[];var listingArray=[];if(sCart.length>0){var seller;var i=0;var j=0;while(i<sCart.length){seller=sCart[i].username;while(j<sCart.length&&sCart[j].username===seller){listingArray.push(sCart[j]);j++;}sellerArray.push(listingArray);componentArray.push(/*#__PURE__*/React.createElement(CartGroup,{key:j,items:listingArray,loggedInUserId:_this.props.loggedInUserId,callBackParent:_this.reMount,update:_this.update}));listingArray=[];i=j;}}return componentArray;};_this.update=function(){_this.setState({updated:_this.state.updated-1});};_this.showCart=function(){console.log(JSON.parse(window.localStorage.getItem(21)));console.log(_this.state.sortedCart);console.log(_this.state.cart);};_this.switchRender=function(){var len=_this.state.sortedCart.length;if(_this.state.userId==='0'){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"PROSIMO PRIJAVITE SE V SISTEM!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}else{return len?/*#__PURE__*/React.createElement(\"div\",{style:{padding:'30px'}},\" \",_this.listCart(),\" \"):/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"KO\\u0160ARICA JE PRAZNA!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}};_this.state={userId:'0',cart:[],sortedCart:[],updated:0};return _this;}_createClass(ShoppingCartPage,[{key:\"componentDidMount\",value:function componentDidMount(){this.getCart();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,{updated:this.state.updated}),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:this.props.location.pathname}),this.switchRender(),/*#__PURE__*/React.createElement(AdSpace,null),/*#__PURE__*/React.createElement(Bottom,null));}}]);return ShoppingCartPage;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{loggedInUser:state.loggedInUser,loggedInUserId:state.loggedInUserId};};export default connect(mapStateToProps)(ShoppingCartPage);","map":{"version":3,"sources":["/home/katni/APP/client/src/pages/ShoppingCart/ShoppingCartPage.jsx"],"names":["React","connect","UpperLine","Header","NavBar","Bottom","AdSpace","CartGroup","BreadCrumbs","ShoppingCartPage","props","abortController","AbortController","getCart","fetch","signal","then","res","json","setState","userId","cart","JSON","parse","window","localStorage","getItem","length","method","headers","body","stringify","sortedCart","deleteFromStorage","catch","e","console","error","message","reMount","items","removeFromCart","i","d","j","ad_id","toString","splice","indexOf","setItem","listCart","sCart","state","componentArray","sellerArray","listingArray","seller","username","push","loggedInUserId","update","updated","showCart","log","switchRender","len","backgroundColor","padding","abort","location","pathname","Component","mapStateToProps","loggedInUser"],"mappings":"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","sourcesContent":["import React from 'react';\nimport '../../App.css';\nimport { connect } from 'react-redux';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport Bottom from '../../components/Bottom';\nimport AdSpace from '../../components/AdSpace';\nimport CartGroup from './CartGroup';\nimport BreadCrumbs from '../../components/BreadCrumbs';\n\n\nclass ShoppingCartPage extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            userId: '0',\n            cart: [],\n            sortedCart: [],\n            updated: 0\n        };\n\n    }\n    abortController = new AbortController();\n\n    //zaenkrat ta komponenta ne potrebuje connecta na redux ker sem morala klicati userja iz baze:\n\n    getCart = () => {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => { this.setState({userId: res.userId});\n            let cart = JSON.parse(window.localStorage.getItem(res.userId));\n            if(cart) {\n                (cart.length) && fetch('/cartListings', {\n                    signal: this.abortController.signal,\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'Accept': 'application/json'\n                    },\n                    body: JSON.stringify(cart)\n                }).then(res => res.json())\n                    .then(res => {this.setState({sortedCart: res}, () => {(res.length !== cart.length) && this.deleteFromStorage(res)})})\n                    .catch(e => console.error(\"Critical failure: \" + e.message));\n\n                (!cart.length) && this.setState({sortedCart: []});\n            }\n        })\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    componentDidMount() {\n        this.getCart();\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n    }\n\n    reMount = () => {\n        this.getCart();\n    }\n\n    deleteFromStorage = (items) => {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => {this.removeFromCart(res, items);})\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    removeFromCart = (res, items) => {\n        let cart = JSON.parse(window.localStorage.getItem(res.userId));\n        for (let i = 0; i < cart.length; i++) {\n            let d = 0;\n            for (let j = 0; j < items.length; j++) {\n                if (cart[i] === items[j].ad_id.toString()) d = 1;\n            }\n            if (d === 0) {\n                cart.splice(cart.indexOf(cart[i]), 1);\n                window.localStorage.setItem(res.userId, JSON.stringify(cart));\n            }\n        }\n    }\n\n    listCart = () => {\n        const sCart = this.state.sortedCart;\n        let componentArray = [];\n        let sellerArray = [];\n        let listingArray = [];\n\n        if (sCart.length > 0) {\n            let seller;\n\n            let i = 0; let j = 0;\n            while (i < sCart.length) {\n                seller = sCart[i].username;\n                while (j < sCart.length && sCart[j].username === seller) {\n                    listingArray.push(sCart[j]);\n                    j++;\n                }\n                sellerArray.push(listingArray);\n                componentArray.push(<CartGroup\n                                        key={j}\n                                        items = {listingArray}\n                                        loggedInUserId = {this.props.loggedInUserId}\n                                        callBackParent = {this.reMount}\n                                        update = {this.update}/>);\n                listingArray = [];\n                i = j;\n            }\n        }   \n        return componentArray;\n    }\n\n    update = () => {\n        this.setState({updated: this.state.updated - 1});\n    }\n\n    showCart = () => {\n        console.log(JSON.parse(window.localStorage.getItem(21)));\n        console.log(this.state.sortedCart);\n        console.log(this.state.cart);\n    }\n\n    switchRender = () => {\n        let len = this.state.sortedCart.length;\n        if (this.state.userId === '0') {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                <br/><br/><br/>\n                <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                <br/><br/><br/>\n            </div>\n        } else {\n            return (\n                len ? <div style = {{padding: '30px'}}> {this.listCart()} </div> :\n                <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                    <br/><br/><br/>\n                    <h2>KOŠARICA JE PRAZNA!</h2>\n                    <br/><br/><br/>\n                </div>\n            )\n        }\n    }\n\n    render() {\n\n        return (\n            <div className=\"App\">\n                <UpperLine updated = {this.state.updated}/>\n                <Header/>\n                <NavBar/>\n                <BreadCrumbs pathname = {this.props.location.pathname}/>\n                {this.switchRender()}\n                <AdSpace/>\n                <Bottom/>\n            </div>\n        )\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId,\n    };\n};\n\nexport default connect(mapStateToProps) (ShoppingCartPage);\n"]},"metadata":{},"sourceType":"module"}