{"ast":null,"code":"var _jsxFileName = \"/home/katja/REACT/test-app/src/pages/ShoppingCart/ShoppingCartPage.jsx\";\nimport React from 'react';\nimport '../../App.css';\nimport { connect } from 'react-redux';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport Bottom from '../../components/Bottom';\nimport AdSpace from '../../components/AdSpace';\nimport CartGroup from './CartGroup';\nimport BreadCrumbs from '../../components/BreadCrumbs';\n\nclass ShoppingCartPage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.abortController = new AbortController();\n\n    this.getCart = () => {\n      fetch('/sessionroutes', {\n        signal: this.abortController.signal\n      }).then(res => res.json()).then(res => {\n        this.setState({\n          userId: res.userId\n        });\n        let cart = JSON.parse(window.localStorage.getItem(res.userId));\n\n        if (cart) {\n          cart.length && fetch('/cartListings', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json'\n            },\n            body: JSON.stringify(cart)\n          }).then(res => res.json()).then(res => {\n            this.setState({\n              sortedCart: res\n            }, () => {\n              res.length !== cart.length && this.deleteFromStorage(res);\n            });\n          }).catch(e => console.error(\"Critical failure: \" + e.message));\n          !cart.length && this.setState({\n            sortedCart: []\n          });\n        }\n      }).catch(e => console.error(\"Critical failure: \" + e.message));\n    };\n\n    this.reMount = () => {\n      console.log(\"remount called\");\n      this.getCart();\n      this.setState({\n        updated: 0\n      });\n    };\n\n    this.deleteFromStorage = items => {\n      fetch('/sessionroutes', {\n        signal: this.abortController.signal\n      }).then(res => res.json()).then(res => {\n        this.removeFromCart(res, items);\n      }).catch(e => console.error(\"Critical failure: \" + e.message));\n    };\n\n    this.removeFromCart = (res, items) => {\n      let cart = JSON.parse(window.localStorage.getItem(res.userId));\n\n      for (let i = 0; i < cart.length; i++) {\n        let d = 0;\n\n        for (let j = 0; j < items.length; j++) {\n          if (cart[i] === items[j].ad_id.toString()) d = 1;\n        }\n\n        if (d === 0) {\n          cart.splice(cart.indexOf(cart[i]), 1);\n          window.localStorage.setItem(res.userId, JSON.stringify(cart));\n        }\n      }\n    };\n\n    this.listCart = () => {\n      const sCart = this.state.sortedCart;\n      let componentArray = [];\n      let sellerArray = [];\n      let listingArray = [];\n\n      if (sCart.length > 0) {\n        let seller;\n        let i = 0;\n        let j = 0;\n\n        while (i < sCart.length) {\n          seller = sCart[i].username;\n\n          while (j < sCart.length && sCart[j].username === seller) {\n            listingArray.push(sCart[j]);\n            j++;\n          }\n\n          sellerArray.push(listingArray);\n          componentArray.push( /*#__PURE__*/React.createElement(CartGroup, {\n            key: j,\n            items: listingArray,\n            loggedInUserId: this.props.loggedInUserId,\n            callBackParent: this.reMount,\n            update: this.update,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 105,\n              columnNumber: 37\n            }\n          }));\n          listingArray = [];\n          i = j;\n        }\n      }\n\n      return componentArray;\n    };\n\n    this.update = value => {\n      this.setState({\n        updated: value\n      });\n    };\n\n    this.showCart = () => {\n      console.log(JSON.parse(window.localStorage.getItem(21)));\n      console.log(this.state.sortedCart);\n      console.log(this.state.cart);\n    };\n\n    this.switchRender = () => {\n      let len = this.state.sortedCart.length;\n\n      if (this.state.userId === '0') {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          style: {\n            backgroundColor: 'rgb(255,255,255,0.5)'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 20\n          }\n        }, /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 132,\n            columnNumber: 17\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 132,\n            columnNumber: 22\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 132,\n            columnNumber: 27\n          }\n        }), /*#__PURE__*/React.createElement(\"h2\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 17\n          }\n        }, \"PROSIMO PRIJAVITE SE V SISTEM!\"), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 17\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 22\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 27\n          }\n        }));\n      } else {\n        return len ? /*#__PURE__*/React.createElement(\"div\", {\n          style: {\n            padding: '30px'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 23\n          }\n        }, \" \", this.listCart(), \" \") : /*#__PURE__*/React.createElement(\"div\", {\n          style: {\n            backgroundColor: 'rgb(255,255,255,0.5)'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 139,\n            columnNumber: 17\n          }\n        }, /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 21\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 26\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 31\n          }\n        }), /*#__PURE__*/React.createElement(\"h2\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 141,\n            columnNumber: 21\n          }\n        }, \"KO\\u0160ARICA JE PRAZNA!\"), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 21\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 26\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 31\n          }\n        }));\n      }\n    };\n\n    this.state = {\n      userId: '0',\n      cart: [],\n      sortedCart: [],\n      updated: 0\n    };\n  }\n\n  componentDidMount() {\n    this.getCart();\n  }\n\n  componentWillUnmount() {\n    this.abortController.abort();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(UpperLine, {\n      updated: this.state.updated,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(Header, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(NavBar, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(BreadCrumbs, {\n      pathname: this.props.location.pathname,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 17\n      }\n    }), this.switchRender(), /*#__PURE__*/React.createElement(AdSpace, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(Bottom, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    loggedInUser: state.loggedInUser,\n    loggedInUserId: state.loggedInUserId\n  };\n};\n\nexport default connect(mapStateToProps)(ShoppingCartPage);","map":{"version":3,"sources":["/home/katja/REACT/test-app/src/pages/ShoppingCart/ShoppingCartPage.jsx"],"names":["React","connect","UpperLine","Header","NavBar","Bottom","AdSpace","CartGroup","BreadCrumbs","ShoppingCartPage","Component","constructor","props","abortController","AbortController","getCart","fetch","signal","then","res","json","setState","userId","cart","JSON","parse","window","localStorage","getItem","length","method","headers","body","stringify","sortedCart","deleteFromStorage","catch","e","console","error","message","reMount","log","updated","items","removeFromCart","i","d","j","ad_id","toString","splice","indexOf","setItem","listCart","sCart","state","componentArray","sellerArray","listingArray","seller","username","push","loggedInUserId","update","value","showCart","switchRender","len","backgroundColor","padding","componentDidMount","componentWillUnmount","abort","render","location","pathname","mapStateToProps","loggedInUser"],"mappings":"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","sourcesContent":["import React from 'react';\nimport '../../App.css';\nimport { connect } from 'react-redux';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport Bottom from '../../components/Bottom';\nimport AdSpace from '../../components/AdSpace';\nimport CartGroup from './CartGroup';\nimport BreadCrumbs from '../../components/BreadCrumbs';\n\n\nclass ShoppingCartPage extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            userId: '0',\n            cart: [],\n            sortedCart: [],\n            updated: 0\n        };\n\n    }\n    abortController = new AbortController();\n\n    //zaenkrat ta komponenta ne potrebuje connecta na redux ker sem morala klicati userja iz baze:\n\n    getCart = () => {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => { this.setState({userId: res.userId});\n            let cart = JSON.parse(window.localStorage.getItem(res.userId));\n            if(cart) {\n                (cart.length) && fetch('/cartListings', {\n                    signal: this.abortController.signal,\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'Accept': 'application/json'\n                    },\n                    body: JSON.stringify(cart)\n                }).then(res => res.json())\n                    .then(res => {this.setState({sortedCart: res}, () => {(res.length !== cart.length) && this.deleteFromStorage(res)})})\n                    .catch(e => console.error(\"Critical failure: \" + e.message));\n\n                (!cart.length) && this.setState({sortedCart: []});\n            }\n        })\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    componentDidMount() {\n        this.getCart();\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n    }\n\n    reMount = () => {\n        console.log(\"remount called\");\n        this.getCart();\n        this.setState({updated: 0});\n    }\n\n    deleteFromStorage = (items) => {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => {this.removeFromCart(res, items);})\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    removeFromCart = (res, items) => {\n        let cart = JSON.parse(window.localStorage.getItem(res.userId));\n        for (let i = 0; i < cart.length; i++) {\n            let d = 0;\n            for (let j = 0; j < items.length; j++) {\n                if (cart[i] === items[j].ad_id.toString()) d = 1;\n            }\n            if (d === 0) {\n                cart.splice(cart.indexOf(cart[i]), 1);\n                window.localStorage.setItem(res.userId, JSON.stringify(cart));\n            }\n        }\n    }\n\n    listCart = () => {\n        const sCart = this.state.sortedCart;\n        let componentArray = [];\n        let sellerArray = [];\n        let listingArray = [];\n\n        if (sCart.length > 0) {\n            let seller;\n\n            let i = 0; let j = 0;\n            while (i < sCart.length) {\n                seller = sCart[i].username;\n                while (j < sCart.length && sCart[j].username === seller) {\n                    listingArray.push(sCart[j]);\n                    j++;\n                }\n                sellerArray.push(listingArray);\n                componentArray.push(<CartGroup\n                                        key={j}\n                                        items = {listingArray}\n                                        loggedInUserId = {this.props.loggedInUserId}\n                                        callBackParent = {this.reMount}\n                                        update = {this.update}/>);\n                listingArray = [];\n                i = j;\n            }\n        }   \n        return componentArray;\n    }\n\n    update = (value) => {\n        this.setState({updated: value});\n    }\n\n    showCart = () => {\n        console.log(JSON.parse(window.localStorage.getItem(21)));\n        console.log(this.state.sortedCart);\n        console.log(this.state.cart);\n    }\n\n    switchRender = () => {\n        let len = this.state.sortedCart.length;\n        if (this.state.userId === '0') {\n            return <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                <br/><br/><br/>\n                <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                <br/><br/><br/>\n            </div>\n        } else {\n            return (\n                len ? <div style = {{padding: '30px'}}> {this.listCart()} </div> :\n                <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                    <br/><br/><br/>\n                    <h2>KOŠARICA JE PRAZNA!</h2>\n                    <br/><br/><br/>\n                </div>\n            )\n        }\n    }\n\n    render() {\n\n        return (\n            <div className=\"App\">\n                <UpperLine updated = {this.state.updated}/>\n                <Header/>\n                <NavBar/>\n                <BreadCrumbs pathname = {this.props.location.pathname}/>\n                {this.switchRender()}\n                <AdSpace/>\n                <Bottom/>\n            </div>\n        )\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId,\n    };\n};\n\nexport default connect(mapStateToProps) (ShoppingCartPage);\n"]},"metadata":{},"sourceType":"module"}