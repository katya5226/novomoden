{"ast":null,"code":"import _classCallCheck from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/katni/REACT/test-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{connect}from'react-redux';import{NavLink}from'react-router-dom';import UpperLine from'../../components/UpperLine';import Header from'../../components/Header';import NavBar from'../../components/NavBar';import UserSideBar from'./UserSideBar';import Bottom from'../../components/Bottom';import BreadCrumbs from'../../components/BreadCrumbs';import AdSpace from'../../components/AdSpace';import Popup from'reactjs-popup';import*as Constants from'../../constants';import'../../App.css';var UserListings=/*#__PURE__*/function(_React$Component){_inherits(UserListings,_React$Component);var _super=_createSuper(UserListings);function UserListings(props){var _this;_classCallCheck(this,UserListings);_this=_super.call(this,props);_this.abortController=new AbortController();_this.handleDeleteRequest=function(id){_this.setState({tryingToDelete:id});};_this.handleDelete=function(id){fetch('/deleteListing',{signal:_this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({adId:id})}).then(function(res){return res.json();}).then(function(res){return res.success&&_this.setState({tryingToDelete:-1});}).then(function(){return _this.displayPhotos(_this.props.loggedInUserId);}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});};_this.cancelDelete=function(){_this.setState({tryingToDelete:-1});};_this.paginationButtonClick=function(e){var newpage=1;switch(e.target.id){case'first':_this.setState({page:1});break;case'previous':_this.state.page>1?newpage=_this.state.page-1:newpage=1;_this.setState({page:newpage});break;case'next':_this.state.page<_this.state.numPages?newpage=_this.state.page+1:newpage=_this.state.numPages;_this.setState({page:newpage});break;case'last':_this.setState({page:_this.state.numPages});break;default:return null;}};_this.renderListings=function(){var imgStyle={height:\"290px\",verticalAlign:\"middle\",marginRight:\"20px\",border:'2px solid rgb(255, 255, 255, 0.5)'};var textStyle={color:'black',textDecoration:'underline',fontWeight:'500'};var numAds=_this.state.listings.length;var n=_this.state.adsPerPage;var p=_this.state.page-1;var till;p*n+n<numAds?till=(p+1)*n:till=numAds;var adsPortion=_this.state.listings.slice(p*n,till);return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{style:{width:\"100%\",verticalAlign:'top',textAlign:'right'}},/*#__PURE__*/React.createElement(NavLink,{exact:true,to:\"/upload\",className:\"btn\"},/*#__PURE__*/React.createElement(\"b\",null,\"+ OBJAVI NOV OGLAS\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"listingWrapper\"},adsPortion.map(function(listing){var category=Constants.category[listing.category].value;var subcategory='';switch(category){case'women':subcategory=Constants.women[listing.subcategory].value;break;case'men':subcategory=Constants.men[listing.subcategory].value;break;case'kids':subcategory=Constants.kids[listing.subcategory].value;break;default:subcategory='';}return/*#__PURE__*/React.createElement(\"li\",{key:listing.ad_id,style:{listStyleType:\"none\"}},/*#__PURE__*/React.createElement(\"img\",{src:listing.photo1_url,alt:listing.photo1_url,style:imgStyle}),/*#__PURE__*/React.createElement(\"span\",{style:{verticalAlign:\"middle\",display:\"inline-block\",height:\"100%\"}}),/*#__PURE__*/React.createElement(\"div\",{style:{width:'60%',height:'80%',float:'right',padding:'20px'}},/*#__PURE__*/React.createElement(\"p\",null,\"\\u0160tevilka oglasa: \",/*#__PURE__*/React.createElement(NavLink,{to:'listings/'+category+'/'+subcategory+'/item?'+listing.ad_id,style:textStyle},listing.ad_id)),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(NavLink,{to:\"/edit?\"+listing.ad_id,style:textStyle},\"  UREJANJE\")),/*#__PURE__*/React.createElement(\"button\",{style:{backgroundColor:'rgb(255,255,255,0)',border:'none',cursor:'pointer'},onClick:function onClick(){return _this.handleDeleteRequest(listing.ad_id);}},\"X IZBRI\\u0160I\")));}),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{id:\"first\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"PRVA\"),/*#__PURE__*/React.createElement(\"button\",{id:\"previous\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"<<\"),/*#__PURE__*/React.createElement(\"button\",{id:\"current\",className:\"btn_nopad\"},_this.state.page,\"/\",_this.state.numPages),/*#__PURE__*/React.createElement(\"button\",{id:\"next\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\">>\"),/*#__PURE__*/React.createElement(\"button\",{id:\"last\",className:\"btn_nopad\",onClick:_this.paginationButtonClick},\"ZADNJA\"))));};_this.switchRender=function(){if(_this.state.userId==='0'){return/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'rgb(255,255,255,0.5)'}},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"PROSIMO PRIJAVITE SE V SISTEM!\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null));}else if(!_this.state.listings.length){return/*#__PURE__*/React.createElement(\"div\",{className:\"userContainer\"},/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'center'}},/*#__PURE__*/React.createElement(\"h2\",{style:{color:'white'}},\"NIMATE \\u0160E OBJAVLJENIH OGLASOV.\")),/*#__PURE__*/React.createElement(\"div\",{style:{width:\"100%\",verticalAlign:'top',textAlign:'right'}},/*#__PURE__*/React.createElement(NavLink,{exact:true,to:\"/upload\",className:\"btn\"},/*#__PURE__*/React.createElement(\"b\",null,\"+ OBJAVI NOV OGLAS\"))));}else if(_this.state.listings.length&&_this.state.tryingToDelete!==-1){return/*#__PURE__*/React.createElement(\"div\",{className:\"userContainer\"},/*#__PURE__*/React.createElement(Popup,{open:true,position:\"center center\",onClose:_this.closeModal},/*#__PURE__*/React.createElement(\"div\",{style:{display:'inline-flex',justifyContent:'space-around'}},/*#__PURE__*/React.createElement(\"p\",{style:{margin:'auto 10px'}},\"Ste prepri\\u010Dani, da \\u017Eelite izbrisati oglas?\"),/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:function onClick(){return _this.handleDelete(_this.state.tryingToDelete);}},\"DA\"),/*#__PURE__*/React.createElement(\"button\",{className:\"btnb\",onClick:_this.cancelDelete},\"NE\"))),_this.renderListings());}else{return/*#__PURE__*/React.createElement(\"div\",{className:\"userContainer\"},_this.renderListings());}};_this.state={userId:'0',urls:[],listings:[],tryingToDelete:-1,adsPerPage:5,numPages:1,page:1};_this.displayPhotos=_this.displayPhotos.bind(_assertThisInitialized(_this));return _this;}_createClass(UserListings,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;fetch('/sessionroutes',{signal:this.abortController.signal}).then(function(res){return res.json();}).then(function(res){_this2.setState({userId:res.userId});_this2.displayPhotos(res.userId);}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.abortController.abort();}},{key:\"displayPhotos\",value:function displayPhotos(uid){var _this3=this;fetch('/photos',{signal:this.abortController.signal,method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({userId:uid})}).then(function(res){return res.json();}).then(function(listings){if(!listings.length){_this3.setState({listings:[]});}else{_this3.setState({listings:listings,numPages:Math.floor(listings.length/_this3.state.adsPerPage+0.99)});};}).catch(function(e){return console.error(\"Critical failure: \"+e.message);});}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(UpperLine,null),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(NavBar,null),/*#__PURE__*/React.createElement(BreadCrumbs,{pathname:this.props.location.pathname}),/*#__PURE__*/React.createElement(UserSideBar,null),this.switchRender(),/*#__PURE__*/React.createElement(AdSpace,null),/*#__PURE__*/React.createElement(Bottom,null));}}]);return UserListings;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{loggedInUser:state.loggedInUser,loggedInUserId:state.loggedInUserId};};export default connect(mapStateToProps)(UserListings);","map":{"version":3,"sources":["/home/katni/REACT/test-app/src/pages/UserPage/UserListings.jsx"],"names":["React","connect","NavLink","UpperLine","Header","NavBar","UserSideBar","Bottom","BreadCrumbs","AdSpace","Popup","Constants","UserListings","props","abortController","AbortController","handleDeleteRequest","id","setState","tryingToDelete","handleDelete","fetch","signal","method","headers","body","JSON","stringify","adId","then","res","json","success","displayPhotos","loggedInUserId","catch","e","console","error","message","cancelDelete","paginationButtonClick","newpage","target","page","state","numPages","renderListings","imgStyle","height","verticalAlign","marginRight","border","textStyle","color","textDecoration","fontWeight","numAds","listings","length","n","adsPerPage","p","till","adsPortion","slice","width","textAlign","map","listing","category","value","subcategory","women","men","kids","ad_id","listStyleType","photo1_url","display","float","padding","backgroundColor","cursor","switchRender","userId","closeModal","justifyContent","margin","urls","bind","abort","uid","Math","floor","location","pathname","Component","mapStateToProps","loggedInUser"],"mappings":"qtBAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,OAAT,KAAwB,kBAAxB,CACA,MAAOC,CAAAA,SAAP,KAAsB,4BAAtB,CACA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,WAAP,KAAwB,8BAAxB,CACA,MAAOC,CAAAA,OAAP,KAAoB,0BAApB,CACA,MAAOC,CAAAA,KAAP,KAAkB,eAAlB,CACA,MAAO,GAAKC,CAAAA,SAAZ,KAA2B,iBAA3B,CACA,MAAO,eAAP,C,GAGMC,CAAAA,Y,wHAEL,sBAAYC,KAAZ,CAAmB,8CAClB,uBAAMA,KAAN,EADkB,MAgBhBC,eAhBgB,CAgBE,GAAIC,CAAAA,eAAJ,EAhBF,OA6ChBC,mBA7CgB,CA6CM,SAACC,EAAD,CAAQ,CAC1B,MAAKC,QAAL,CAAc,CAACC,cAAc,CAAEF,EAAjB,CAAd,EACH,CA/Ce,OAiDhBG,YAjDgB,CAiDD,SAACH,EAAD,CAAQ,CAEnBI,KAAK,CAAC,gBAAD,CAAmB,CACpBC,MAAM,CAAE,MAAKR,eAAL,CAAqBQ,MADT,CAEpBC,MAAM,CAAE,MAFY,CAGpBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,SAAU,kBAFL,CAHW,CAOpBC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CAACC,IAAI,CAAEX,EAAP,CAAf,CAPc,CAAnB,CAAL,CAQGY,IARH,CAQQ,SAAAC,GAAG,QAAIA,CAAAA,GAAG,CAACC,IAAJ,EAAJ,EARX,EASCF,IATD,CASM,SAAAC,GAAG,QAAIA,CAAAA,GAAG,CAACE,OAAJ,EAAe,MAAKd,QAAL,CAAc,CAACC,cAAc,CAAE,CAAC,CAAlB,CAAd,CAAnB,EATT,EAUCU,IAVD,CAUM,iBAAM,OAAKI,aAAL,CAAmB,MAAKpB,KAAL,CAAWqB,cAA9B,CAAN,EAVN,EAWCC,KAXD,CAWO,SAAAC,CAAC,QAAIC,CAAAA,OAAO,CAACC,KAAR,CAAc,qBAAuBF,CAAC,CAACG,OAAvC,CAAJ,EAXR,EAaH,CAhEe,OAkEhBC,YAlEgB,CAkED,UAAM,CACjB,MAAKtB,QAAL,CAAc,CAACC,cAAc,CAAE,CAAC,CAAlB,CAAd,EACH,CApEe,OAsEhBsB,qBAtEgB,CAsEQ,SAACL,CAAD,CAAO,CAC3B,GAAIM,CAAAA,OAAO,CAAG,CAAd,CACA,OAAON,CAAC,CAACO,MAAF,CAAS1B,EAAhB,EACI,IAAK,OAAL,CACI,MAAKC,QAAL,CAAc,CAAC0B,IAAI,CAAE,CAAP,CAAd,EACA,MACJ,IAAK,UAAL,CACI,MAAKC,KAAL,CAAWD,IAAX,CAAkB,CAAlB,CAAsBF,OAAO,CAAG,MAAKG,KAAL,CAAWD,IAAX,CAAgB,CAAhD,CAAoDF,OAAO,CAAG,CAA9D,CACA,MAAKxB,QAAL,CAAc,CAAC0B,IAAI,CAAEF,OAAP,CAAd,EACA,MACJ,IAAK,MAAL,CACI,MAAKG,KAAL,CAAWD,IAAX,CAAkB,MAAKC,KAAL,CAAWC,QAA7B,CAAwCJ,OAAO,CAAG,MAAKG,KAAL,CAAWD,IAAX,CAAgB,CAAlE,CAAsEF,OAAO,CAAG,MAAKG,KAAL,CAAWC,QAA3F,CACA,MAAK5B,QAAL,CAAc,CAAC0B,IAAI,CAAEF,OAAP,CAAd,EACA,MACJ,IAAK,MAAL,CACI,MAAKxB,QAAL,CAAc,CAAC0B,IAAI,CAAE,MAAKC,KAAL,CAAWC,QAAlB,CAAd,EACA,MACJ,QACI,MAAO,KAAP,CAhBR,CAkBH,CA1Fe,OA4FhBC,cA5FgB,CA4FC,UAAM,CAEnB,GAAMC,CAAAA,QAAQ,CAAG,CACbC,MAAM,CAAE,OADK,CAEbC,aAAa,CAAE,QAFF,CAGbC,WAAW,CAAE,MAHA,CAIbC,MAAM,CAAE,mCAJK,CAAjB,CAOA,GAAMC,CAAAA,SAAS,CAAG,CACdC,KAAK,CAAE,OADO,CAEdC,cAAc,CAAE,WAFF,CAGdC,UAAU,CAAE,KAHE,CAAlB,CAMA,GAAIC,CAAAA,MAAM,CAAG,MAAKZ,KAAL,CAAWa,QAAX,CAAoBC,MAAjC,CACA,GAAIC,CAAAA,CAAC,CAAG,MAAKf,KAAL,CAAWgB,UAAnB,CACA,GAAIC,CAAAA,CAAC,CAAG,MAAKjB,KAAL,CAAWD,IAAX,CAAkB,CAA1B,CACA,GAAImB,CAAAA,IAAJ,CACAD,CAAC,CAACF,CAAF,CAAMA,CAAN,CAAUH,MAAV,CAAmBM,IAAI,CAAG,CAACD,CAAC,CAAC,CAAH,EAAMF,CAAhC,CAAoCG,IAAI,CAAGN,MAA3C,CACA,GAAIO,CAAAA,UAAU,CAAG,MAAKnB,KAAL,CAAWa,QAAX,CAAoBO,KAApB,CAA0BH,CAAC,CAACF,CAA5B,CAA+BG,IAA/B,CAAjB,CAEA,mBAAQ,4CACI,2BAAK,KAAK,CAAE,CAACG,KAAK,CAAE,MAAR,CAAgBhB,aAAa,CAAE,KAA/B,CAAsCiB,SAAS,CAAE,OAAjD,CAAZ,eACI,oBAAC,OAAD,EAAS,KAAK,KAAd,CAAe,EAAE,CAAC,SAAlB,CAA4B,SAAS,CAAG,KAAxC,eAA8C,kDAA9C,CADJ,CADJ,cAII,2BAAK,SAAS,CAAC,gBAAf,EACKH,UAAU,CAACI,GAAX,CAAe,SAACC,OAAD,CACZ,CACI,GAAIC,CAAAA,QAAQ,CAAG3D,SAAS,CAAC2D,QAAV,CAAmBD,OAAO,CAACC,QAA3B,EAAqCC,KAApD,CACA,GAAIC,CAAAA,WAAW,CAAG,EAAlB,CACA,OAAOF,QAAP,EACI,IAAK,OAAL,CACIE,WAAW,CAAG7D,SAAS,CAAC8D,KAAV,CAAgBJ,OAAO,CAACG,WAAxB,EAAqCD,KAAnD,CACA,MACJ,IAAK,KAAL,CACIC,WAAW,CAAG7D,SAAS,CAAC+D,GAAV,CAAcL,OAAO,CAACG,WAAtB,EAAmCD,KAAjD,CACA,MACJ,IAAK,MAAL,CACIC,WAAW,CAAG7D,SAAS,CAACgE,IAAV,CAAeN,OAAO,CAACG,WAAvB,EAAoCD,KAAlD,CACA,MACJ,QACIC,WAAW,CAAG,EAAd,CAXR,CAaA,mBACA,0BAAI,GAAG,CAAEH,OAAO,CAACO,KAAjB,CAAwB,KAAK,CAAE,CAAEC,aAAa,CAAE,MAAjB,CAA/B,eACI,2BAAK,GAAG,CAAER,OAAO,CAACS,UAAlB,CAA8B,GAAG,CAAET,OAAO,CAACS,UAA3C,CAAuD,KAAK,CAAE9B,QAA9D,EADJ,cAC6E,4BAAM,KAAK,CAAE,CAACE,aAAa,CAAE,QAAhB,CAA0B6B,OAAO,CAAE,cAAnC,CAAmD9B,MAAM,CAAE,MAA3D,CAAb,EAD7E,cAEI,2BAAK,KAAK,CAAI,CAACiB,KAAK,CAAE,KAAR,CAAejB,MAAM,CAAE,KAAvB,CAA8B+B,KAAK,CAAE,OAArC,CAA8CC,OAAO,CAAE,MAAvD,CAAd,eACI,mEAAoB,oBAAC,OAAD,EAAS,EAAE,CAAE,YAAcX,QAAd,CAAyB,GAAzB,CAA+BE,WAA/B,CAA6C,QAA7C,CAAwDH,OAAO,CAACO,KAA7E,CAAoF,KAAK,CAAIvB,SAA7F,EAAyGgB,OAAO,CAACO,KAAjH,CAApB,CADJ,cAEI,0CAAG,oBAAC,OAAD,EAAS,EAAE,CAAE,SAAWP,OAAO,CAACO,KAAhC,CAAuC,KAAK,CAAIvB,SAAhD,eAAH,CAFJ,cAGI,8BAAQ,KAAK,CAAI,CAAC6B,eAAe,CAAE,oBAAlB,CAAwC9B,MAAM,CAAE,MAAhD,CAAwD+B,MAAM,CAAE,SAAhE,CAAjB,CAA6F,OAAO,CAAI,yBAAM,OAAKnE,mBAAL,CAAyBqD,OAAO,CAACO,KAAjC,CAAN,EAAxG,mBAHJ,CAFJ,CADA,CASH,CA1BJ,CADL,cA6BI,4CACI,8BAAQ,EAAE,CAAC,OAAX,CAAmB,SAAS,CAAC,WAA7B,CAAyC,OAAO,CAAE,MAAKnC,qBAAvD,SADJ,cAEI,8BAAQ,EAAE,CAAC,UAAX,CAAsB,SAAS,CAAC,WAAhC,CAA4C,OAAO,CAAE,MAAKA,qBAA1D,OAFJ,cAGI,8BAAQ,EAAE,CAAC,SAAX,CAAqB,SAAS,CAAC,WAA/B,EAA4C,MAAKI,KAAL,CAAWD,IAAvD,KAA8D,MAAKC,KAAL,CAAWC,QAAzE,CAHJ,cAII,8BAAQ,EAAE,CAAC,MAAX,CAAkB,SAAS,CAAC,WAA5B,CAAwC,OAAO,CAAE,MAAKL,qBAAtD,OAJJ,cAKI,8BAAQ,EAAE,CAAC,MAAX,CAAkB,SAAS,CAAC,WAA5B,CAAwC,OAAO,CAAE,MAAKA,qBAAtD,WALJ,CA7BJ,CAJJ,CAAR,CA0CH,CA5Je,OA8JhB2C,YA9JgB,CA8JD,UAAM,CAEjB,GAAG,MAAKvC,KAAL,CAAWwC,MAAX,GAAsB,GAAzB,CAA8B,CAC1B,mBACI,2BAAK,KAAK,CAAI,CAACH,eAAe,CAAE,sBAAlB,CAAd,eACI,8BADJ,cACS,8BADT,cACc,8BADd,cAEI,+DAFJ,cAGI,8BAHJ,cAGS,8BAHT,cAGc,8BAHd,CADJ,CAOH,CARD,IASK,IAAG,CAAC,MAAKrC,KAAL,CAAWa,QAAX,CAAoBC,MAAxB,CAAgC,CACjC,mBACI,2BAAK,SAAS,CAAC,eAAf,eACI,2BAAK,KAAK,CAAI,CAACQ,SAAS,CAAE,QAAZ,CAAd,eACI,0BAAI,KAAK,CAAI,CAACb,KAAK,CAAE,OAAR,CAAb,wCADJ,CADJ,cAII,2BAAK,KAAK,CAAE,CAACY,KAAK,CAAE,MAAR,CAAgBhB,aAAa,CAAE,KAA/B,CAAsCiB,SAAS,CAAE,OAAjD,CAAZ,eACI,oBAAC,OAAD,EAAS,KAAK,KAAd,CAAe,EAAE,CAAC,SAAlB,CAA4B,SAAS,CAAG,KAAxC,eAA8C,kDAA9C,CADJ,CAJJ,CADJ,CAUH,CAXI,IAWE,IAAG,MAAKtB,KAAL,CAAWa,QAAX,CAAoBC,MAApB,EAA8B,MAAKd,KAAL,CAAW1B,cAAX,GAA8B,CAAC,CAAhE,CAAmE,CACtE,mBACI,2BAAK,SAAS,CAAC,eAAf,eACA,oBAAC,KAAD,EAAO,IAAI,CAAI,IAAf,CACA,QAAQ,CAAG,eADX,CAEA,OAAO,CAAE,MAAKmE,UAFd,eAGI,2BAAK,KAAK,CAAI,CAACP,OAAO,CAAE,aAAV,CAAyBQ,cAAc,CAAE,cAAzC,CAAd,eACI,yBAAG,KAAK,CAAG,CAACC,MAAM,CAAE,WAAT,CAAX,yDADJ,cAEI,8BAAQ,SAAS,CAAG,MAApB,CAA2B,OAAO,CAAG,yBAAM,OAAKpE,YAAL,CAAkB,MAAKyB,KAAL,CAAW1B,cAA7B,CAAN,EAArC,OAFJ,cAGI,8BAAQ,SAAS,CAAG,MAApB,CAA2B,OAAO,CAAI,MAAKqB,YAA3C,OAHJ,CAHJ,CADA,CAUC,MAAKO,cAAL,EAVD,CADJ,CAeH,CAhBM,IAgBD,CACF,mBACI,2BAAK,SAAS,CAAC,eAAf,EACK,MAAKA,cAAL,EADL,CADJ,CAMH,CACJ,CA5Me,CAElB,MAAKF,KAAL,CAAa,CACHwC,MAAM,CAAE,GADL,CAEHI,IAAI,CAAE,EAFH,CAGH/B,QAAQ,CAAE,EAHP,CAIHvC,cAAc,CAAE,CAAC,CAJd,CAKH0C,UAAU,CAAE,CALT,CAMHf,QAAQ,CAAE,CANP,CAOHF,IAAI,CAAE,CAPH,CAAb,CAUM,MAAKX,aAAL,CAAqB,MAAKA,aAAL,CAAmByD,IAAnB,+BAArB,CAZY,aAcf,C,sFAGgB,iBACbrE,KAAK,CAAC,gBAAD,CAAmB,CAACC,MAAM,CAAE,KAAKR,eAAL,CAAqBQ,MAA9B,CAAnB,CAAL,CACCO,IADD,CACM,SAAAC,GAAG,QAAIA,CAAAA,GAAG,CAACC,IAAJ,EAAJ,EADT,EAECF,IAFD,CAEM,SAAAC,GAAG,CAAI,CAAC,MAAI,CAACZ,QAAL,CAAc,CAACmE,MAAM,CAAEvD,GAAG,CAACuD,MAAb,CAAd,EAAqC,MAAI,CAACpD,aAAL,CAAmBH,GAAG,CAACuD,MAAvB,EAA+B,CAFlF,EAGClD,KAHD,CAGO,SAAAC,CAAC,QAAIC,CAAAA,OAAO,CAACC,KAAR,CAAc,qBAAuBF,CAAC,CAACG,OAAvC,CAAJ,EAHR,EAIH,C,mEAEsB,CACnB,KAAKzB,eAAL,CAAqB6E,KAArB,GACH,C,oDAEaC,G,CAAK,iBACfvE,KAAK,CAAC,SAAD,CAAY,CACbC,MAAM,CAAE,KAAKR,eAAL,CAAqBQ,MADhB,CAEbC,MAAM,CAAE,MAFK,CAGbC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,SAAU,kBAFL,CAHI,CAObC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CAAC0D,MAAM,CAAEO,GAAT,CAAf,CAPO,CAAZ,CAAL,CAQG/D,IARH,CAQQ,SAAAC,GAAG,QAAIA,CAAAA,GAAG,CAACC,IAAJ,EAAJ,EARX,EASKF,IATL,CASU,SAAA6B,QAAQ,CAAI,CAAE,GAAI,CAACA,QAAQ,CAACC,MAAd,CAAsB,CAAE,MAAI,CAACzC,QAAL,CAAc,CAACwC,QAAQ,CAAE,EAAX,CAAd,EAA+B,CAAvD,IACR,CAAE,MAAI,CAACxC,QAAL,CAAc,CAACwC,QAAQ,CAAEA,QAAX,CAAqBZ,QAAQ,CAAE+C,IAAI,CAACC,KAAL,CAAWpC,QAAQ,CAACC,MAAT,CAAgB,MAAI,CAACd,KAAL,CAAWgB,UAA3B,CAAwC,IAAnD,CAA/B,CAAd,EAAyG,EACtH,CAXL,EAYK1B,KAZL,CAYW,SAAAC,CAAC,QAAIC,CAAAA,OAAO,CAACC,KAAR,CAAc,qBAAuBF,CAAC,CAACG,OAAvC,CAAJ,EAZZ,EAcH,C,uCAmKQ,CACL,mBACI,2BAAK,SAAS,CAAC,KAAf,eACA,oBAAC,SAAD,MADA,cAEA,oBAAC,MAAD,MAFA,cAGA,oBAAC,MAAD,MAHA,cAIA,oBAAC,WAAD,EAAa,QAAQ,CAAI,KAAK1B,KAAL,CAAWkF,QAAX,CAAoBC,QAA7C,EAJA,cAKA,oBAAC,WAAD,MALA,CAMC,KAAKZ,YAAL,EAND,cAOA,oBAAC,OAAD,MAPA,cAQA,oBAAC,MAAD,MARA,CADJ,CAYH,C,0BA7NsBpF,KAAK,CAACiG,S,EAiOjC,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAArD,KAAK,CAAI,CAC7B,MAAO,CACLsD,YAAY,CAAEtD,KAAK,CAACsD,YADf,CAELjE,cAAc,CAAEW,KAAK,CAACX,cAFjB,CAAP,CAID,CALH,CAQA,cAAejC,CAAAA,OAAO,CAACiG,eAAD,CAAP,CAA0BtF,YAA1B,CAAf","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport { NavLink } from 'react-router-dom';\nimport UpperLine from '../../components/UpperLine';\nimport Header from '../../components/Header';\nimport NavBar from '../../components/NavBar';\nimport UserSideBar from './UserSideBar';\nimport Bottom from '../../components/Bottom';\nimport BreadCrumbs from '../../components/BreadCrumbs';\nimport AdSpace from '../../components/AdSpace';\nimport Popup from 'reactjs-popup';\nimport * as Constants from '../../constants';\nimport '../../App.css';\n\n\nclass UserListings extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n            userId: '0',\n            urls: [],\n            listings: [],\n            tryingToDelete: -1,\n            adsPerPage: 5,\n            numPages: 1,\n            page: 1\n        };\n\n        this.displayPhotos = this.displayPhotos.bind(this);\n\n    }\n\n    abortController = new AbortController();\n\tcomponentDidMount() {\n        fetch('/sessionroutes', {signal: this.abortController.signal})\n        .then(res => res.json())\n        .then(res => {this.setState({userId: res.userId}); this.displayPhotos(res.userId)})\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n    }\n\n    componentWillUnmount() {\n        this.abortController.abort();\n    }\n\n    displayPhotos(uid) {\n        fetch('/photos', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({userId: uid})\n        }).then(res => res.json())\n            .then(listings => { if (!listings.length) { this.setState({listings: []}) }\n                    else{ this.setState({listings: listings, numPages: Math.floor(listings.length/this.state.adsPerPage + 0.99)}) };\n            })\n            .catch(e => console.error(\"Critical failure: \" + e.message));\n\n    }\n\n    handleDeleteRequest = (id) => {\n        this.setState({tryingToDelete: id});\n    }\n\n    handleDelete = (id) => {\n\n        fetch('/deleteListing', {\n            signal: this.abortController.signal,\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json'\n            },\n            body: JSON.stringify({adId: id})\n        }).then(res => res.json())\n        .then(res => res.success && this.setState({tryingToDelete: -1}))\n        .then(() => this.displayPhotos(this.props.loggedInUserId))\n        .catch(e => console.error(\"Critical failure: \" + e.message));\n        \n    }\n\n    cancelDelete = () => {\n        this.setState({tryingToDelete: -1});\n    }\n\n    paginationButtonClick = (e) => {\n        let newpage = 1;\n        switch(e.target.id) {\n            case 'first':\n                this.setState({page: 1});\n                break;\n            case 'previous':\n                this.state.page > 1 ? newpage = this.state.page-1 : newpage = 1;\n                this.setState({page: newpage});\n                break;\n            case 'next':\n                this.state.page < this.state.numPages ? newpage = this.state.page+1 : newpage = this.state.numPages;\n                this.setState({page: newpage});\n                break;\n            case 'last':\n                this.setState({page: this.state.numPages});\n                break;\n            default:\n                return null;\n        }\n    }\n\n    renderListings = () => {\n\n        const imgStyle = {\n            height: \"290px\",\n            verticalAlign: \"middle\",\n            marginRight: \"20px\",\n            border: '2px solid rgb(255, 255, 255, 0.5)'\n        }\n\n        const textStyle = {\n            color: 'black',\n            textDecoration: 'underline',\n            fontWeight: '500'\n        }\n\n        let numAds = this.state.listings.length;\n        let n = this.state.adsPerPage;\n        let p = this.state.page - 1;\n        let till;\n        p*n + n < numAds ? till = (p+1)*n : till = numAds;\n        let adsPortion = this.state.listings.slice(p*n, till);\n\n        return  <div>\n                    <div style={{width: \"100%\", verticalAlign: 'top', textAlign: 'right'}}>\n                        <NavLink exact to=\"/upload\" className = 'btn'><b>+ OBJAVI NOV OGLAS</b></NavLink>\n                    </div>\n                    <div className=\"listingWrapper\">\n                        {adsPortion.map((listing) => \n                            {\n                                let category = Constants.category[listing.category].value;\n                                let subcategory = ''\n                                switch(category) {\n                                    case 'women':\n                                        subcategory = Constants.women[listing.subcategory].value;\n                                        break;\n                                    case 'men':\n                                        subcategory = Constants.men[listing.subcategory].value;\n                                        break;\n                                    case 'kids':\n                                        subcategory = Constants.kids[listing.subcategory].value;\n                                        break;\n                                    default:\n                                        subcategory = ''\n                                }\n                                return (\n                                <li key={listing.ad_id} style={{ listStyleType: \"none\" }}>\n                                    <img src={listing.photo1_url} alt={listing.photo1_url} style={imgStyle}/><span style={{verticalAlign: \"middle\", display: \"inline-block\", height: \"100%\"}}></span>\n                                    <div style = {{width: '60%', height: '80%', float: 'right', padding: '20px'}}>\n                                        <p>Številka oglasa: <NavLink to={'listings/' + category + '/' + subcategory + '/item?' + listing.ad_id} style = {textStyle}>{listing.ad_id}</NavLink></p>\n                                        <p><NavLink to={\"/edit?\" + listing.ad_id} style = {textStyle}>  UREJANJE</NavLink></p>\n                                        <button style = {{backgroundColor: 'rgb(255,255,255,0)', border: 'none', cursor: 'pointer'}} onClick = {() => this.handleDeleteRequest(listing.ad_id)}>X IZBRIŠI</button>\n                                    </div>\n                                </li>)\n                            }\n                        )}\n                        <div>\n                            <button id='first' className='btn_nopad' onClick={this.paginationButtonClick}>PRVA</button>\n                            <button id='previous' className='btn_nopad' onClick={this.paginationButtonClick}>&#60;&#60;</button>\n                            <button id='current' className='btn_nopad'>{this.state.page}/{this.state.numPages}</button>\n                            <button id='next' className='btn_nopad' onClick={this.paginationButtonClick}>&#62;&#62;</button>\n                            <button id='last' className='btn_nopad' onClick={this.paginationButtonClick}>ZADNJA</button>\n                        </div>\n                    </div>\n                </div>\n    }\n\n    switchRender = () => {\n\n        if(this.state.userId === '0') {\n            return (\n                <div style = {{backgroundColor: 'rgb(255,255,255,0.5)'}}>\n                    <br/><br/><br/>\n                    <h2>PROSIMO PRIJAVITE SE V SISTEM!</h2>\n                    <br/><br/><br/>\n                </div>\n            )\n        }\n        else if(!this.state.listings.length) {\n            return (\n                <div className=\"userContainer\">\n                    <div style = {{textAlign: 'center'}}>\n                        <h2 style = {{color: 'white'}}>NIMATE ŠE OBJAVLJENIH OGLASOV.</h2>\n                    </div>\n                    <div style={{width: \"100%\", verticalAlign: 'top', textAlign: 'right'}}>\n                        <NavLink exact to=\"/upload\" className = 'btn'><b>+ OBJAVI NOV OGLAS</b></NavLink>\n                    </div>\n                </div>\n            );\n        } else if(this.state.listings.length && this.state.tryingToDelete !== -1) {\n            return (\n                <div className=\"userContainer\">\n                <Popup open = {true}\n                position = 'center center'\n                onClose={this.closeModal}>\n                    <div style = {{display: 'inline-flex', justifyContent: 'space-around'}}>\n                        <p style= {{margin: 'auto 10px'}}>Ste prepričani, da želite izbrisati oglas?</p>\n                        <button className = 'btnb' onClick ={() => this.handleDelete(this.state.tryingToDelete)}>DA</button>\n                        <button className = 'btnb' onClick = {this.cancelDelete}>NE</button>\n                    </div>\n                </Popup>\n                {this.renderListings()}\n                </div>  \n            )\n\n        }else {\n            return (\n                <div className=\"userContainer\">\n                    {this.renderListings()}\n                </div>\n            );\n\n        }\n    }\n\n    render() {\n        return(\n            <div className=\"App\">\n            <UpperLine/>\n            <Header/>\n            <NavBar/>\n            <BreadCrumbs pathname = {this.props.location.pathname}/>\n            <UserSideBar/>\n            {this.switchRender()}\n            <AdSpace/>\n            <Bottom/>\n            </div>\n        )\n    }\n\n}\n\nconst mapStateToProps = state => {\n    return {\n      loggedInUser: state.loggedInUser,\n      loggedInUserId: state.loggedInUserId\n    };\n  };\n\n\nexport default connect(mapStateToProps) (UserListings);\n\n"]},"metadata":{},"sourceType":"module"}